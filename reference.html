
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="how-to-guide.html">
      
      
      
      <link rel="icon" href="assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Reference - </title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,700,700i%7CBitter:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Poppins";--md-code-font:"Bitter"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calocem.tacalorimetry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mj-hofmann/CaloCem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mj-hofmann/CaloCem
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="assets/icon.png" alt="logo">

    </a>
    
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mj-hofmann/CaloCem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mj-hofmann/CaloCem
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="plotting_example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting Example
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="quantification.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantification
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="tian.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tian Correction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="how-to-guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="reference.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry" class="md-nav__link">
    <span class="md-ellipsis">
      tacalorimetry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.DownSamplingParameters" class="md-nav__link">
    <span class="md-ellipsis">
      DownSamplingParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.GradientPeakDetectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      GradientPeakDetectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.add_metadata_source" class="md-nav__link">
    <span class="md-ellipsis">
      add_metadata_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.apply_tian_correction" class="md-nav__link">
    <span class="md-ellipsis">
      apply_tian_correction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.average_by_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      average_by_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_ascending_flank_tangent" class="md-nav__link">
    <span class="md-ellipsis">
      get_ascending_flank_tangent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_astm_c1679_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      get_astm_c1679_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_average_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_cumulated_heat_at_hours" class="md-nav__link">
    <span class="md-ellipsis">
      get_cumulated_heat_at_hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_dormant_period_heatflow" class="md-nav__link">
    <span class="md-ellipsis">
      get_dormant_period_heatflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_maximum_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_maximum_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_metadata_grouping_options" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata_grouping_options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peak_onset_via_max_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onset_via_max_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peak_onsets" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onsets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_sample_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.normalize_sample_to_mass" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_sample_to_mass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.plot_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      plot_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.remove_pickle_files" class="md-nav__link">
    <span class="md-ellipsis">
      remove_pickle_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.undo_average_by_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      undo_average_by_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.undo_tian_correction" class="md-nav__link">
    <span class="md-ellipsis">
      undo_tian_correction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.MedianFilterParameters" class="md-nav__link">
    <span class="md-ellipsis">
      MedianFilterParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.PeakDetectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      PeakDetectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.PreProcessParameters" class="md-nav__link">
    <span class="md-ellipsis">
      PreProcessParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.ProcessingParameters" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.SlopeAnalysisParameters" class="md-nav__link">
    <span class="md-ellipsis">
      SlopeAnalysisParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.SplineInterpolationParameters" class="md-nav__link">
    <span class="md-ellipsis">
      SplineInterpolationParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.TianCorrectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      TianCorrectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.measurement" class="md-nav__link">
    <span class="md-ellipsis">
      measurement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.add_metadata_source" class="md-nav__link">
    <span class="md-ellipsis">
      add_metadata_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_ascending_flank_tangent" class="md-nav__link">
    <span class="md-ellipsis">
      get_ascending_flank_tangent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_astm_c1679_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      get_astm_c1679_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_average_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_cumulated_heat_at_hours" class="md-nav__link">
    <span class="md-ellipsis">
      get_cumulated_heat_at_hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_dormant_period_heatflow" class="md-nav__link">
    <span class="md-ellipsis">
      get_dormant_period_heatflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_mainpeak_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_mainpeak_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_maximum_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_maximum_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peak_onset_via_max_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onset_via_max_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peak_onsets" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onsets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_sample_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.normalize_sample_to_mass" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_sample_to_mass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.plot_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      plot_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.remove_pickle_files" class="md-nav__link">
    <span class="md-ellipsis">
      remove_pickle_files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry" class="md-nav__link">
    <span class="md-ellipsis">
      tacalorimetry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.DownSamplingParameters" class="md-nav__link">
    <span class="md-ellipsis">
      DownSamplingParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.GradientPeakDetectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      GradientPeakDetectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.add_metadata_source" class="md-nav__link">
    <span class="md-ellipsis">
      add_metadata_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.apply_tian_correction" class="md-nav__link">
    <span class="md-ellipsis">
      apply_tian_correction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.average_by_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      average_by_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_ascending_flank_tangent" class="md-nav__link">
    <span class="md-ellipsis">
      get_ascending_flank_tangent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_astm_c1679_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      get_astm_c1679_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_average_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_cumulated_heat_at_hours" class="md-nav__link">
    <span class="md-ellipsis">
      get_cumulated_heat_at_hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_dormant_period_heatflow" class="md-nav__link">
    <span class="md-ellipsis">
      get_dormant_period_heatflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_maximum_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_maximum_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_metadata_grouping_options" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata_grouping_options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peak_onset_via_max_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onset_via_max_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peak_onsets" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onsets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.get_sample_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.normalize_sample_to_mass" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_sample_to_mass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.plot_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      plot_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.remove_pickle_files" class="md-nav__link">
    <span class="md-ellipsis">
      remove_pickle_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.undo_average_by_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      undo_average_by_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.Measurement.undo_tian_correction" class="md-nav__link">
    <span class="md-ellipsis">
      undo_tian_correction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.MedianFilterParameters" class="md-nav__link">
    <span class="md-ellipsis">
      MedianFilterParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.PeakDetectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      PeakDetectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.PreProcessParameters" class="md-nav__link">
    <span class="md-ellipsis">
      PreProcessParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.ProcessingParameters" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.SlopeAnalysisParameters" class="md-nav__link">
    <span class="md-ellipsis">
      SlopeAnalysisParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.SplineInterpolationParameters" class="md-nav__link">
    <span class="md-ellipsis">
      SplineInterpolationParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.tacalorimetry.TianCorrectionParameters" class="md-nav__link">
    <span class="md-ellipsis">
      TianCorrectionParameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.measurement" class="md-nav__link">
    <span class="md-ellipsis">
      measurement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.add_metadata_source" class="md-nav__link">
    <span class="md-ellipsis">
      add_metadata_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_ascending_flank_tangent" class="md-nav__link">
    <span class="md-ellipsis">
      get_ascending_flank_tangent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_astm_c1679_characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      get_astm_c1679_characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_average_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_cumulated_heat_at_hours" class="md-nav__link">
    <span class="md-ellipsis">
      get_cumulated_heat_at_hours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_dormant_period_heatflow" class="md-nav__link">
    <span class="md-ellipsis">
      get_dormant_period_heatflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_mainpeak_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_mainpeak_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_maximum_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_maximum_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peak_onset_via_max_slope" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onset_via_max_slope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peak_onsets" class="md-nav__link">
    <span class="md-ellipsis">
      get_peak_onsets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.get_sample_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.normalize_sample_to_mass" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_sample_to_mass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.plot_by_category" class="md-nav__link">
    <span class="md-ellipsis">
      plot_by_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calocem.measurement.Measurement.remove_pickle_files" class="md-nav__link">
    <span class="md-ellipsis">
      remove_pickle_files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Reference</h1>

<p>This part of the project documentation shows the technical implementation 
of the <code>CaloCem</code> project code.</p>


<div class="doc doc-object doc-module">



<a id="calocem.tacalorimetry"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.DownSamplingParameters" class="doc doc-heading">
            <code>DownSamplingParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters for adaptive downsampling of the heat flow data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>apply</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, adaptive downsampling is applied to the heat flow data.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_points</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target number of points after downsampling. Default is 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smoothing_factor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smoothing factor used in the downsampling algorithm. Default is 1e-10.</p>
              </div>
            </td>
            <td>
                  <code>1e-10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>baseline_weight</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight of the baseline in the downsampling algorithm. Default is 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_split</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the data is split into sections for downsampling. This can be useful if there is a narrow peak in the data early on. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_split_time_s</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time in seconds for splitting the data into two sections. Default is 1000 seconds.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownSamplingParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for adaptive downsampling of the heat flow data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    apply: bool</span>
<span class="sd">        If True, adaptive downsampling is applied to the heat flow data.</span>
<span class="sd">    num_points: int</span>
<span class="sd">        The target number of points after downsampling. Default is 1000.</span>
<span class="sd">    smoothing_factor: float</span>
<span class="sd">        Smoothing factor used in the downsampling algorithm. Default is 1e-10.</span>
<span class="sd">    baseline_weight: float</span>
<span class="sd">        Weight of the baseline in the downsampling algorithm. Default is 0.1.</span>
<span class="sd">    section_split: bool</span>
<span class="sd">        If True, the data is split into sections for downsampling. This can be useful if there is a narrow peak in the data early on. Default is False.</span>
<span class="sd">    section_split_time_s: int</span>
<span class="sd">        Time in seconds for splitting the data into two sections. Default is 1000 seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">smoothing_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">baseline_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">section_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">section_split_time_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.GradientPeakDetectionParameters" class="doc doc-heading">
            <code>GradientPeakDetectionParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters that control the identifcation of Peaks in the first derivative (gradient) of the heat flow data. Under the hood the SciPy <code>find_peaks()</code> is used <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html">Link to SciPy method</a>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prominence</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum prominence of the peak</p>
              </div>
            </td>
            <td>
                  <code>1e-09</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum distance</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum width</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative height of the peak</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum height of the peak</p>
              </div>
            </td>
            <td>
                  <code>1e-09</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_first</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, only the first peak will be used</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_largest_width</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true the peak with the largest peak width will be used.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GradientPeakDetectionParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters that control the identifcation of Peaks in the first derivative (gradient) of the heat flow data. Under the hood the SciPy `find_peaks()` is used [Link to SciPy method](https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prominence: float</span>
<span class="sd">        Minimum prominence of the peak</span>
<span class="sd">    distance: int</span>
<span class="sd">        Minimum distance</span>
<span class="sd">    width: int</span>
<span class="sd">        Minimum width</span>
<span class="sd">    rel_height: float</span>
<span class="sd">        Relative height of the peak</span>
<span class="sd">    height: float</span>
<span class="sd">        Minimum height of the peak</span>
<span class="sd">    use_first: bool</span>
<span class="sd">        If true, only the first peak will be used</span>
<span class="sd">    use_largest_width: bool</span>
<span class="sd">        If true the peak with the largest peak width will be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">rel_height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">use_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">use_largest_width</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">use_largest_width_height</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.Measurement" class="doc doc-heading">
            <code>Measurement</code>


</h2>


    <div class="doc doc-contents ">


        <p>A base class for handling and processing isothermal heat flow calorimetry data.</p>
<p>Currently supported file formats are .xls and .csv files.
Only TA Instruments data files are supported at the moment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to folder containing .xls and/or .csv experimental result
files. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether or not to print some informative lines during code
execution. The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regex pattern to include only certain experimental result files
during initialization. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_clean</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether or not to exclude NaN values contained in the original
files and combine data from differently names temperature columns.
The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cold_start</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether or not to use "pickled" files for initialization; save time
on reading</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calodatapath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">calodatapath</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
    <p>We can use a regex pattern to only include certain files in the datafolder. Here we assume that we only want to load .csv files which contain the string "bm".</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">calodatapath</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.*bm.*.csv&quot;</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Measurement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for handling and processing isothermal heat flow calorimetry data.</span>

<span class="sd">    Currently supported file formats are .xls and .csv files.</span>
<span class="sd">    Only TA Instruments data files are supported at the moment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str, optional</span>
<span class="sd">        path to folder containing .xls and/or .csv experimental result</span>
<span class="sd">        files. The default is None.</span>
<span class="sd">    show_info : bool, optional</span>
<span class="sd">        whether or not to print some informative lines during code</span>
<span class="sd">        execution. The default is True.</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        regex pattern to include only certain experimental result files</span>
<span class="sd">        during initialization. The default is None.</span>
<span class="sd">    auto_clean : bool, optional</span>
<span class="sd">        whether or not to exclude NaN values contained in the original</span>
<span class="sd">        files and combine data from differently names temperature columns.</span>
<span class="sd">        The default is False.</span>
<span class="sd">    cold_start : bool, optional</span>
<span class="sd">        whether or not to use &quot;pickled&quot; files for initialization; save time</span>
<span class="sd">        on reading</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import CaloCem as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; calodatapath = Path(__file__).parent</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, show_info=True)</span>

<span class="sd">    We can use a regex pattern to only include certain files in the datafolder. Here we assume that we only want to load .csv files which contain the string &quot;bm&quot;.</span>

<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, regex=r&quot;.*bm.*.csv&quot;, show_info=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># init</span>
    <span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># helper to store experimental data as loaded from files</span>

    <span class="c1"># further metadata</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">_metadata_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># define pickle filenames</span>
    <span class="n">_file_data_pickle</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;_data.pickle&quot;</span>
    <span class="n">_file_info_pickle</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;_info.pickle&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># init</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cold_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">new_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">processed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        intialize measurements from folder</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span> <span class="o">=</span> <span class="n">processed</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">ProcessingParameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">processparams</span>

        <span class="c1"># read</span>
        <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cold_start</span><span class="p">:</span>
                <span class="c1"># get data and parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_and_parameters_from_folder</span><span class="p">(</span>
                    <span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># get data and parameters from pickled files</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_and_parameters_from_pickle</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                    <span class="c1"># remove NaN values and merge time columns</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_auto_clean_data</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># info</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AutoCleanException</span>
                <span class="c1"># return</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_adaptive_downsampling</span><span class="p">()</span>
        <span class="c1"># Message</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;================</span><span class="se">\n</span><span class="s2">Are you missing some samples? Try rerunning with auto_clean=True and cold_start=True.</span><span class="se">\n</span><span class="s2">=================&quot;</span>
        <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># get_data_and_parameters_from_folder</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_data_and_parameters_from_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_data_and_parameters_from_folder</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># convert</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="c1"># loop folder</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.xls&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)):</span>
                <span class="c1"># go to next</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
                <span class="c1"># check match</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
                    <span class="c1"># skip this file</span>
                    <span class="k">continue</span>

            <span class="c1"># info</span>
            <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># define file</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">f</span>

            <span class="c1"># check xls</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xls&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_read_csv_data</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># collect information</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_info_xls</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># initialize</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_info_xls</span><span class="p">(</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
                            <span class="p">)</span>

                    <span class="c1"># collect data</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_xls</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># initialize</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_xls</span><span class="p">(</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
                            <span class="p">)</span>

            <span class="c1"># append csv</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
                <span class="c1"># collect data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_read_csv_data</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="c1"># self._read_csv_data(file, show_info=show_info)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># initialize</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_csv</span><span class="p">(</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
                            <span class="p">)</span>

                <span class="c1"># collect information</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_info_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># initialize</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_info_csv</span><span class="p">(</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
                            <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="k">pass</span>

        <span class="c1"># get &quot;heat_j&quot; columns if the column is not part of the source files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">infer_heat</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infer_heat_j_column</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># if self.processparams.downsample.apply is not False:</span>
        <span class="c1">#     self._apply_adaptive_downsampling()</span>
        <span class="c1"># write _data and _info to pickle</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_data_pickle</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_info_pickle</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="c1"># store experimental data for recreating state after reading from files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># get data and information from pickled files</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_data_and_parameters_from_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get data and information from pickled files</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read from pickle</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_data_pickle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_info_pickle</span><span class="p">)</span>
            <span class="c1"># store experimental data for recreating state after reading from files</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># raise custom Exception</span>
            <span class="k">raise</span> <span class="n">ColdStartException</span><span class="p">()</span>

        <span class="c1"># log</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;_data and _info loaded from pickle files.&quot;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># determine csv data range</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_determine_data_range_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        determine csv data range of CSV-file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            filepath.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        empty_lines : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># open csv file</span>
        <span class="n">thefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="c1"># detect empty lines which are characteristic at the beginning and</span>
        <span class="c1"># end of the data block</span>
        <span class="n">empty_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">thefile</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">empty_lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_csv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NEW IMPLEMENTATION</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filetype</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
                <span class="n">delimiter</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">detect_delimiter</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">title_row</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_title_row</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delimiter</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">title_row</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">title_row</span><span class="p">)</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_reaction_start_time</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">delimiter</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">prepare_tab_columns</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tidy_colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">remove_unnecessary_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_df_to_float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">correct_start_time</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_sample_info</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="c1">#</span>
    <span class="c1"># read csv data</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_data_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        try reading calorimetry data from csv file via multiple options</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str | pathlib.Path</span>
<span class="sd">            path to csv fileto be read.</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            flag whether or not to show information. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_csv_comma_sep</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_calo_data_csv_tab_sep</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span><span class="p">)</span>

        <span class="c1"># valid read</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># log</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2716</span><span class="s2"> reading </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> FAILED.&quot;</span><span class="p">)</span>

        <span class="c1"># log</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2714</span><span class="s2"> reading </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> successful.&quot;</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1">#</span>
    <span class="c1"># read csv data</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_data_csv_comma_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read data from csv file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            filepath.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            experimental data contained in file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># define Excel file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;No meaningful separator&quot;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
        <span class="p">)</span>

        <span class="c1"># check for tab-separation</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># raise Exception</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># look for potential index indicating in-situ-file</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Reaction start&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="c1"># get target row</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Reaction start&quot;</span><span class="p">)</span>
            <span class="c1"># get row</span>
            <span class="n">start_row</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="n">helper</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># get offset for in-situ files</span>
            <span class="n">t_offset_in_situ_s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">start_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_rowwise_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tidy_colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">remove_unnecessary_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># type conversion</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_df_to_float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># check for &quot;in-situ&quot; sample --&gt; reset</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># offset</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">t_offset_in_situ_s</span>
            <span class="c1"># write to log</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u26a0</span><span class="s2"> Consider </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> as in-situ-file --&gt; time-scale adjusted.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># restrict to &quot;time_s&quot; &gt; 0</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt; 0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># add sample information</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_sample_info</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="c1"># if self.processparams.downsample.apply:</span>
        <span class="c1">#     data = self._apply_adaptive_downsampling(data)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1">#</span>
    <span class="c1"># read csv data</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_data_csv_tab_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str | pathlib.Path</span>
<span class="sd">            path to tab separated csv-files from &quot;older&quot; versions of the device.</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            flag whether or not to show information. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># process</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># get sample mass (if available)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get mass, first row in 3rd column is the title</span>
            <span class="c1"># the assumption is that the sample weight is one value on top of the 3rd column</span>
            <span class="n">mass_index</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">mass_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># set mass to None</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># go on</span>
            <span class="k">pass</span>

        <span class="c1"># get &quot;reaction start&quot; time (if available)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get &quot;reaction start&quot; time in seconds</span>
            <span class="n">_helper</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reaction start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># convert to float</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_helper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># set t0 to None</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># go on</span>
            <span class="k">pass</span>

        <span class="c1"># remove all-Nan columns</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># restrict to first two columns</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># rename</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;heat_flow_mw&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># return empty DataFrame</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># get data columns</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># convert data types</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_mw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_mw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># convert to same unit</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_mw&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># calculate cumulative heat flow</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_j&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumulative_trapezoid</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># remove &quot;heat_flow_w&quot; column</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_mw&quot;</span><span class="p">]</span>

        <span class="c1"># take into account time offset via &quot;reactin start&quot; time</span>
        <span class="k">if</span> <span class="n">t0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">t0</span>

        <span class="c1"># calculate normalized heat flow and heat</span>
        <span class="k">if</span> <span class="n">mass</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mass</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;heat_j&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mass</span>

        <span class="c1"># restrict to &quot;time_s&quot; &gt; 0</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt;= 0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># add sample information</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

        <span class="c1"># type conversion</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_df_to_float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1">#</span>
    <span class="c1"># read csv info</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_info_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read info from csv file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            filepath.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        info : pd.DataFrame</span>
<span class="sd">            information (metadata) contained in file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># determine number of lines to skip</span>
            <span class="n">empty_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_data_range_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="c1"># read info block from csv-file</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">file</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">empty_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">])</span>
            <span class="c1"># the last block is not really meta data but summary data and</span>
            <span class="c1"># somewhat not necessary</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># return empty DataFrame</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># add sample name as column</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="c1">#</span>
    <span class="c1"># read excel info</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_info_xls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read information from xls-file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            filepath.</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            flag whether or not to show information. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        info : pd.DataFrame</span>
<span class="sd">            information (metadata) contained in file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># specify Excel</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get experiment info (first sheet)</span>
            <span class="n">df_experiment_info</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Experiment info&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">])</span>
            <span class="c1"># use first row as header</span>
            <span class="n">df_experiment_info</span> <span class="o">=</span> <span class="n">df_experiment_info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

            <span class="c1"># add sample information</span>
            <span class="n">df_experiment_info</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
            <span class="n">df_experiment_info</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

            <span class="c1"># rename variable</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">df_experiment_info</span>

            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">info</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;==&gt; ERROR in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># read excel data</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_read_calo_data_xls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read data from xls-file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            filepath.</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            flag whether or not to show information. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            data contained in file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># define Excel file</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># parse &quot;data&quot; sheet</span>
            <span class="n">df_data</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Raw data&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># replace init timestamp</span>
            <span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>

            <span class="c1"># get new column names</span>
            <span class="n">new_columnames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]):</span>
                <span class="c1"># build</span>
                <span class="n">new_columnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\s\n\[\]\(\) _]+&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_signal_&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># set</span>
            <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_columnames</span>

            <span class="c1"># cut out data part</span>
            <span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># drop column</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time_markers_nan&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># remove columns with too many NaNs</span>
            <span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="c1"># # remove rows with NaNs</span>
            <span class="c1"># df_data = df_data.dropna(axis=0)</span>

            <span class="c1"># float conversion</span>
            <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># convert</span>
                <span class="n">df_data</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># add sample information</span>
            <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
            <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

            <span class="c1"># rename</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">df_data</span>

            <span class="c1"># log</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2714</span><span class="s2"> reading </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> successful.&quot;</span><span class="p">)</span>

            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">===============================================================&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> in file &#39;</span><span class="si">{</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please, rename the data sheet to &#39;Raw data&#39; (device default).&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;===============================================================</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># log</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2716</span><span class="s2"> reading </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> FAILED.&quot;</span><span class="p">)</span>

            <span class="c1"># return</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">#</span>
    <span class="c1"># iterate samples</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iterate samples and return corresponding data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sample (str) : name of the current sample</span>
<span class="sd">        data (pd.DataFrame) : data corresponding to the current sample</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="k">yield</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span>

    <span class="c1">#</span>
    <span class="c1"># auto clean data</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_auto_clean_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove NaN values from self._data and merge differently named columns</span>
<span class="sd">        representing the (constant) temperature set for the measurement</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># remove NaN values and reset index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;normalized_heat&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># determine NaN count</span>
        <span class="n">nan_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;temperature_temperature_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">int</span>
        <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;temperature_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># consolidate temperature columns</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;temperature_temperature_c&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">columns</span>
            <span class="ow">and</span> <span class="s2">&quot;temperature_c&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">):</span>
            <span class="c1"># use values from column &quot;temperature_c&quot; and set the values to column</span>
            <span class="c1"># &quot;temperature_c&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;temperature_temperature_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nan_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;temperature_temperature_c&quot;</span><span class="p">,</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;temperature_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nan_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;temperature_c&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="c1"># remove values from column &quot;temperature_c&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;temperature_c&quot;</span><span class="p">])</span>

        <span class="c1"># rename column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;temperature_temperature_c&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature_c&quot;</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># plot</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Plot the calorimetry data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t_unit : str, optional</span>
<span class="sd">            time unit. The default is &quot;h&quot;. Options are &quot;s&quot;, &quot;min&quot;, &quot;h&quot;, &quot;d&quot;.</span>
<span class="sd">        y : str, optional</span>
<span class="sd">            y-axis. The default is &quot;normalized_heat_flow_w_g&quot;. Options are</span>
<span class="sd">            &quot;normalized_heat_flow_w_g&quot;, &quot;heat_flow_w&quot;, &quot;normalized_heat_j_g&quot;,</span>
<span class="sd">            &quot;heat_j&quot;.</span>
<span class="sd">        y_unit_milli : bool, optional</span>
<span class="sd">            whether or not to plot y-axis in Milliwatt. The default is True.</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            regex pattern to include only certain samples during plotting. The</span>
<span class="sd">            default is None.</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            whether or not to show information. The default is True.</span>
<span class="sd">        ax : matplotlib.axes._axes.Axes, optional</span>
<span class="sd">            axis to plot to. The default is None.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import CaloCem as ta</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; calodatapath = Path(__file__).parent</span>
<span class="sd">        &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, show_info=True)</span>
<span class="sd">        &gt;&gt;&gt; tam.plot(t_unit=&quot;h&quot;, y=&quot;normalized_heat_flow_w_g&quot;, y_unit_milli=False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># y-value</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span>
            <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Normalized Heat Flow / [W/g]&quot;</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;heat_flow_w&quot;</span><span class="p">:</span>
            <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;heat_flow_w&quot;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Heat Flow / [W]&quot;</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span>
            <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Normalized Heat / [J/g]&quot;</span>
        <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;heat_j&quot;</span><span class="p">:</span>
            <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;heat_j&quot;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Heat / [J]&quot;</span>

        <span class="k">if</span> <span class="n">y_unit_milli</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">y_label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;[m&quot;</span><span class="p">)</span>

        <span class="c1"># x-unit</span>
        <span class="k">if</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
            <span class="n">x_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
            <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>

        <span class="c1"># y-unit</span>
        <span class="k">if</span> <span class="n">y_unit_milli</span><span class="p">:</span>
            <span class="n">y_factor</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_factor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">regex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sample</span><span class="p">)):</span>
                    <span class="k">continue</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_factor</span>
            <span class="c1"># all columns containing heat</span>
            <span class="n">heatcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;heat&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="n">heatcols</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">heatcols</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_factor</span>
            <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="n">y_column</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">style_base_plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">y_label</span><span class="p">,</span>
                <span class="n">t_unit</span><span class="p">,</span>
                <span class="n">sample</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="c1">#</span>
    <span class="c1"># plot by category</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_by_category</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot by category, wherein the category is based on the information passed</span>
<span class="sd">        via &quot;self._add_metadata_source&quot;. Options available as &quot;category&quot; are</span>
<span class="sd">        accessible via &quot;self.get_metadata_grouping_options&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        categories : str, list[str]</span>
<span class="sd">            category (from &quot;self.get_metadata_grouping_options&quot;) to group by.</span>
<span class="sd">            specify a string or a list of strings here</span>
<span class="sd">        t_unit : TYPE, optional</span>
<span class="sd">            see &quot;self.plot&quot;. The default is &quot;h&quot;.</span>
<span class="sd">        y : TYPE, optional</span>
<span class="sd">            see &quot;self.plot&quot;. The default is &quot;normalized_heat_flow_w_g&quot;.</span>
<span class="sd">        y_unit_milli : TYPE, optional</span>
<span class="sd">            see &quot;self.plot&quot;. The default is True.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import CaloCem as ta</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; calodatapath = Path(__file__).parent</span>
<span class="sd">        &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, show_info=True)</span>
<span class="sd">        &gt;&gt;&gt; tam.plot_by_category(categories=&quot;sample&quot;)</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">build_helper_string</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            build a &quot;nicely&quot; formatted string from a supplied list</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># connect with &quot;and&quot;</span>
                <span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># connect with comma and &quot;and&quot; for last element</span>
                <span class="n">formatted</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot;---&quot;</span>

            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">formatted</span>

        <span class="c1"># loop category values</span>
        <span class="k">for</span> <span class="n">selections</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">categories</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="c1"># - if multiple categories to group by are specified -</span>
                <span class="c1"># init helper DataFrame</span>
                <span class="n">target_idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="c1"># identify corresponding samples</span>
                <span class="k">for</span> <span class="n">selection</span><span class="p">,</span> <span class="n">category</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="n">categories</span><span class="p">):</span>
                    <span class="n">target_idx</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">selection</span>
                <span class="c1"># get relevant indices</span>
                <span class="n">target_idx</span> <span class="o">=</span> <span class="n">target_idx</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                <span class="c1"># define title</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Grouped by </span><span class="si">{</span><span class="n">build_helper_string</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">build_helper_string</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># - if only one(!) category to group by is specified -</span>
                <span class="c1"># identify corresponding samples</span>
                <span class="n">target_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">categories</span><span class="p">]</span> <span class="o">==</span> <span class="n">selections</span>
                <span class="c1"># define title</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Grouped by </span><span class="si">{</span><span class="n">categories</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">selections</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="c1"># pick relevant samples</span>
            <span class="n">target_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span><span class="p">]</span>

            <span class="c1"># build corresponding regex</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;)|(&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_samples</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

            <span class="c1"># plot</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="n">t_unit</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="n">y_unit_milli</span><span class="p">)</span>

            <span class="c1"># set title</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="c1"># yield latest plot</span>
            <span class="k">yield</span> <span class="n">selections</span><span class="p">,</span> <span class="n">ax</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_peak_positions</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">_age_col</span><span class="p">,</span>
        <span class="n">_target_col</span><span class="p">,</span>
        <span class="n">peaks</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">,</span>
        <span class="n">plt_top</span><span class="p">,</span>
        <span class="n">plt_right_s</span><span class="p">,</span>
        <span class="n">plot_labels</span><span class="p">,</span>
        <span class="n">xmarker</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot detected peaks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">new_ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">_age_col</span><span class="p">,</span> <span class="n">_target_col</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xmarker</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">_age_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="n">_target_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">],</span>
                <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">_age_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">],</span>
            <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">_target_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">_age_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">_target_col</span><span class="p">][</span><span class="n">peaks</span><span class="p">]):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.0002</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

            <span class="c1"># ax.text(</span>
            <span class="c1">#     x=data[_age_col][peaks],</span>
            <span class="c1">#     y=data[_target_col][peaks],</span>
            <span class="c1">#     #s=[f&quot;{round(i,2)}&quot; for i in data[_age_col][peaks]],</span>
            <span class="c1">#     s=&quot;hallo&quot;,</span>
            <span class="c1">#     color=&quot;red&quot;,</span>
            <span class="c1"># )</span>

        <span class="n">limits</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">plt_right_s</span><span class="p">,</span>
            <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">plt_top</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">style_base_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">_target_col</span><span class="p">,</span> <span class="n">_age_col</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_ax</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_maximum_slope</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">,</span>
        <span class="n">characteristics</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">x_increment</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">characteristics</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">characteristics</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">time_discarded_s</span> <span class="o">=</span> <span class="n">time_discarded_s</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">x_increment</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">new_ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="c1"># plot gradient</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gradient&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">xmask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">time_discarded_s</span>
        <span class="n">y_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">][</span><span class="n">xmask</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">y_vals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">y_vals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">y_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">y_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="c1"># ax.set_ylim(ymin, ymax)</span>

        <span class="n">y2_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">][</span><span class="n">xmask</span><span class="p">]</span>
        <span class="n">y2min</span> <span class="o">=</span> <span class="n">y2_vals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">y2_vals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">y2max</span> <span class="o">=</span> <span class="n">y2_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">y2_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y2min</span><span class="p">,</span> <span class="n">y2max</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Gradient [Wg$^{-1}$s$^{-1}$]&quot;</span><span class="p">)</span>

        <span class="c1"># add vertical lines</span>
        <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_row</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># vline</span>
            <span class="n">t_maxslope</span> <span class="o">=</span> <span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t_maxslope</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">}</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">style_base_plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">sample</span><span class="p">,</span>
            <span class="n">limits</span><span class="p">,</span>
            <span class="n">time_discarded_s</span><span class="o">=</span><span class="n">time_discarded_s</span><span class="p">,</span>
            <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">t_maxslope</span> <span class="o">+</span> <span class="n">x_increment</span><span class="p">,</span>
            <span class="mf">0.00025</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">t_maxslope</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">xunit</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">new_ax</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
                <span class="n">sample_name</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;maximum_slope_detect_</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_intersection</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">,</span>
        <span class="c1"># characteristics,</span>
        <span class="n">time_discarded_s</span><span class="p">,</span>
        <span class="n">characteristics</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="c1"># xunit=&quot;s&quot;,</span>
        <span class="n">hmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">age_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">age_col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">time_s</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">time_s</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">dorm_time_s</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">dorm_time_s</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">gradient</span> <span class="o">*</span> <span class="mi">3600</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="c1"># characteristics[age_col] = characteristics[age_col] / 3600</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">new_ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
        <span class="c1"># print(new_ax)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">style_base_plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">sample</span><span class="p">,</span>
            <span class="n">time_discarded_s</span><span class="o">=</span><span class="n">time_discarded_s</span><span class="p">,</span>
            <span class="n">xunit</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">xunit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span>
            <span class="p">(</span><span class="n">characteristics</span><span class="o">.</span><span class="n">time_s</span><span class="p">,</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">normalized_heat_flow_w_g</span><span class="p">),</span>
            <span class="n">slope</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">gradient</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">intersection</span> <span class="o">==</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
                <span class="n">y</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">dorm_normalized_heat_flow_w_g</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">dorm_normalized_heat_flow_w_g</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;   $t_i=$ </span><span class="si">{</span><span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">characteristics</span><span class="o">.</span><span class="n">xunit</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">intersection</span> <span class="o">==</span> <span class="s2">&quot;abscissa&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;   $t_i=$ </span><span class="si">{</span><span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">characteristics</span><span class="o">.</span><span class="n">xunit</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">characteristics</span><span class="o">.</span><span class="n">x_intersect</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hmax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_ax</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
                <span class="n">sample_name</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;intersection_detect_</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># get the cumulated heat flow a at a certain age</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cumulated_heat_at_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the cumulated heat flow a at a certain age</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        processparams : ProcessingParameters, optional</span>
<span class="sd">            Processing parameters. The default is None. If None, the default</span>
<span class="sd">            parameters are used. The most important parameter is the cutoff time</span>
<span class="sd">            in minutes which describes the initial time period of the measurement</span>
<span class="sd">            which is not considered for the cumulated heat flow. It is defined in</span>
<span class="sd">            the ProcessingParameters class. The default value is 30 minutes.</span>

<span class="sd">        target_h : int | float</span>
<span class="sd">            end time in hourscv</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A Pandas dataframe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;cutoff_min&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The cutoff_min parameter is deprecated. Please use the ProcessingParameters class instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">processparams</span><span class="p">:</span>
                <span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
            <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">applicable</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="c1"># convert target time to seconds</span>
            <span class="n">target_s</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">*</span> <span class="n">target_h</span>
            <span class="c1"># helper</span>
            <span class="n">_helper</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &lt;= @target_s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># get heat at target time</span>
            <span class="n">hf_at_target</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># if cutoff time specified</span>
            <span class="k">if</span> <span class="n">cutoff_min</span><span class="p">:</span>
                <span class="c1"># convert target time to seconds</span>
                <span class="n">target_s</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">cutoff_min</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># helper</span>
                    <span class="n">_helper</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &lt;= @target_s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># type conversion</span>
                    <span class="n">hf_at_cutoff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># correct heatflow for heatflow at cutoff</span>
                    <span class="n">hf_at_target</span> <span class="o">=</span> <span class="n">hf_at_target</span> <span class="o">-</span> <span class="n">hf_at_cutoff</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">name_wt_nan</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Found NaN in Normalized heat of sample </span><span class="si">{</span><span class="n">name_wt_nan</span><span class="si">}</span><span class="s2"> searching for cumulated heat at </span><span class="si">{</span><span class="n">target_h</span><span class="si">}</span><span class="s2">h and a cutoff of </span><span class="si">{</span><span class="n">cutoff_min</span><span class="si">}</span><span class="s2">min.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">hf_at_target</span>

        <span class="c1"># in case of one specified time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c1"># groupby</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)[[</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]]</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">applicable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="n">target_h</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># rename</span>
            <span class="n">results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulated_heat_at_hours&quot;</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;target_h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_h</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutoff_min</span>

        <span class="c1"># in case of specified list of times</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># init list</span>
            <span class="n">list_of_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># loop</span>
            <span class="k">for</span> <span class="n">this_target_h</span> <span class="ow">in</span> <span class="n">target_h</span><span class="p">:</span>
                <span class="c1"># groupby</span>
                <span class="n">_results</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)[[</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]]</span>
                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">applicable</span><span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="n">this_target_h</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># rename</span>
                <span class="n">_results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulated_heat_at_hours&quot;</span><span class="p">]</span>
                <span class="n">_results</span><span class="p">[</span><span class="s2">&quot;target_h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_target_h</span>
                <span class="n">_results</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutoff_min</span>
                <span class="c1"># append to list</span>
                <span class="n">list_of_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_results</span><span class="p">)</span>
            <span class="c1"># build overall results DataFrame</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_results</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="c1">#</span>
    <span class="c1"># find peaks</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span>
        <span class="n">plt_top</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">plot_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xmarker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get DataFrame of peak characteristics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_col : str, optional</span>
<span class="sd">            measured quantity within which peaks are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            regex pattern to include only certain experimental result files</span>
<span class="sd">            during initialization. The default is None.</span>
<span class="sd">        cutoff_min : int | float, optional</span>
<span class="sd">            Time in minutes below which collected data points are discarded for peak picking</span>
<span class="sd">        show_plot : bool, optional</span>
<span class="sd">            Flag whether or not to plot peak picking for each sample. The default is True.</span>
<span class="sd">        plt_right_s : int | float, optional</span>
<span class="sd">            Upper limit of x-axis of in seconds. The default is 2e5.</span>
<span class="sd">        plt_top : int | float, optional</span>
<span class="sd">            Upper limit of y-axis of. The default is 1e-2.</span>
<span class="sd">        ax : matplotlib.axes._axes.Axes | None, optional</span>
<span class="sd">            The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame holding peak characterisitcs for each sample.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># list of peaks</span>
        <span class="n">list_of_peaks_dfs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="c1"># cutoff</span>
            <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span><span class="p">:</span>
                <span class="c1"># discard points at early age</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt;= @processparams.cutoff.cutoff_min * 60&quot;</span><span class="p">)</span>

            <span class="c1"># reset index</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># target_columns</span>
            <span class="n">_age_col</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span>
            <span class="n">_target_col</span> <span class="o">=</span> <span class="n">target_col</span>

            <span class="c1"># find peaks</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">_target_col</span><span class="p">],</span>
                <span class="n">prominence</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">prominence</span><span class="p">,</span>
                <span class="n">distance</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># plot?</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="n">df_copy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">df_copy</span><span class="p">[</span><span class="n">_age_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">_age_col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
                    <span class="n">plt_right_s</span> <span class="o">=</span> <span class="n">plt_right_s</span> <span class="o">/</span> <span class="mi">3600</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plot_peak_positions</span><span class="p">(</span>
                        <span class="n">df_copy</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">_age_col</span><span class="p">,</span>
                        <span class="n">_target_col</span><span class="p">,</span>
                        <span class="n">peaks</span><span class="p">,</span>
                        <span class="n">sample</span><span class="p">,</span>
                        <span class="n">plt_top</span><span class="p">,</span>
                        <span class="n">plt_right_s</span><span class="p">,</span>
                        <span class="n">plot_labels</span><span class="p">,</span>
                        <span class="n">xmarker</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plot_peak_positions</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">_age_col</span><span class="p">,</span>
                        <span class="n">_target_col</span><span class="p">,</span>
                        <span class="n">peaks</span><span class="p">,</span>
                        <span class="n">sample</span><span class="p">,</span>
                        <span class="n">plt_top</span><span class="p">,</span>
                        <span class="n">plt_right_s</span><span class="p">,</span>
                        <span class="n">plot_labels</span><span class="p">,</span>
                        <span class="n">xmarker</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># compile peak characteristics</span>
            <span class="n">peak_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">,</span> <span class="p">:],</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                        <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;prominences&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">peaks</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prominence&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;peak_nr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)))},</span> <span class="n">index</span><span class="o">=</span><span class="n">peaks</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># append</span>
            <span class="n">list_of_peaks_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_characteristics</span><span class="p">)</span>

        <span class="c1"># compile peak information</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_peaks_dfs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="c1"># return peak list and ax</span>
            <span class="k">return</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># return peak list only</span>
            <span class="k">return</span> <span class="n">peaks</span>

    <span class="c1">#</span>
    <span class="c1"># get peak onsets</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onsets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
        <span class="n">rolling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">gradient_threshold</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get peak onsets based on a criterion of minimum gradient</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_col : str, optional</span>
<span class="sd">            measured quantity within which peak onsets are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">        age_col : str, optional</span>
<span class="sd">            Time unit within which peak onsets are searched for. The default is &quot;time_s&quot;</span>
<span class="sd">        time_discarded_s : int | float, optional</span>
<span class="sd">            Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</span>
<span class="sd">        rolling : int, optional</span>
<span class="sd">            Width of &quot;rolling&quot; window within which the values of &quot;target_col&quot; are averaged. A higher value will introduce a stronger smoothing effect. The default is 1, i.e. no smoothing.</span>
<span class="sd">        gradient_threshold : float, optional</span>
<span class="sd">            Threshold of slope for identification of a peak onset. For a lower value, earlier peak onsets will be identified. The default is 0.0005.</span>
<span class="sd">        show_plot : bool, optional</span>
<span class="sd">            Flag whether or not to plot peak picking for each sample. The default is False.</span>
<span class="sd">        exclude_discarded_time : bool, optional</span>
<span class="sd">            Whether or not to discard the experimental values obtained before &quot;time_discarded_s&quot; also in the visualization. The default is False.</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            regex pattern to include only certain experimental result files during initialization. The default is None.</span>
<span class="sd">        ax : matplotlib.axes._axes.Axes | None, optional</span>
<span class="sd">            The default is None.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame holding peak onset characterisitcs for each sample.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># init list of characteristics</span>
        <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">exclude_discarded_time</span><span class="p">:</span>
                <span class="c1"># exclude</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># reset index</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># calculate get gradient</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">rolling</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="c1"># get relevant points</span>
            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># discard initial time</span>
            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># look at values with certain gradient only</span>
            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;gradient &gt; @gradient_threshold&quot;</span><span class="p">)</span>
            <span class="c1"># consider first entry exclusively</span>
            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># optional plotting</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="c1"># if specific axis to plot to is specified</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                    <span class="c1"># plot heat flow curve</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>

                    <span class="c1"># add vertical lines</span>
                    <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_row</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="c1"># vline</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                        <span class="c1"># add &quot;slope line&quot;</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">target_col</span><span class="p">]),</span>
                            <span class="n">slope</span><span class="o">=</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                            <span class="c1"># color=&quot;k&quot;,</span>
                            <span class="c1"># linewidth=0.2</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># cosmetics</span>
                    <span class="c1"># ax.set_xscale(&quot;log&quot;)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Onset for &quot;</span> <span class="o">+</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_discarded_s</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># set axis limit</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># plot heat flow curve</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>

                    <span class="c1"># add vertical lines</span>
                    <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_row</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="c1"># vline</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

                    <span class="c1"># cosmetics</span>
                    <span class="c1"># plt.xscale(&quot;log&quot;)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Onset for &quot;</span> <span class="o">+</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>

                    <span class="c1"># get axis</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_discarded_s</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># set axis limit</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># append to list</span>
            <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

        <span class="c1"># build overall list</span>
        <span class="n">onset_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="c1"># return onset characteristics and ax</span>
            <span class="k">return</span> <span class="n">onset_characteristics</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return onset characteristics exclusively</span>
            <span class="k">return</span> <span class="n">onset_characteristics</span>

    <span class="c1">#</span>
    <span class="c1"># get maximum slope</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_maximum_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">read_start_c3s</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method finds the point in time of the maximum slope. It also calculates the gradient at this point. The method can be controlled by passing a customized ProcessingParameters object for the `processparams` parameter. If no object is passed, the default parameters will be used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_col : str, optional</span>
<span class="sd">            measured quantity within which peak onsets are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">        age_col : str, optional</span>
<span class="sd">            Time unit within which peak onsets are searched for. The default is &quot;time_s&quot;</span>
<span class="sd">        time_discarded_s : int | float, optional</span>
<span class="sd">            Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</span>
<span class="sd">        show_plot : bool, optional</span>
<span class="sd">            Flag whether or not to plot peak picking for each sample. The default is False.</span>
<span class="sd">        exclude_discarded_time : bool, optional</span>
<span class="sd">            Whether or not to discard the experimental values obtained before &quot;time_discarded_s&quot; also in the visualization. The default is False.</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            regex pattern to include only certain experimental result files during initialization. The default is None.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pandas Dataframe</span>
<span class="sd">            A dataframe that contains the time and the gradient of the maximum slope.</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>

<span class="sd">        &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">        &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">        &gt;&gt;&gt; processparams = ta.ProcessingParameters()</span>
<span class="sd">        &gt;&gt;&gt; processparams..apply = True</span>
<span class="sd">        &gt;&gt;&gt; max_slopes = tam.get_maximum_slope(processparams)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># init list of characteristics</span>
        <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="n">sample_name</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="k">if</span> <span class="n">exclude_discarded_time</span><span class="p">:</span>
                <span class="c1"># exclude</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># manual definition of start time to look for c3s - in case auto peak detection becomes difficult</span>
            <span class="k">if</span> <span class="n">read_start_c3s</span><span class="p">:</span>
                <span class="n">c3s_start_time_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;sample_number == &#39;</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)[</span><span class="s2">&quot;t_c3s_min_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">c3s_end_time_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;sample_number == &#39;</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)[</span><span class="s2">&quot;t_c3s_max_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">c3s_start_time_s</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">c3s_end_time_s</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Determineing maximum slope of </span><span class="si">{</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">processor</span> <span class="o">=</span> <span class="n">HeatFlowProcessor</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">make_equidistant</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">rolling_mean</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">apply_rolling_mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;curvature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">processor</span><span class="o">.</span><span class="n">calculate_heatflow_derivatives</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_largest_slope</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">processparams</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># optional plotting</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_maximum_slope</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">ax</span><span class="p">,</span>
                    <span class="n">age_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="p">,</span>
                    <span class="n">sample</span><span class="p">,</span>
                    <span class="n">characteristics</span><span class="p">,</span>
                    <span class="n">time_discarded_s</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
                    <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
                    <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># plot heat flow curve</span>
                <span class="c1"># plt.plot(data[age_col], data[target_col], label=target_col)</span>
                <span class="c1"># plt.plot(</span>
                <span class="c1">#     data[age_col],</span>
                <span class="c1">#     data[&quot;gradient&quot;] * 1e4 + 0.001,</span>
                <span class="c1">#     label=&quot;gradient * 1e4 + 1mW&quot;,</span>
                <span class="c1"># )</span>

                <span class="c1"># # add vertical lines</span>
                <span class="c1"># for _idx, _row in characteristics.iterrows():</span>
                <span class="c1">#     # vline</span>
                <span class="c1">#     plt.axvline(_row.at[age_col], color=&quot;green&quot;, alpha=0.3)</span>

                <span class="c1"># # cosmetics</span>
                <span class="c1"># plt.xscale(&quot;log&quot;)</span>
                <span class="c1"># plt.title(f&quot;Maximum slope plot for {pathlib.Path(sample).stem}&quot;)</span>
                <span class="c1"># plt.xlabel(age_col)</span>
                <span class="c1"># plt.ylabel(target_col)</span>
                <span class="c1"># plt.legend()</span>

                <span class="c1"># # get axis</span>
                <span class="c1"># ax = plt.gca()</span>

                <span class="c1"># plt.fill_between(</span>
                <span class="c1">#     [ax.get_ylim()[0], time_discarded_s],</span>
                <span class="c1">#     [ax.get_ylim()[0]] * 2,</span>
                <span class="c1">#     [ax.get_ylim()[1]] * 2,</span>
                <span class="c1">#     color=&quot;black&quot;,</span>
                <span class="c1">#     alpha=0.35,</span>
                <span class="c1"># )</span>

                <span class="c1"># # set axis limit</span>
                <span class="c1"># plt.xlim(left=100)</span>
                <span class="c1"># plt.ylim(bottom=0, top=0.01)</span>

                <span class="c1"># # show</span>
                <span class="c1"># plt.show()</span>

            <span class="c1"># append to list</span>
            <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_characteristics</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maximum slope found, check you processing parameters&quot;</span><span class="p">)</span>
        <span class="c1"># build overall list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_slope_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>
            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">max_slope_characteristics</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_average_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate average slope by determining 4 additional slope values between </span>
<span class="sd">        onset time and heat flow maximum, in addition to the maximum slope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        processparams : ProcessingParameters</span>
<span class="sd">            Processing parameters for analysis</span>
<span class="sd">        target_col : str, optional</span>
<span class="sd">            Target measurement column, by default &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">        age_col : str, optional</span>
<span class="sd">            Time column name, by default &quot;time_s&quot;</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex pattern to filter samples, by default None</span>
<span class="sd">        show_plot : bool, optional</span>
<span class="sd">            Whether to show plots, by default False</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            Existing axis to plot on, by default None</span>
<span class="sd">        save_path : Path, optional</span>
<span class="sd">            Path to save plots, by default None</span>
<span class="sd">        xscale : str, optional</span>
<span class="sd">            X-axis scale, by default &quot;log&quot;</span>
<span class="sd">        xunit : str, optional</span>
<span class="sd">            Time unit for display, by default &quot;s&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            DataFrame containing average slope characteristics for each sample</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get maximum slopes using existing method</span>
        <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
            <span class="n">processparams</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
            <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
            <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">max_slopes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maximum slopes found. Cannot calculate average slopes.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Get onset times using the peak onset method</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span>
            <span class="n">processparams</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">onsets</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No onset times found. Cannot calculate average slopes.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Loop through samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

            <span class="c1"># Get max slope data for this sample</span>
            <span class="n">max_slope_row</span> <span class="o">=</span> <span class="n">max_slopes</span><span class="p">[</span><span class="n">max_slopes</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">max_slope_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get onset data for this sample</span>
            <span class="n">onset_row</span> <span class="o">=</span> <span class="n">onsets</span><span class="p">[</span><span class="n">onsets</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">onset_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get time points</span>
            <span class="n">onset_time</span> <span class="o">=</span> <span class="n">onset_row</span><span class="p">[</span><span class="s2">&quot;onset_time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">max_slope_time</span> <span class="o">=</span> <span class="n">max_slope_row</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Find heat flow maximum after onset</span>
            <span class="n">data_after_onset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">onset_time</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_after_onset</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">max_hf_time</span> <span class="o">=</span> <span class="n">data_after_onset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_after_onset</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">age_col</span><span class="p">]</span>

            <span class="c1"># Create 4 intermediate time points between onset and heat flow maximum</span>
            <span class="k">if</span> <span class="n">max_hf_time</span> <span class="o">&lt;=</span> <span class="n">onset_time</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Heat flow maximum occurs before onset for </span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Create 6 time points total (onset, 4 intermediate, max_hf)</span>
            <span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">onset_time</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">max_hf_time</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

            <span class="c1"># Calculate slopes at each interval</span>
            <span class="n">slopes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">slope_times</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">time_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Get data points in this interval</span>
                <span class="n">interval_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t2</span><span class="p">)]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Calculate slope using linear regression</span>
                <span class="n">x_vals</span> <span class="o">=</span> <span class="n">interval_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">y_vals</span> <span class="o">=</span> <span class="n">interval_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

                <span class="c1"># Simple slope calculation: (y2 - y1) / (x2 - x1)</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
                <span class="n">slope_times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Midpoint time</span>

            <span class="c1"># Include the maximum slope</span>
            <span class="n">max_slope_value</span> <span class="o">=</span> <span class="n">max_slope_row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_slope_value</span><span class="p">)</span>
            <span class="n">slope_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_slope_time</span><span class="p">)</span>

            <span class="c1"># Calculate average slope</span>
            <span class="k">if</span> <span class="n">slopes</span><span class="p">:</span>
                <span class="n">avg_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>
                <span class="n">std_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>

                <span class="c1"># Create characteristics dictionary</span>
                <span class="n">characteristics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
                    <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">sample_short</span><span class="p">,</span>
                    <span class="s2">&quot;onset_time_s&quot;</span><span class="p">:</span> <span class="n">onset_time</span><span class="p">,</span>
                    <span class="s2">&quot;max_hf_time_s&quot;</span><span class="p">:</span> <span class="n">max_hf_time</span><span class="p">,</span>
                    <span class="s2">&quot;max_slope_time_s&quot;</span><span class="p">:</span> <span class="n">max_slope_time</span><span class="p">,</span>
                    <span class="s2">&quot;max_slope_value&quot;</span><span class="p">:</span> <span class="n">max_slope_value</span><span class="p">,</span>
                    <span class="s2">&quot;average_slope&quot;</span><span class="p">:</span> <span class="n">avg_slope</span><span class="p">,</span>
                    <span class="s2">&quot;slope_std&quot;</span><span class="p">:</span> <span class="n">std_slope</span><span class="p">,</span>
                    <span class="s2">&quot;n_slopes&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">slopes</span><span class="p">),</span>
                    <span class="s2">&quot;individual_slopes&quot;</span><span class="p">:</span> <span class="n">slopes</span><span class="p">,</span>
                    <span class="s2">&quot;slope_times&quot;</span><span class="p">:</span> <span class="n">slope_times</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="c1"># Optional plotting</span>
                <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plot_average_slope_analysis</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span> <span class="n">characteristics</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> 
                        <span class="n">sample_short</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">xunit</span>
                    <span class="p">)</span>

                <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_characteristics</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No average slope characteristics calculated.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Convert to DataFrame</span>
        <span class="n">avg_slope_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avg_slope_df</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_average_slope_analysis</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">characteristics</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> 
        <span class="n">sample_short</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot average slope analysis for visualization&quot;&quot;&quot;</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">new_ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

        <span class="c1"># Plot the heat flow curve</span>
        <span class="c1">#ax.plot(data[age_col], data[target_col], &#39;b-&#39;, alpha=0.7, label=&#39;Heat Flow&#39;)</span>

        <span class="c1"># Mark onset time</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;onset_time_s&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> 
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Onset&#39;</span><span class="p">)</span>

        <span class="c1"># Mark max heat flow time</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;max_hf_time_s&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> 
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max Heat Flow&#39;</span><span class="p">)</span>

        <span class="c1"># Mark max slope time</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;max_slope_time_s&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max Slope&#39;</span><span class="p">)</span>

        <span class="c1"># Plot individual slope lines</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;individual_slopes&quot;</span><span class="p">])))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
            <span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;individual_slopes&quot;</span><span class="p">],</span> 
            <span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;slope_times&quot;</span><span class="p">],</span> 
            <span class="n">colors</span>
        <span class="p">)):</span>
            <span class="c1"># Find corresponding y-value</span>
            <span class="n">y_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>

            <span class="c1"># Plot slope line (extend 10% of time range)</span>
            <span class="n">time_range</span> <span class="o">=</span> <span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;max_hf_time_s&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;onset_time_s&quot;</span><span class="p">]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">time_range</span>

            <span class="n">x_line</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="o">-</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">dt</span><span class="p">]</span>
            <span class="n">y_line</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_val</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">dt</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_line</span><span class="p">,</span> <span class="n">y_line</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Slope </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Add text annotation for average slope</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> 
                <span class="sa">f</span><span class="s1">&#39;Avg Slope: </span><span class="si">{</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;average_slope&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;Std: </span><span class="si">{</span><span class="n">characteristics</span><span class="p">[</span><span class="s2">&quot;slope_std&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time [</span><span class="si">{</span><span class="n">xunit</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average Slope Analysis - </span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="c1">#ax.set_ylim(0,0.003)</span>

        <span class="k">if</span> <span class="n">new_ax</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="c1">#plt.savefig(save_path / f&quot;average_slope_analysis_{sample_short}.pdf&quot;)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 


    <span class="c1"># get reaction onset via maximum slope</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onset_via_max_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">intersection</span><span class="o">=</span><span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get reaction onset based on tangent of maximum heat flow and heat flow</span>
<span class="sd">        during the dormant period. The characteristic time is inferred from</span>
<span class="sd">        the intersection of both characteristic lines</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        show_plot : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get onsets</span>
        <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
            <span class="n">processparams</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># % get dormant period HFs</span>
        <span class="n">dorm_hfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
            <span class="n">processparams</span><span class="p">,</span>  <span class="c1"># cutoff_min=cutoff_min, prominence=prominence</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="c1"># ax=ax,</span>
        <span class="p">)</span>

        <span class="c1"># init list</span>
        <span class="n">list_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># calculate y-offset</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
            <span class="c1"># calculate point of intersection</span>
            <span class="c1"># calculate x-intersect of tangent with dormant heat flow</span>
            <span class="n">x_intersect_dormant</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span>
                        <span class="n">dorm_hfs</span><span class="p">[</span><span class="n">dorm_hfs</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]][</span>
                            <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">-</span> <span class="n">t</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
            <span class="c1"># elif intersection == &quot;abscissa&quot;:</span>
                <span class="c1"># calculate x-intersect of tangent with abscissa (y=0)</span>
            <span class="n">x_intersect</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">])</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @row[&#39;sample_short&#39;]&quot;</span><span class="p">)</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span>

            <span class="n">heat_at_intersect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_intersect</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">])</span>

            <span class="c1"># append to list</span>
            <span class="n">list_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;onset_time_s_abscissa&quot;</span><span class="p">:</span> <span class="n">x_intersect</span><span class="p">,</span>
                    <span class="s2">&quot;onset_time_min_abscissa&quot;</span><span class="p">:</span> <span class="n">x_intersect</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="s2">&quot;heat_at_onset_j_g&quot;</span><span class="p">:</span> <span class="n">heat_at_intersect</span><span class="p">,</span>
                    <span class="s2">&quot;onset_time_s&quot;</span><span class="p">:</span> <span class="n">x_intersect_dormant</span><span class="p">,</span>
                    <span class="s2">&quot;onset_time_min&quot;</span><span class="p">:</span> <span class="n">x_intersect_dormant</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>


            <span class="n">dorm_hfs_sample</span> <span class="o">=</span> <span class="n">dorm_hfs</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @sample&quot;</span><span class="p">)</span>
            <span class="c1"># add prefix dorm to all columns</span>
            <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dorm_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

            <span class="n">characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()])</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;xunit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xunit</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;x_intersect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_intersect</span>
            <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;intersection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersection</span>
            <span class="c1"># print(characteristics.x_intersect)</span>

            <span class="c1"># get maximum time value</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @row[&#39;sample_short&#39;]&quot;</span><span class="p">)[</span>
                <span class="s2">&quot;time_s&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="c1"># get maximum heat flow value</span>
            <span class="n">hmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;time_s &gt; 3000 &amp; sample_short == @row[&#39;sample_short&#39;]&quot;</span>
            <span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_intersection</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">ax</span><span class="p">,</span>
                    <span class="n">age_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="p">,</span>
                    <span class="n">sample</span><span class="p">,</span>
                    <span class="c1"># max_slopes,</span>
                    <span class="n">time_discarded_s</span><span class="p">,</span>
                    <span class="n">characteristics</span><span class="o">=</span><span class="n">characteristics</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
                    <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
                    <span class="c1"># xunit=xunit,</span>
                    <span class="n">hmax</span><span class="o">=</span><span class="n">hmax</span><span class="p">,</span>
                    <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># build overall dataframe to be returned</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_characteristics</span><span class="p">)</span>

        <span class="c1"># merge with dorm_hfs</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="n">onsets</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">dorm_hfs</span><span class="p">[</span>
                <span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span>
            <span class="p">],</span>
            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># rename</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="n">onsets</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="s2">&quot;normalized_heat_flow_w_g_at_dorm_min&quot;</span><span class="p">,</span>
                <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="s2">&quot;normalized_heat_j_g_at_dorm_min&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">onsets</span>
        <span class="c1"># if isinstance(ax, matplotlib.axes._axes.Axes):</span>
        <span class="c1">#     # return onset characteristics and ax</span>
        <span class="c1">#     return onsets, ax</span>
        <span class="c1"># else:</span>
        <span class="c1">#     # return onset characteristics exclusively</span>
        <span class="c1">#     return onsets</span>

    <span class="c1">#</span>
    <span class="c1"># get dormant period heatflow</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dormant_period_heatflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">upper_dormant_thresh_w_g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
        <span class="n">plot_right_boundary</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span>
        <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get dormant period heatflow</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex which can be used to filter the data, i.e., only the patterns which fit the regex will be evaluated. The default is None.</span>
<span class="sd">        cutoff_min : int | float, optional</span>
<span class="sd">            Time at the start of the experiment which will be cutoff from analysis. This can be useful for ex-situ mixed samples. The default is 5.</span>
<span class="sd">        upper_dormant_thresh_w_g : float, optional</span>
<span class="sd">            Parameter which controls the upper limit for the plotting option. The default is 0.001.</span>
<span class="sd">        show_plot : bool, optional</span>
<span class="sd">            If set to true, the data is plotted. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pandas Dataframe</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># init results list</span>
        <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="c1"># get peak as &quot;right border&quot;</span>
            <span class="n">_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span>
                <span class="n">processparams</span><span class="p">,</span>
                <span class="c1"># cutoff_min=cutoff_min,</span>
                <span class="n">regex</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="c1"># prominence=processparams.gradient_peak_prominence, # prominence,</span>
                <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># identify &quot;dormant period&quot; as range between initial spike</span>
            <span class="c1"># and first reaction peak</span>

            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="c1"># plot</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                    <span class="c1"># linestyle=&quot;&quot;,</span>
                    <span class="c1"># marker=&quot;o&quot;,</span>
                <span class="p">)</span>

            <span class="c1"># discard points at early age</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt;= @processparams.cutoff.cutoff_min * 60&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_peaks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># discard points after the first peak</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;time_s &lt;= @_peaks[&quot;time_s&quot;].min()&#39;</span><span class="p">)</span>

            <span class="c1"># reset index</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># pick relevant points at minimum heat flow</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="c1"># guide to the eye lines</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="c1"># indicate cutoff time</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cutoff_min</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="c1"># limits</span>
                <span class="c1"># plt.xlim(0, _peaks[&quot;time_s&quot;].min())</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">plot_right_boundary</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span><span class="p">)</span>
                <span class="c1"># title</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                <span class="c1"># show</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># add to list</span>
            <span class="n">list_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># convert to overall datafram</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1">#</span>
    <span class="c1"># get ASTM C1679 characteristics</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_astm_c1679_characteristics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">individual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get characteristics according to ASTM C1679. Compiles a list of data</span>
<span class="sd">        points at half-maximum &quot;normalized heat flow&quot;, wherein the half maximum</span>
<span class="sd">        is either determined for each individual heat flow curve individually</span>
<span class="sd">        or as the mean value if the heat flow curves considered.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        individual : bool, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>
<span class="sd">        processparams: ProcessingParameters</span>
<span class="sd">            Dataclass containing parameters which control the processing of the calorimetry data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pandas Dataframe</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Assuming that the calorimetry data is contained in a subfolder `data`, the time according to ASTM c1679 can be obtained by</span>

<span class="sd">        &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">        &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">        &gt;&gt;&gt; astm = tam.get_astm_c1679_characteristics()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get peaks</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">4e5</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># sort peaks by ascending normalized heat flow</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># select highest peak --&gt; ASTM C1679</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>

        <span class="c1"># get data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="c1"># init empty list for collecting characteristics</span>
        <span class="n">astm_times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="c1"># pick sample data</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span><span class="p">]</span>
            <span class="n">helper_df</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># check if peak was found</span>
            <span class="k">if</span> <span class="n">peaks</span><span class="p">[</span><span class="n">peaks</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">sample_short</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># manually set time to NaN to indicate that no peak was found</span>
                <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># restrict to times before the peak</span>
                <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">sample</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">]]</span>

                <span class="c1"># restrict to relevant heatflows the peak</span>
                <span class="k">if</span> <span class="n">individual</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span>
                        <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
                        <span class="o">&lt;=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">sample</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.50</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># use half-maximum average</span>
                    <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span>
                        <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
                        <span class="o">&lt;=</span> <span class="n">peaks</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.50</span>
                    <span class="p">]</span>

                <span class="c1"># add to list of of selected points</span>
            <span class="n">astm_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="c1"># plot</span>
                <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                    <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
                    <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                        <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                        <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                        <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ymax</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">s</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot; $t_</span><span class="si">{ASTM}</span><span class="s2">$ =&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;time_s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># build overall DataFrame</span>
        <span class="n">astm_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">astm_times</span><span class="p">)</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">astm_times</span>

    <span class="c1">#</span>
    <span class="c1"># get data</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A convenience function which returns the Pandas Dataframe containing the read and processed calorimetry data.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pandas DataFrame</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Assuming that the calorimetry data is contained in a subfolder `data`, a conventional Pandas dataframe `df` containing the data from all calorimetry files in `data` can be obtained with the following code.</span>

<span class="sd">        &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">        &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">        &gt;&gt;&gt; df = tam.get_data()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="c1">#</span>
    <span class="c1"># get information</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            information, i.e. date of measurement, operator, comment ...</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>

    <span class="c1">#</span>
    <span class="c1"># get added metadata</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">         Returns</span>
<span class="sd">         -------</span>
<span class="sd">        tuple</span>
<span class="sd">             pd.DataFrame of metadata and string of the column used as ID (has to</span>
<span class="sd">             be unique).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span>

    <span class="c1">#</span>
    <span class="c1"># get sample names</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sample_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get list of sample names</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get list</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">()]</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">samples</span>

    <span class="c1">#</span>
    <span class="c1"># set</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_sample_to_mass</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        normalize &quot;heat_flow&quot; to a certain mass</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample_short : str</span>
<span class="sd">            &quot;sample_short&quot; name of sample to be normalized.</span>
<span class="sd">        mass_g : float</span>
<span class="sd">            mass in gram to which &quot;heat_flow_w&quot; are normalized.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># normalize &quot;heat_flow_w&quot; to sample mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span>
            <span class="o">/</span> <span class="n">mass_g</span>
        <span class="p">)</span>

        <span class="c1"># normalize &quot;heat_j&quot; to sample mass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;heat_j&quot;</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">mass_g</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># info</span>
        <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2"> normalized to </span><span class="si">{</span><span class="n">mass_g</span><span class="si">}</span><span class="s2">g sample.&quot;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># infer &quot;heat_j&quot; values</span>
    <span class="c1">#</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_infer_heat_j_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        helper function to calculate the &quot;heat_j&quot; columns from &quot;heat_flow_w&quot; and</span>
<span class="sd">        &quot;time_s&quot; columns</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># list of dfs</span>
        <span class="n">list_of_dfs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop samples</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">roi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
            <span class="c1"># check whether a &quot;native&quot; &quot;heat_j&quot;-column is available</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;heat_j&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="c1"># use as is</span>
                    <span class="n">list_of_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
                    <span class="c1"># go to next</span>
                    <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># info</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="c1"># info</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;==&gt; Inferring &quot;heat_j&quot; column for </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># get target rows</span>
            <span class="n">roi</span> <span class="o">=</span> <span class="n">roi</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">)</span>

            <span class="c1"># inferring cumulated heat using the &quot;trapezoidal integration method&quot;</span>

            <span class="c1"># introduce helpers</span>
            <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h1_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h2_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">roi</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># integrate</span>
            <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;heat_j&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h1_y&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h2_x&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

            <span class="c1"># clean</span>
            <span class="k">del</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h1_y&quot;</span><span class="p">],</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;_h2_x&quot;</span><span class="p">]</span>

            <span class="c1"># append to list</span>
            <span class="n">list_of_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>

        <span class="c1"># set data including &quot;heat_j&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_dfs</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># remove pickle files</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_pickle_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove pickle files if re-reading of source files needed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># remove files</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_data_pickle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_info_pickle</span><span class="p">]:</span>
            <span class="c1"># remove file</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># add metadata</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add an additional source of metadata the object. The source file is of</span>
<span class="sd">        type &quot;csv&quot; or &quot;xlsx&quot; and holds information on one sample per row. Columns</span>
<span class="sd">        can be named without restrictions.</span>

<span class="sd">        To allow for a mapping, the values occurring in self._data[&quot;sample_short&quot;]</span>
<span class="sd">        should appear in the source file. The column is declared via the keyword</span>
<span class="sd">        &quot;sample_id_colum&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            path to additonal metadata source file.</span>
<span class="sd">        sample_id_column : str</span>
<span class="sd">            column name in the additional source file matching self._data[&quot;sample_short&quot;].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">]:</span>
            <span class="c1"># info</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please use metadata files of type csv and xlsx only.&quot;</span><span class="p">)</span>
            <span class="c1"># return</span>
            <span class="k">return</span>

        <span class="c1"># read file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># read as Excel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># read as csv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># save mapper column</span>
        <span class="k">if</span> <span class="n">sample_id_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># save mapper column</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="n">sample_id_column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># raise custom Exception</span>
            <span class="k">raise</span> <span class="n">AddMetaDataSourceException</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1">#</span>
    <span class="c1"># get metadata group-by options</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_metadata_grouping_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a list of categories to group by in in &quot;self.plot_by_category&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            list of categories avaialble for grouping by.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get list based on column names of &quot;_metadata&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># average by metadata</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">average_by_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">group_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">meta_id</span><span class="o">=</span><span class="s2">&quot;experiment_nr&quot;</span><span class="p">,</span>
        <span class="n">data_id</span><span class="o">=</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span>
        <span class="n">time_average_window_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_average_log_bin_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_s_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">get_time_from</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">resampling_s</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;5s&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group_by : str | list[str]</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        meta_id : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is &quot;experiment_nr&quot;.</span>
<span class="sd">        data_id : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is &quot;sample_short&quot;.</span>
<span class="sd">        time_average_window_s : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is 60. The value is not(!) consindered if</span>
<span class="sd">            the keyword time_average_log_bin_count is specified</span>
<span class="sd">        get_time_from : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is &quot;left&quot;. further options: # &quot;mid&quot; &quot;right&quot;</span>

<span class="sd">        time_average_log_bin_count: number of bins if even spacing in logarithmic scale is applied</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get metadata</span>
        <span class="n">meta</span><span class="p">,</span> <span class="n">meta_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span>

        <span class="c1"># get data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

        <span class="c1"># make data equidistant grouped by sample_short</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">apply_resampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">resampling_s</span><span class="p">))</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># rename sample in &quot;data&quot; by metadata grouping options</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_by</span><span class="p">):</span>
            <span class="c1"># if one grouping level is used</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="c1"># modify data --&gt; replace &quot;sample_short&quot; with metadata group name</span>
                <span class="n">_idx_to_replace</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">meta_id</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_idx_to_replace</span><span class="p">,</span> <span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># if multiple grouping levels are used</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="c1"># modify data --&gt; replace &quot;sample_short&quot; with metadata group name</span>
                <span class="n">_idx_to_replace</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">meta_id</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_idx_to_replace</span><span class="p">,</span> <span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># sort experimentally detected times to &quot;bins&quot;</span>
        <span class="k">if</span> <span class="n">time_average_log_bin_count</span><span class="p">:</span>
            <span class="c1"># evenly spaced bins on log scale (geometric spacing)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_s_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">time_average_log_bin_count</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_average_window_s</span><span class="p">:</span>
            <span class="c1"># evenly spaced bins on linear scale with fixed width</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_s_max</span><span class="p">,</span> <span class="n">time_average_window_s</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;BIN&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># calculate average and std</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">data_id</span><span class="p">,</span> <span class="s2">&quot;BIN&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># calculate average and std</span>
            <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">data_id</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="c1"># &quot;flatten&quot; column names</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;BIN&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># regain &quot;time_s&quot; columns</span>
            <span class="k">if</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">left</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;mid&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">mid</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">right</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>

            <span class="c1"># remove &quot;BIN&quot; auxiliary column</span>
            <span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span>

        <span class="c1"># copy information to &quot;sample&quot; column --&gt; needed for plotting</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span>

        <span class="c1"># overwrite data with averaged data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">df</span>

    <span class="c1">#</span>
    <span class="c1"># undo action of &quot;average_by_metadata&quot;</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">undo_average_by_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        undo action of &quot;average_by_metadata&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set &quot;unprocessed&quot; data as exeperimental data / &quot;de-average&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># reset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># apply_tian_correction</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_tian_correction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>  <span class="c1"># tau=300, window=11, polynom=3, spline_smoothing_1st: float = 1e-9, spline_smoothing_2nd: float = 1e-9</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        apply_tian_correction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        processparams :</span>
<span class="sd">            ProcessingParameters object containing all processing parameters for calorimetry data.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># apply the correction for each sample</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
            <span class="c1"># get y-data</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
            <span class="c1"># NaN-handling in y-data</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># get x-data</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span>

            <span class="n">processor</span> <span class="o">=</span> <span class="n">HeatFlowProcessor</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span>

            <span class="n">dydx</span><span class="p">,</span> <span class="n">dy2dx2</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">calculate_heatflow_derivatives</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># calculate corrected heatflow</span>
                <span class="n">norm_hf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">dydx</span> <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># calculate corrected heatflow</span>
                <span class="n">norm_hf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">dydx</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                        <span class="o">+</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span>
                    <span class="p">)</span>
                    <span class="o">+</span> <span class="n">dy2dx2</span>
                    <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                    <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span>
                    <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g_tian&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">norm_hf</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;gradient_normalized_heat_flow_w_g&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">dydx</span>

            <span class="c1"># calculate corresponding cumulative heat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g_tian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">integrate</span><span class="o">.</span><span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">norm_hf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># undo Tian-correction</span>
    <span class="c1">#</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">undo_tian_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        undo_tian_correction; i.e. restore original data</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># call original restore function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undo_average_by_metadata</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_adaptive_downsampling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        apply adaptive downsampling to data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># define temporary empty DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># apply the correction for each sample</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
            <span class="c1"># print(d.sample_short[0])</span>
            <span class="c1"># print(len(d))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">])</span>

            <span class="n">processor</span> <span class="o">=</span> <span class="n">HeatFlowProcessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">restrict_data_range</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="c1"># apply adaptive downsampling</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">section_split</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">adaptive_downsample</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">,</span>
                    <span class="n">x_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
                    <span class="n">y_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
                    <span class="n">processparams</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">downsample_sections</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">,</span>
                    <span class="n">x_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
                    <span class="n">y_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
                    <span class="n">processparams</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>

        <span class="c1"># set data to downsampled data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_ascending_flank_tangent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">flank_fraction_start</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Start at 20% of peak height</span>
        <span class="n">flank_fraction_end</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># End at 80% of peak height</span>
        <span class="n">window_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Window size as fraction of flank range</span>
        <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Initial cutoff time in minutes to ignore</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine tangent to ascending flank of peak by averaging over sections.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_col : str</span>
<span class="sd">            Column containing heat flow data</span>
<span class="sd">        age_col : str</span>
<span class="sd">            Column containing time data</span>
<span class="sd">        flank_fraction_start : float</span>
<span class="sd">            Start of flank section as fraction of peak height (0-1)</span>
<span class="sd">        flank_fraction_end : float</span>
<span class="sd">            End of flank section as fraction of peak height (0-1)</span>
<span class="sd">        window_size : float</span>
<span class="sd">            Size of averaging window as fraction of flank time range</span>
<span class="sd">        cutoff_min : float, optional</span>
<span class="sd">            Initial cutoff time in minutes to ignore from analysis. If None,</span>
<span class="sd">            uses processparams.cutoff.cutoff_min. The default is None.</span>
<span class="sd">        show_plot : bool</span>
<span class="sd">            Whether to plot the results</span>
<span class="sd">        regex : str</span>
<span class="sd">            Regex to filter samples</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            DataFrame with tangent characteristics for each sample</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
            <span class="c1"># Apply cutoff if specified - use parameter cutoff_min first, then fallback to processparams</span>
            <span class="n">cutoff_time_min</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cutoff_min</span>
                <span class="k">if</span> <span class="n">cutoff_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">cutoff_time_min</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= @cutoff_time_min * 60&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Find the main peak</span>
            <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span>
                <span class="n">prominence</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">prominence</span><span class="p">,</span>
                <span class="n">distance</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No peak found in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Use the highest peak</span>
            <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">][</span><span class="n">target_col</span><span class="p">])]</span>
            <span class="n">peak_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">][</span><span class="n">age_col</span><span class="p">]</span>
            <span class="n">peak_value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">][</span><span class="n">target_col</span><span class="p">]</span>

            <span class="c1"># Find baseline (minimum before peak)</span>
            <span class="n">baseline_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">peak_time</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">baseline_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">baseline_value</span> <span class="o">=</span> <span class="n">baseline_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="c1"># Define flank region</span>
            <span class="n">flank_height_range</span> <span class="o">=</span> <span class="n">peak_value</span> <span class="o">-</span> <span class="n">baseline_value</span>
            <span class="n">flank_start_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">baseline_value</span> <span class="o">+</span> <span class="n">flank_fraction_start</span> <span class="o">*</span> <span class="n">flank_height_range</span>
            <span class="p">)</span>
            <span class="n">flank_end_value</span> <span class="o">=</span> <span class="n">baseline_value</span> <span class="o">+</span> <span class="n">flank_fraction_end</span> <span class="o">*</span> <span class="n">flank_height_range</span>

            <span class="c1"># Calculate gradient to ensure we only consider regions with positive slope</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">])</span>

            <span class="c1"># Extract ascending flank data - only include points with positive gradient</span>
            <span class="n">flank_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">flank_start_value</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">flank_end_value</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Only positive gradients</span>
            <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># If no positive gradient data in initial range, try to find the lowest point with positive gradient</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flank_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Find data points with positive gradient before peak</span>
                <span class="n">positive_gradient_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positive_gradient_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># Adjust flank start to the minimum value with positive gradient</span>
                    <span class="n">min_positive_value</span> <span class="o">=</span> <span class="n">positive_gradient_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">adjusted_flank_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flank_start_value</span><span class="p">,</span> <span class="n">min_positive_value</span><span class="p">)</span>

                    <span class="n">flank_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">adjusted_flank_start</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">flank_end_value</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                    <span class="c1"># Update the flank_start_value for recording</span>
                    <span class="n">flank_start_value</span> <span class="o">=</span> <span class="n">adjusted_flank_start</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flank_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient flank data in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Calculate moving tangents over windows</span>
            <span class="n">flank_time_range</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">window_time</span> <span class="o">=</span> <span class="n">window_size</span> <span class="o">*</span> <span class="n">flank_time_range</span>

            <span class="n">tangent_slopes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tangent_times</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tangent_values</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Slide window across flank</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">window_time</span>

            <span class="n">step_size</span> <span class="o">=</span> <span class="n">window_time</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># 10% overlap</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">start_time</span>

            <span class="k">while</span> <span class="n">current_time</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">:</span>
                <span class="n">window_end</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="n">window_time</span>
                <span class="n">window_data</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">current_time</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">window_end</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># Linear regression for this window</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">window_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">window_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

                    <span class="c1"># Use numpy polyfit for linear regression</span>
                    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="c1"># Only consider positive gradients (ascending flank)</span>
                    <span class="k">if</span> <span class="n">slope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Store tangent info at window center</span>
                        <span class="n">center_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">window_end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="n">center_value</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">center_time</span> <span class="o">+</span> <span class="n">intercept</span>

                        <span class="n">tangent_slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
                        <span class="n">tangent_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_time</span><span class="p">)</span>
                        <span class="n">tangent_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_value</span><span class="p">)</span>

                <span class="n">current_time</span> <span class="o">+=</span> <span class="n">step_size</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">tangent_slopes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No valid tangent windows with positive gradients found in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Calculate representative tangent (median to avoid outliers)</span>
            <span class="n">representative_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">)</span>
            <span class="n">representative_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_times</span><span class="p">)</span>
            <span class="n">representative_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_values</span><span class="p">)</span>

            <span class="c1"># Calculate tangent line parameters</span>
            <span class="c1"># y = mx + b, so b = y - mx</span>
            <span class="n">tangent_intercept</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">representative_value</span> <span class="o">-</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">representative_time</span>
            <span class="p">)</span>
            <span class="c1"># calculate x intection</span>
            <span class="c1"># y=0, so x = -b/m</span>
            <span class="n">x_intersection</span> <span class="o">=</span> <span class="p">(</span>
                <span class="o">-</span><span class="n">tangent_intercept</span> <span class="o">/</span> <span class="n">representative_slope</span> <span class="k">if</span> <span class="n">representative_slope</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>

            <span class="c1"># Calculate intersection with horizontal line at minimum before tangent_time_s</span>
            <span class="n">data_before_tangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">representative_time</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_before_tangent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">min_value_before_tangent</span> <span class="o">=</span> <span class="n">data_before_tangent</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="c1"># Intersection: y = min_value = slope * x + intercept</span>
                <span class="c1"># x = (y - intercept) / slope</span>
                <span class="n">x_intersection_min</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">min_value_before_tangent</span> <span class="o">-</span> <span class="n">tangent_intercept</span><span class="p">)</span> <span class="o">/</span> <span class="n">representative_slope</span> 
                    <span class="k">if</span> <span class="n">representative_slope</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_value_before_tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">x_intersection_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
                <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
                <span class="s2">&quot;peak_time_s&quot;</span><span class="p">:</span> <span class="n">peak_time</span><span class="p">,</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="n">peak_value</span><span class="p">,</span>
                <span class="s2">&quot;tangent_slope&quot;</span><span class="p">:</span> <span class="n">representative_slope</span><span class="p">,</span>
                <span class="s2">&quot;tangent_time_s&quot;</span><span class="p">:</span> <span class="n">representative_time</span><span class="p">,</span>
                <span class="s2">&quot;tangent_value&quot;</span><span class="p">:</span> <span class="n">representative_value</span><span class="p">,</span>
                <span class="s2">&quot;tangent_intercept&quot;</span><span class="p">:</span> <span class="n">tangent_intercept</span><span class="p">,</span>
                <span class="s2">&quot;flank_start_value&quot;</span><span class="p">:</span> <span class="n">flank_start_value</span><span class="p">,</span>
                <span class="s2">&quot;flank_end_value&quot;</span><span class="p">:</span> <span class="n">flank_end_value</span><span class="p">,</span>
                <span class="s2">&quot;n_windows&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">),</span>
                <span class="s2">&quot;slope_std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">),</span>
                <span class="s2">&quot;x_intersection&quot;</span><span class="p">:</span> <span class="n">x_intersection</span><span class="p">,</span>
                <span class="s2">&quot;min_value_before_tangent&quot;</span><span class="p">:</span> <span class="n">min_value_before_tangent</span><span class="p">,</span>
                <span class="s2">&quot;x_intersection_min&quot;</span><span class="p">:</span> <span class="n">x_intersection_min</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># Optional plotting</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

                <span class="c1"># Plot 1: Full curve with peak and flank region</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                    <span class="n">peak_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Peak&quot;</span>
                <span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">flank_start_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">flank_end_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span>
                    <span class="n">flank_start_value</span><span class="p">,</span>
                    <span class="n">flank_end_value</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flank region&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Plot tangent line</span>
                <span class="n">x_tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">peak_time</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">y_tangent</span> <span class="o">=</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">x_tangent</span> <span class="o">+</span> <span class="n">tangent_intercept</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">x_tangent</span><span class="p">,</span> <span class="n">y_tangent</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average tangent&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Add text label for tangent slope</span>
                <span class="n">mid_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_intersection</span> <span class="o">+</span> <span class="n">peak_time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">mid_y</span> <span class="o">=</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">mid_x</span> <span class="o">+</span> <span class="n">tangent_intercept</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Slope: </span><span class="si">{</span><span class="n">representative_slope</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">mid_x</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span>
                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Add vertical line and label for x_intersection</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x_intersection</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,)</span> 
                            <span class="c1">#    label=f&#39;X-intersection: {x_intersection:.0f}s&#39;)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x_intersection</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">baseline_value</span><span class="p">),</span>
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                        <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># Add horizontal line at minimum and its intersection with tangent</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">min_value_before_tangent</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">):</span>
                    <span class="c1"># Draw horizontal line at minimum value</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">min_value_before_tangent</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Min before tangent: </span><span class="si">{</span><span class="n">min_value_before_tangent</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="c1"># Add vertical line at intersection with minimum</span>
                    <span class="k">if</span> <span class="n">x_intersection_min</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">and</span> <span class="n">x_intersection_min</span> <span class="o">&lt;</span> <span class="n">peak_time</span><span class="p">:</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Min-int: </span><span class="si">{</span><span class="n">x_intersection_min</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">,</span> <span class="n">min_value_before_tangent</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span>
                            <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span>
                            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
                        <span class="p">)</span>

                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak Analysis: </span><span class="si">{</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="c1"># ax1.grid(True, alpha=0.3)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>

                <span class="c1"># Plot 2: Slope variation across windows</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tangent_times</span><span class="p">,</span> <span class="n">tangent_slopes</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
                    <span class="n">representative_slope</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Median slope: </span><span class="si">{</span><span class="n">representative_slope</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Window center time (s)&quot;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Local slope&quot;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Slope variation across flank windows&quot;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="c1"># ax2.grid(True, alpha=0.3)</span>
                <span class="c1"># ax2.set_ylim(0,)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">plotpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotpath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cold_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">processed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>intialize measurements from folder</p>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cold_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">processed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    intialize measurements from folder</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span> <span class="o">=</span> <span class="n">processed</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">ProcessingParameters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">processparams</span>

    <span class="c1"># read</span>
    <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cold_start</span><span class="p">:</span>
            <span class="c1"># get data and parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_and_parameters_from_folder</span><span class="p">(</span>
                <span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="n">show_info</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get data and parameters from pickled files</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_and_parameters_from_pickle</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                <span class="c1"># remove NaN values and merge time columns</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_auto_clean_data</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># info</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AutoCleanException</span>
            <span class="c1"># return</span>
            <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_adaptive_downsampling</span><span class="p">()</span>
    <span class="c1"># Message</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;================</span><span class="se">\n</span><span class="s2">Are you missing some samples? Try rerunning with auto_clean=True and cold_start=True.</span><span class="se">\n</span><span class="s2">=================&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.add_metadata_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_metadata_source</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>add an additional source of metadata the object. The source file is of
type "csv" or "xlsx" and holds information on one sample per row. Columns
can be named without restrictions.</p>
<p>To allow for a mapping, the values occurring in self._data["sample_short"]
should appear in the source file. The column is declared via the keyword
"sample_id_colum"</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to additonal metadata source file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sample_id_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>column name in the additional source file matching self._data["sample_short"].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    add an additional source of metadata the object. The source file is of</span>
<span class="sd">    type &quot;csv&quot; or &quot;xlsx&quot; and holds information on one sample per row. Columns</span>
<span class="sd">    can be named without restrictions.</span>

<span class="sd">    To allow for a mapping, the values occurring in self._data[&quot;sample_short&quot;]</span>
<span class="sd">    should appear in the source file. The column is declared via the keyword</span>
<span class="sd">    &quot;sample_id_colum&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file : str</span>
<span class="sd">        path to additonal metadata source file.</span>
<span class="sd">    sample_id_column : str</span>
<span class="sd">        column name in the additional source file matching self._data[&quot;sample_short&quot;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">]:</span>
        <span class="c1"># info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please use metadata files of type csv and xlsx only.&quot;</span><span class="p">)</span>
        <span class="c1"># return</span>
        <span class="k">return</span>

    <span class="c1"># read file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># read as Excel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># read as csv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># save mapper column</span>
    <span class="k">if</span> <span class="n">sample_id_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># save mapper column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="n">sample_id_column</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># raise custom Exception</span>
        <span class="k">raise</span> <span class="n">AddMetaDataSourceException</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.apply_tian_correction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_tian_correction</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>apply_tian_correction</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ProcessingParameters object containing all processing parameters for calorimetry data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_tian_correction</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>  <span class="c1"># tau=300, window=11, polynom=3, spline_smoothing_1st: float = 1e-9, spline_smoothing_2nd: float = 1e-9</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    apply_tian_correction</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    processparams :</span>
<span class="sd">        ProcessingParameters object containing all processing parameters for calorimetry data.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># apply the correction for each sample</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
        <span class="c1"># get y-data</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
        <span class="c1"># NaN-handling in y-data</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># get x-data</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span>

        <span class="n">processor</span> <span class="o">=</span> <span class="n">HeatFlowProcessor</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span>

        <span class="n">dydx</span><span class="p">,</span> <span class="n">dy2dx2</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">calculate_heatflow_derivatives</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># calculate corrected heatflow</span>
            <span class="n">norm_hf</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dydx</span> <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># calculate corrected heatflow</span>
            <span class="n">norm_hf</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dydx</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                    <span class="o">+</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="n">dy2dx2</span>
                <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau1</span>
                <span class="o">*</span> <span class="n">processparams</span><span class="o">.</span><span class="n">time_constants</span><span class="o">.</span><span class="n">tau2</span>
                <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g_tian&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">norm_hf</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;gradient_normalized_heat_flow_w_g&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">dydx</span>

        <span class="c1"># calculate corresponding cumulative heat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g_tian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">integrate</span><span class="o">.</span><span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">norm_hf</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.average_by_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_by_metadata</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="n">meta_id</span><span class="o">=</span><span class="s1">&#39;experiment_nr&#39;</span><span class="p">,</span> <span class="n">data_id</span><span class="o">=</span><span class="s1">&#39;sample_short&#39;</span><span class="p">,</span> <span class="n">time_average_window_s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_average_log_bin_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_s_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">get_time_from</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">resampling_s</span><span class="o">=</span><span class="s1">&#39;5s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>group_by</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>meta_id</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is "experiment_nr".</p>
              </div>
            </td>
            <td>
                  <code>&#39;experiment_nr&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_id</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is "sample_short".</p>
              </div>
            </td>
            <td>
                  <code>&#39;sample_short&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_average_window_s</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is 60. The value is not(!) consindered if
the keyword time_average_log_bin_count is specified</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_time_from</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is "left". further options: # "mid" "right"</p>
              </div>
            </td>
            <td>
                  <code>&#39;left&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_average_log_bin_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">average_by_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">group_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">meta_id</span><span class="o">=</span><span class="s2">&quot;experiment_nr&quot;</span><span class="p">,</span>
    <span class="n">data_id</span><span class="o">=</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span>
    <span class="n">time_average_window_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_average_log_bin_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_s_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
    <span class="n">get_time_from</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">resampling_s</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;5s&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    group_by : str | list[str]</span>
<span class="sd">        DESCRIPTION.</span>
<span class="sd">    meta_id : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is &quot;experiment_nr&quot;.</span>
<span class="sd">    data_id : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is &quot;sample_short&quot;.</span>
<span class="sd">    time_average_window_s : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is 60. The value is not(!) consindered if</span>
<span class="sd">        the keyword time_average_log_bin_count is specified</span>
<span class="sd">    get_time_from : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is &quot;left&quot;. further options: # &quot;mid&quot; &quot;right&quot;</span>

<span class="sd">    time_average_log_bin_count: number of bins if even spacing in logarithmic scale is applied</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get metadata</span>
    <span class="n">meta</span><span class="p">,</span> <span class="n">meta_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span>

    <span class="c1"># get data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="c1"># make data equidistant grouped by sample_short</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_id</span><span class="p">)</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">apply_resampling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">resampling_s</span><span class="p">))</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># rename sample in &quot;data&quot; by metadata grouping options</span>
    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_by</span><span class="p">):</span>
        <span class="c1"># if one grouping level is used</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># modify data --&gt; replace &quot;sample_short&quot; with metadata group name</span>
            <span class="n">_idx_to_replace</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">meta_id</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_idx_to_replace</span><span class="p">,</span> <span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># if multiple grouping levels are used</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># modify data --&gt; replace &quot;sample_short&quot; with metadata group name</span>
            <span class="n">_idx_to_replace</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">meta_id</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_idx_to_replace</span><span class="p">,</span> <span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># sort experimentally detected times to &quot;bins&quot;</span>
    <span class="k">if</span> <span class="n">time_average_log_bin_count</span><span class="p">:</span>
        <span class="c1"># evenly spaced bins on log scale (geometric spacing)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_s_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">time_average_log_bin_count</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">time_average_window_s</span><span class="p">:</span>
        <span class="c1"># evenly spaced bins on linear scale with fixed width</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_s_max</span><span class="p">,</span> <span class="n">time_average_window_s</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;BIN&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># calculate average and std</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">data_id</span><span class="p">,</span> <span class="s2">&quot;BIN&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># calculate average and std</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">data_id</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># &quot;flatten&quot; column names</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;BIN&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># regain &quot;time_s&quot; columns</span>
        <span class="k">if</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">left</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;mid&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">mid</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">get_time_from</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">right</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]]</span>

        <span class="c1"># remove &quot;BIN&quot; auxiliary column</span>
        <span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;BIN&quot;</span><span class="p">]</span>

    <span class="c1"># copy information to &quot;sample&quot; column --&gt; needed for plotting</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span>

    <span class="c1"># overwrite data with averaged data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_ascending_flank_tangent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ascending_flank_tangent</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">flank_fraction_start</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">flank_fraction_end</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotpath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine tangent to ascending flank of peak by averaging over sections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column containing heat flow data</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>age_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column containing time data</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_s&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flank_fraction_start</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start of flank section as fraction of peak height (0-1)</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flank_fraction_end</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End of flank section as fraction of peak height (0-1)</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of averaging window as fraction of flank time range</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff_min</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial cutoff time in minutes to ignore from analysis. If None,
uses processparams.cutoff.cutoff_min. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the results</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex to filter samples</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with tangent characteristics for each sample</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ascending_flank_tangent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">flank_fraction_start</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Start at 20% of peak height</span>
    <span class="n">flank_fraction_end</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># End at 80% of peak height</span>
    <span class="n">window_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Window size as fraction of flank range</span>
    <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Initial cutoff time in minutes to ignore</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plotpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine tangent to ascending flank of peak by averaging over sections.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target_col : str</span>
<span class="sd">        Column containing heat flow data</span>
<span class="sd">    age_col : str</span>
<span class="sd">        Column containing time data</span>
<span class="sd">    flank_fraction_start : float</span>
<span class="sd">        Start of flank section as fraction of peak height (0-1)</span>
<span class="sd">    flank_fraction_end : float</span>
<span class="sd">        End of flank section as fraction of peak height (0-1)</span>
<span class="sd">    window_size : float</span>
<span class="sd">        Size of averaging window as fraction of flank time range</span>
<span class="sd">    cutoff_min : float, optional</span>
<span class="sd">        Initial cutoff time in minutes to ignore from analysis. If None,</span>
<span class="sd">        uses processparams.cutoff.cutoff_min. The default is None.</span>
<span class="sd">    show_plot : bool</span>
<span class="sd">        Whether to plot the results</span>
<span class="sd">    regex : str</span>
<span class="sd">        Regex to filter samples</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        DataFrame with tangent characteristics for each sample</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="c1"># Apply cutoff if specified - use parameter cutoff_min first, then fallback to processparams</span>
        <span class="n">cutoff_time_min</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cutoff_min</span>
            <span class="k">if</span> <span class="n">cutoff_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">cutoff_time_min</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= @cutoff_time_min * 60&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Find the main peak</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span>
            <span class="n">prominence</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">prominence</span><span class="p">,</span>
            <span class="n">distance</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No peak found in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Use the highest peak</span>
        <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">][</span><span class="n">target_col</span><span class="p">])]</span>
        <span class="n">peak_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">][</span><span class="n">age_col</span><span class="p">]</span>
        <span class="n">peak_value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">][</span><span class="n">target_col</span><span class="p">]</span>

        <span class="c1"># Find baseline (minimum before peak)</span>
        <span class="n">baseline_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">peak_time</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">baseline_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baseline_value</span> <span class="o">=</span> <span class="n">baseline_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="c1"># Define flank region</span>
        <span class="n">flank_height_range</span> <span class="o">=</span> <span class="n">peak_value</span> <span class="o">-</span> <span class="n">baseline_value</span>
        <span class="n">flank_start_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">baseline_value</span> <span class="o">+</span> <span class="n">flank_fraction_start</span> <span class="o">*</span> <span class="n">flank_height_range</span>
        <span class="p">)</span>
        <span class="n">flank_end_value</span> <span class="o">=</span> <span class="n">baseline_value</span> <span class="o">+</span> <span class="n">flank_fraction_end</span> <span class="o">*</span> <span class="n">flank_height_range</span>

        <span class="c1"># Calculate gradient to ensure we only consider regions with positive slope</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">])</span>

        <span class="c1"># Extract ascending flank data - only include points with positive gradient</span>
        <span class="n">flank_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
            <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">flank_start_value</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">flank_end_value</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Only positive gradients</span>
        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># If no positive gradient data in initial range, try to find the lowest point with positive gradient</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flank_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Find data points with positive gradient before peak</span>
            <span class="n">positive_gradient_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positive_gradient_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Adjust flank start to the minimum value with positive gradient</span>
                <span class="n">min_positive_value</span> <span class="o">=</span> <span class="n">positive_gradient_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">adjusted_flank_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">flank_start_value</span><span class="p">,</span> <span class="n">min_positive_value</span><span class="p">)</span>

                <span class="n">flank_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">adjusted_flank_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">flank_end_value</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peak_time</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># Update the flank_start_value for recording</span>
                <span class="n">flank_start_value</span> <span class="o">=</span> <span class="n">adjusted_flank_start</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flank_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient flank data in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Calculate moving tangents over windows</span>
        <span class="n">flank_time_range</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">window_time</span> <span class="o">=</span> <span class="n">window_size</span> <span class="o">*</span> <span class="n">flank_time_range</span>

        <span class="n">tangent_slopes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tangent_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tangent_values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Slide window across flank</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">window_time</span>

        <span class="n">step_size</span> <span class="o">=</span> <span class="n">window_time</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># 10% overlap</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">start_time</span>

        <span class="k">while</span> <span class="n">current_time</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="n">window_end</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="n">window_time</span>
            <span class="n">window_data</span> <span class="o">=</span> <span class="n">flank_data</span><span class="p">[</span>
                <span class="p">(</span><span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">current_time</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">window_end</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Linear regression for this window</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">window_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">window_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

                <span class="c1"># Use numpy polyfit for linear regression</span>
                <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Only consider positive gradients (ascending flank)</span>
                <span class="k">if</span> <span class="n">slope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Store tangent info at window center</span>
                    <span class="n">center_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">window_end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">center_value</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">center_time</span> <span class="o">+</span> <span class="n">intercept</span>

                    <span class="n">tangent_slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
                    <span class="n">tangent_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_time</span><span class="p">)</span>
                    <span class="n">tangent_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_value</span><span class="p">)</span>

            <span class="n">current_time</span> <span class="o">+=</span> <span class="n">step_size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tangent_slopes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No valid tangent windows with positive gradients found in </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Calculate representative tangent (median to avoid outliers)</span>
        <span class="n">representative_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">)</span>
        <span class="n">representative_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_times</span><span class="p">)</span>
        <span class="n">representative_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tangent_values</span><span class="p">)</span>

        <span class="c1"># Calculate tangent line parameters</span>
        <span class="c1"># y = mx + b, so b = y - mx</span>
        <span class="n">tangent_intercept</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">representative_value</span> <span class="o">-</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">representative_time</span>
        <span class="p">)</span>
        <span class="c1"># calculate x intection</span>
        <span class="c1"># y=0, so x = -b/m</span>
        <span class="n">x_intersection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">tangent_intercept</span> <span class="o">/</span> <span class="n">representative_slope</span> <span class="k">if</span> <span class="n">representative_slope</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span>

        <span class="c1"># Calculate intersection with horizontal line at minimum before tangent_time_s</span>
        <span class="n">data_before_tangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">representative_time</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_before_tangent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">min_value_before_tangent</span> <span class="o">=</span> <span class="n">data_before_tangent</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="c1"># Intersection: y = min_value = slope * x + intercept</span>
            <span class="c1"># x = (y - intercept) / slope</span>
            <span class="n">x_intersection_min</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">min_value_before_tangent</span> <span class="o">-</span> <span class="n">tangent_intercept</span><span class="p">)</span> <span class="o">/</span> <span class="n">representative_slope</span> 
                <span class="k">if</span> <span class="n">representative_slope</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_value_before_tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">x_intersection_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
            <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
            <span class="s2">&quot;peak_time_s&quot;</span><span class="p">:</span> <span class="n">peak_time</span><span class="p">,</span>
            <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="n">peak_value</span><span class="p">,</span>
            <span class="s2">&quot;tangent_slope&quot;</span><span class="p">:</span> <span class="n">representative_slope</span><span class="p">,</span>
            <span class="s2">&quot;tangent_time_s&quot;</span><span class="p">:</span> <span class="n">representative_time</span><span class="p">,</span>
            <span class="s2">&quot;tangent_value&quot;</span><span class="p">:</span> <span class="n">representative_value</span><span class="p">,</span>
            <span class="s2">&quot;tangent_intercept&quot;</span><span class="p">:</span> <span class="n">tangent_intercept</span><span class="p">,</span>
            <span class="s2">&quot;flank_start_value&quot;</span><span class="p">:</span> <span class="n">flank_start_value</span><span class="p">,</span>
            <span class="s2">&quot;flank_end_value&quot;</span><span class="p">:</span> <span class="n">flank_end_value</span><span class="p">,</span>
            <span class="s2">&quot;n_windows&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">),</span>
            <span class="s2">&quot;slope_std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">tangent_slopes</span><span class="p">),</span>
            <span class="s2">&quot;x_intersection&quot;</span><span class="p">:</span> <span class="n">x_intersection</span><span class="p">,</span>
            <span class="s2">&quot;min_value_before_tangent&quot;</span><span class="p">:</span> <span class="n">min_value_before_tangent</span><span class="p">,</span>
            <span class="s2">&quot;x_intersection_min&quot;</span><span class="p">:</span> <span class="n">x_intersection_min</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Optional plotting</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

            <span class="c1"># Plot 1: Full curve with peak and flank region</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                <span class="n">peak_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Peak&quot;</span>
            <span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">flank_start_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">flank_end_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">flank_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span>
                <span class="n">flank_start_value</span><span class="p">,</span>
                <span class="n">flank_end_value</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flank region&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Plot tangent line</span>
            <span class="n">x_tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">peak_time</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">y_tangent</span> <span class="o">=</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">x_tangent</span> <span class="o">+</span> <span class="n">tangent_intercept</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">x_tangent</span><span class="p">,</span> <span class="n">y_tangent</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average tangent&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Add text label for tangent slope</span>
            <span class="n">mid_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_intersection</span> <span class="o">+</span> <span class="n">peak_time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">mid_y</span> <span class="o">=</span> <span class="n">representative_slope</span> <span class="o">*</span> <span class="n">mid_x</span> <span class="o">+</span> <span class="n">tangent_intercept</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Slope: </span><span class="si">{</span><span class="n">representative_slope</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">mid_x</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Add vertical line and label for x_intersection</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x_intersection</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,)</span> 
                        <span class="c1">#    label=f&#39;X-intersection: {x_intersection:.0f}s&#39;)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x_intersection</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_intersection</span><span class="p">,</span> <span class="n">baseline_value</span><span class="p">),</span>
                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="c1"># Add horizontal line at minimum and its intersection with tangent</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">min_value_before_tangent</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">):</span>
                <span class="c1"># Draw horizontal line at minimum value</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">min_value_before_tangent</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                           <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Min before tangent: </span><span class="si">{</span><span class="n">min_value_before_tangent</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># Add vertical line at intersection with minimum</span>
                <span class="k">if</span> <span class="n">x_intersection_min</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">and</span> <span class="n">x_intersection_min</span> <span class="o">&lt;</span> <span class="n">peak_time</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Min-int: </span><span class="si">{</span><span class="n">x_intersection_min</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_intersection_min</span><span class="p">,</span> <span class="n">min_value_before_tangent</span><span class="p">),</span>
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span>
                        <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak Analysis: </span><span class="si">{</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="c1"># ax1.grid(True, alpha=0.3)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>

            <span class="c1"># Plot 2: Slope variation across windows</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tangent_times</span><span class="p">,</span> <span class="n">tangent_slopes</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
                <span class="n">representative_slope</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Median slope: </span><span class="si">{</span><span class="n">representative_slope</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Window center time (s)&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Local slope&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Slope variation across flank windows&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="c1"># ax2.grid(True, alpha=0.3)</span>
            <span class="c1"># ax2.set_ylim(0,)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">plotpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotpath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_astm_c1679_characteristics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">individual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get characteristics according to ASTM C1679. Compiles a list of data
points at half-maximum "normalized heat flow", wherein the half maximum
is either determined for each individual heat flow curve individually
or as the mean value if the heat flow curves considered.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>individual</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataclass containing parameters which control the processing of the calorimetry data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Pandas Dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Assuming that the calorimetry data is contained in a subfolder <code>data</code>, the time according to ASTM c1679 can be obtained by</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="kn">import</span> <span class="n">tacalorimetry</span> <span class="k">as</span> <span class="n">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">thepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">astm</span> <span class="o">=</span> <span class="n">tam</span><span class="o">.</span><span class="n">get_astm_c1679_characteristics</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_astm_c1679_characteristics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">individual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get characteristics according to ASTM C1679. Compiles a list of data</span>
<span class="sd">    points at half-maximum &quot;normalized heat flow&quot;, wherein the half maximum</span>
<span class="sd">    is either determined for each individual heat flow curve individually</span>
<span class="sd">    or as the mean value if the heat flow curves considered.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    individual : bool, optional</span>
<span class="sd">        DESCRIPTION. The default is False.</span>
<span class="sd">    processparams: ProcessingParameters</span>
<span class="sd">        Dataclass containing parameters which control the processing of the calorimetry data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas Dataframe</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Assuming that the calorimetry data is contained in a subfolder `data`, the time according to ASTM c1679 can be obtained by</span>

<span class="sd">    &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">    &gt;&gt;&gt; astm = tam.get_astm_c1679_characteristics()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get peaks</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">4e5</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># sort peaks by ascending normalized heat flow</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># select highest peak --&gt; ASTM C1679</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>

    <span class="c1"># get data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

    <span class="c1"># init empty list for collecting characteristics</span>
    <span class="n">astm_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="c1"># pick sample data</span>
        <span class="n">helper</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span><span class="p">]</span>
        <span class="n">helper_df</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># check if peak was found</span>
        <span class="k">if</span> <span class="n">peaks</span><span class="p">[</span><span class="n">peaks</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">sample_short</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># manually set time to NaN to indicate that no peak was found</span>
            <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># restrict to times before the peak</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">sample</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">]]</span>

            <span class="c1"># restrict to relevant heatflows the peak</span>
            <span class="k">if</span> <span class="n">individual</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span>
                    <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
                    <span class="o">&lt;=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">sample</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.50</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># use half-maximum average</span>
                <span class="n">helper</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span>
                    <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span>
                    <span class="o">&lt;=</span> <span class="n">peaks</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.50</span>
                <span class="p">]</span>

            <span class="c1"># add to list of of selected points</span>
        <span class="n">astm_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="c1"># plot</span>
            <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">helper_df</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot; $t_</span><span class="si">{ASTM}</span><span class="s2">$ =&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">helper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;time_s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># build overall DataFrame</span>
    <span class="n">astm_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">astm_times</span><span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">astm_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_average_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_slope</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate average slope by determining 4 additional slope values between 
onset time and heat flow maximum, in addition to the maximum slope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingParameters


  
      dataclass
   (calocem.processparams.ProcessingParameters)" href="#calocem.tacalorimetry.ProcessingParameters">ProcessingParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing parameters for analysis</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target measurement column, by default "normalized_heat_flow_w_g"</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>age_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time column name, by default "time_s"</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_s&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex pattern to filter samples, by default None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show plots, by default False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing axis to plot on, by default None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_path</code>
            </td>
            <td>
                  <code><span title="Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save plots, by default None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xscale</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X-axis scale, by default "log"</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xunit</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time unit for display, by default "s"</p>
              </div>
            </td>
            <td>
                  <code>&#39;s&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing average slope characteristics for each sample</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_slope</span><span class="p">(</span>
<span class="bp">self</span><span class="p">,</span>
<span class="n">processparams</span><span class="p">,</span>
<span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
<span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
<span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate average slope by determining 4 additional slope values between </span>
<span class="sd">    onset time and heat flow maximum, in addition to the maximum slope.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    processparams : ProcessingParameters</span>
<span class="sd">        Processing parameters for analysis</span>
<span class="sd">    target_col : str, optional</span>
<span class="sd">        Target measurement column, by default &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">    age_col : str, optional</span>
<span class="sd">        Time column name, by default &quot;time_s&quot;</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        Regex pattern to filter samples, by default None</span>
<span class="sd">    show_plot : bool, optional</span>
<span class="sd">        Whether to show plots, by default False</span>
<span class="sd">    ax : matplotlib.axes.Axes, optional</span>
<span class="sd">        Existing axis to plot on, by default None</span>
<span class="sd">    save_path : Path, optional</span>
<span class="sd">        Path to save plots, by default None</span>
<span class="sd">    xscale : str, optional</span>
<span class="sd">        X-axis scale, by default &quot;log&quot;</span>
<span class="sd">    xunit : str, optional</span>
<span class="sd">        Time unit for display, by default &quot;s&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        DataFrame containing average slope characteristics for each sample</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get maximum slopes using existing method</span>
    <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
        <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">max_slopes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maximum slopes found. Cannot calculate average slopes.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Get onset times using the peak onset method</span>
    <span class="n">onsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">onsets</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No onset times found. Cannot calculate average slopes.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop through samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="n">sample_short</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

        <span class="c1"># Get max slope data for this sample</span>
        <span class="n">max_slope_row</span> <span class="o">=</span> <span class="n">max_slopes</span><span class="p">[</span><span class="n">max_slopes</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_slope_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Get onset data for this sample</span>
        <span class="n">onset_row</span> <span class="o">=</span> <span class="n">onsets</span><span class="p">[</span><span class="n">onsets</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">onset_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Get time points</span>
        <span class="n">onset_time</span> <span class="o">=</span> <span class="n">onset_row</span><span class="p">[</span><span class="s2">&quot;onset_time_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_slope_time</span> <span class="o">=</span> <span class="n">max_slope_row</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Find heat flow maximum after onset</span>
        <span class="n">data_after_onset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">onset_time</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_after_onset</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">max_hf_time</span> <span class="o">=</span> <span class="n">data_after_onset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_after_onset</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">age_col</span><span class="p">]</span>

        <span class="c1"># Create 4 intermediate time points between onset and heat flow maximum</span>
        <span class="k">if</span> <span class="n">max_hf_time</span> <span class="o">&lt;=</span> <span class="n">onset_time</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Heat flow maximum occurs before onset for </span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Create 6 time points total (onset, 4 intermediate, max_hf)</span>
        <span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">onset_time</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">max_hf_time</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Calculate slopes at each interval</span>
        <span class="n">slopes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">slope_times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">time_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get data points in this interval</span>
            <span class="n">interval_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t2</span><span class="p">)]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Calculate slope using linear regression</span>
            <span class="n">x_vals</span> <span class="o">=</span> <span class="n">interval_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">y_vals</span> <span class="o">=</span> <span class="n">interval_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1"># Simple slope calculation: (y2 - y1) / (x2 - x1)</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
            <span class="n">slope_times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Midpoint time</span>

        <span class="c1"># Include the maximum slope</span>
        <span class="n">max_slope_value</span> <span class="o">=</span> <span class="n">max_slope_row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_slope_value</span><span class="p">)</span>
        <span class="n">slope_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_slope_time</span><span class="p">)</span>

        <span class="c1"># Calculate average slope</span>
        <span class="k">if</span> <span class="n">slopes</span><span class="p">:</span>
            <span class="n">avg_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>
            <span class="n">std_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span>

            <span class="c1"># Create characteristics dictionary</span>
            <span class="n">characteristics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
                <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">sample_short</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_s&quot;</span><span class="p">:</span> <span class="n">onset_time</span><span class="p">,</span>
                <span class="s2">&quot;max_hf_time_s&quot;</span><span class="p">:</span> <span class="n">max_hf_time</span><span class="p">,</span>
                <span class="s2">&quot;max_slope_time_s&quot;</span><span class="p">:</span> <span class="n">max_slope_time</span><span class="p">,</span>
                <span class="s2">&quot;max_slope_value&quot;</span><span class="p">:</span> <span class="n">max_slope_value</span><span class="p">,</span>
                <span class="s2">&quot;average_slope&quot;</span><span class="p">:</span> <span class="n">avg_slope</span><span class="p">,</span>
                <span class="s2">&quot;slope_std&quot;</span><span class="p">:</span> <span class="n">std_slope</span><span class="p">,</span>
                <span class="s2">&quot;n_slopes&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">slopes</span><span class="p">),</span>
                <span class="s2">&quot;individual_slopes&quot;</span><span class="p">:</span> <span class="n">slopes</span><span class="p">,</span>
                <span class="s2">&quot;slope_times&quot;</span><span class="p">:</span> <span class="n">slope_times</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Optional plotting</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_average_slope_analysis</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">characteristics</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> 
                    <span class="n">sample_short</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">xunit</span>
                <span class="p">)</span>

            <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_characteristics</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No average slope characteristics calculated.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Convert to DataFrame</span>
    <span class="n">avg_slope_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">avg_slope_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_cumulated_heat_at_hours" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cumulated_heat_at_hours</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get the cumulated heat flow a at a certain age</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingParameters


  
      dataclass
   (calocem.processparams.ProcessingParameters)" href="#calocem.tacalorimetry.ProcessingParameters">ProcessingParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing parameters. The default is None. If None, the default
parameters are used. The most important parameter is the cutoff time
in minutes which describes the initial time period of the measurement
which is not considered for the cumulated heat flow. It is defined in
the ProcessingParameters class. The default value is 30 minutes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_h</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>end time in hourscv</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>A Pandas dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cumulated_heat_at_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the cumulated heat flow a at a certain age</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    processparams : ProcessingParameters, optional</span>
<span class="sd">        Processing parameters. The default is None. If None, the default</span>
<span class="sd">        parameters are used. The most important parameter is the cutoff time</span>
<span class="sd">        in minutes which describes the initial time period of the measurement</span>
<span class="sd">        which is not considered for the cumulated heat flow. It is defined in</span>
<span class="sd">        the ProcessingParameters class. The default value is 30 minutes.</span>

<span class="sd">    target_h : int | float</span>
<span class="sd">        end time in hourscv</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A Pandas dataframe</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;cutoff_min&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The cutoff_min parameter is deprecated. Please use the ProcessingParameters class instead.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">processparams</span><span class="p">:</span>
            <span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
        <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">applicable</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># convert target time to seconds</span>
        <span class="n">target_s</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">*</span> <span class="n">target_h</span>
        <span class="c1"># helper</span>
        <span class="n">_helper</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &lt;= @target_s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># get heat at target time</span>
        <span class="n">hf_at_target</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># if cutoff time specified</span>
        <span class="k">if</span> <span class="n">cutoff_min</span><span class="p">:</span>
            <span class="c1"># convert target time to seconds</span>
            <span class="n">target_s</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">cutoff_min</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># helper</span>
                <span class="n">_helper</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &lt;= @target_s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># type conversion</span>
                <span class="n">hf_at_cutoff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_helper</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># correct heatflow for heatflow at cutoff</span>
                <span class="n">hf_at_target</span> <span class="o">=</span> <span class="n">hf_at_target</span> <span class="o">-</span> <span class="n">hf_at_cutoff</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">name_wt_nan</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found NaN in Normalized heat of sample </span><span class="si">{</span><span class="n">name_wt_nan</span><span class="si">}</span><span class="s2"> searching for cumulated heat at </span><span class="si">{</span><span class="n">target_h</span><span class="si">}</span><span class="s2">h and a cutoff of </span><span class="si">{</span><span class="n">cutoff_min</span><span class="si">}</span><span class="s2">min.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">hf_at_target</span>

    <span class="c1"># in case of one specified time</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># groupby</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)[[</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">applicable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="n">target_h</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># rename</span>
        <span class="n">results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulated_heat_at_hours&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;target_h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_h</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutoff_min</span>

    <span class="c1"># in case of specified list of times</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_h</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># init list</span>
        <span class="n">list_of_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># loop</span>
        <span class="k">for</span> <span class="n">this_target_h</span> <span class="ow">in</span> <span class="n">target_h</span><span class="p">:</span>
            <span class="c1"># groupby</span>
            <span class="n">_results</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)[[</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]]</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">applicable</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="n">this_target_h</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># rename</span>
            <span class="n">_results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulated_heat_at_hours&quot;</span><span class="p">]</span>
            <span class="n">_results</span><span class="p">[</span><span class="s2">&quot;target_h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_target_h</span>
            <span class="n">_results</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutoff_min</span>
            <span class="c1"># append to list</span>
            <span class="n">list_of_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_results</span><span class="p">)</span>
        <span class="c1"># build overall results DataFrame</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_results</span><span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A convenience function which returns the Pandas Dataframe containing the read and processed calorimetry data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Pandas DataFrame</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Assuming that the calorimetry data is contained in a subfolder <code>data</code>, a conventional Pandas dataframe <code>df</code> containing the data from all calorimetry files in <code>data</code> can be obtained with the following code.</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="kn">import</span> <span class="n">tacalorimetry</span> <span class="k">as</span> <span class="n">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">thepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">tam</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A convenience function which returns the Pandas Dataframe containing the read and processed calorimetry data.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas DataFrame</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Assuming that the calorimetry data is contained in a subfolder `data`, a conventional Pandas dataframe `df` containing the data from all calorimetry files in `data` can be obtained with the following code.</span>

<span class="sd">    &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">    &gt;&gt;&gt; df = tam.get_data()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_dormant_period_heatflow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dormant_period_heatflow</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">plot_right_boundary</span><span class="o">=</span><span class="mf">200000.0</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get dormant period heatflow</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex which can be used to filter the data, i.e., only the patterns which fit the regex will be evaluated. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff_min</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time at the start of the experiment which will be cutoff from analysis. This can be useful for ex-situ mixed samples. The default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upper_dormant_thresh_w_g</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter which controls the upper limit for the plotting option. The default is 0.001.</p>
              </div>
            </td>
            <td>
                  <code>0.002</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set to true, the data is plotted. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Pandas Dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dormant_period_heatflow</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cutoff_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">upper_dormant_thresh_w_g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">plot_right_boundary</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span>
    <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get dormant period heatflow</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        Regex which can be used to filter the data, i.e., only the patterns which fit the regex will be evaluated. The default is None.</span>
<span class="sd">    cutoff_min : int | float, optional</span>
<span class="sd">        Time at the start of the experiment which will be cutoff from analysis. This can be useful for ex-situ mixed samples. The default is 5.</span>
<span class="sd">    upper_dormant_thresh_w_g : float, optional</span>
<span class="sd">        Parameter which controls the upper limit for the plotting option. The default is 0.001.</span>
<span class="sd">    show_plot : bool, optional</span>
<span class="sd">        If set to true, the data is plotted. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas Dataframe</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># init results list</span>
    <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="c1"># get peak as &quot;right border&quot;</span>
        <span class="n">_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span>
            <span class="n">processparams</span><span class="p">,</span>
            <span class="c1"># cutoff_min=cutoff_min,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="c1"># prominence=processparams.gradient_peak_prominence, # prominence,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># identify &quot;dormant period&quot; as range between initial spike</span>
        <span class="c1"># and first reaction peak</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="c1"># plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">],</span>
                <span class="c1"># linestyle=&quot;&quot;,</span>
                <span class="c1"># marker=&quot;o&quot;,</span>
            <span class="p">)</span>

        <span class="c1"># discard points at early age</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt;= @processparams.cutoff.cutoff_min * 60&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_peaks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># discard points after the first peak</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;time_s &lt;= @_peaks[&quot;time_s&quot;].min()&#39;</span><span class="p">)</span>

        <span class="c1"># reset index</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># pick relevant points at minimum heat flow</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="c1"># guide to the eye lines</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="c1"># indicate cutoff time</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cutoff_min</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="c1"># limits</span>
            <span class="c1"># plt.xlim(0, _peaks[&quot;time_s&quot;].min())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">plot_right_boundary</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span><span class="p">)</span>
            <span class="c1"># title</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
            <span class="c1"># show</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># add to list</span>
        <span class="n">list_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># convert to overall datafram</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_information" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_information</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get information</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>information, i.e. date of measurement, operator, comment ...</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get information</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        information, i.e. date of measurement, operator, comment ...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_maximum_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_maximum_slope</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_start_c3s</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The method finds the point in time of the maximum slope. It also calculates the gradient at this point. The method can be controlled by passing a customized ProcessingParameters object for the <code>processparams</code> parameter. If no object is passed, the default parameters will be used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>measured quantity within which peak onsets are searched for. The default is "normalized_heat_flow_w_g"</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>age_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time unit within which peak onsets are searched for. The default is "time_s"</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_s&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_discarded_s</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</p>
              </div>
            </td>
            <td>
                  <code>900</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag whether or not to plot peak picking for each sample. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_discarded_time</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to discard the experimental values obtained before "time_discarded_s" also in the visualization. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regex pattern to include only certain experimental result files during initialization. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Pandas Dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe that contains the time and the gradient of the maximum slope.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="kn">import</span> <span class="n">tacalorimetry</span> <span class="k">as</span> <span class="n">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">thepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">thepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">ProcessingParameters</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processparams</span><span class="o">..</span><span class="n">apply</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_slopes</span> <span class="o">=</span> <span class="n">tam</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_maximum_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">read_start_c3s</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The method finds the point in time of the maximum slope. It also calculates the gradient at this point. The method can be controlled by passing a customized ProcessingParameters object for the `processparams` parameter. If no object is passed, the default parameters will be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target_col : str, optional</span>
<span class="sd">        measured quantity within which peak onsets are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">    age_col : str, optional</span>
<span class="sd">        Time unit within which peak onsets are searched for. The default is &quot;time_s&quot;</span>
<span class="sd">    time_discarded_s : int | float, optional</span>
<span class="sd">        Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</span>
<span class="sd">    show_plot : bool, optional</span>
<span class="sd">        Flag whether or not to plot peak picking for each sample. The default is False.</span>
<span class="sd">    exclude_discarded_time : bool, optional</span>
<span class="sd">        Whether or not to discard the experimental values obtained before &quot;time_discarded_s&quot; also in the visualization. The default is False.</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        regex pattern to include only certain experimental result files during initialization. The default is None.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas Dataframe</span>
<span class="sd">        A dataframe that contains the time and the gradient of the maximum slope.</span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from CaloCem import tacalorimetry as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>

<span class="sd">    &gt;&gt;&gt; thepath = Path(__file__).parent / &quot;data&quot;</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(thepath)</span>
<span class="sd">    &gt;&gt;&gt; processparams = ta.ProcessingParameters()</span>
<span class="sd">    &gt;&gt;&gt; processparams..apply = True</span>
<span class="sd">    &gt;&gt;&gt; max_slopes = tam.get_maximum_slope(processparams)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># init list of characteristics</span>
    <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="n">sample_name</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
        <span class="k">if</span> <span class="n">exclude_discarded_time</span><span class="p">:</span>
            <span class="c1"># exclude</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># manual definition of start time to look for c3s - in case auto peak detection becomes difficult</span>
        <span class="k">if</span> <span class="n">read_start_c3s</span><span class="p">:</span>
            <span class="n">c3s_start_time_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;sample_number == &#39;</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)[</span><span class="s2">&quot;t_c3s_min_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c3s_end_time_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;sample_number == &#39;</span><span class="si">{</span><span class="n">sample_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)[</span><span class="s2">&quot;t_c3s_max_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">c3s_start_time_s</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">c3s_end_time_s</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Determineing maximum slope of </span><span class="si">{</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">processor</span> <span class="o">=</span> <span class="n">HeatFlowProcessor</span><span class="p">(</span><span class="n">processparams</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">make_equidistant</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">rolling_mean</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">apply_rolling_mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;curvature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">processor</span><span class="o">.</span><span class="n">calculate_heatflow_derivatives</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_largest_slope</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">processparams</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># optional plotting</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_maximum_slope</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">age_col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="p">,</span>
                <span class="n">sample</span><span class="p">,</span>
                <span class="n">characteristics</span><span class="p">,</span>
                <span class="n">time_discarded_s</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
                <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
                <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># plot heat flow curve</span>
            <span class="c1"># plt.plot(data[age_col], data[target_col], label=target_col)</span>
            <span class="c1"># plt.plot(</span>
            <span class="c1">#     data[age_col],</span>
            <span class="c1">#     data[&quot;gradient&quot;] * 1e4 + 0.001,</span>
            <span class="c1">#     label=&quot;gradient * 1e4 + 1mW&quot;,</span>
            <span class="c1"># )</span>

            <span class="c1"># # add vertical lines</span>
            <span class="c1"># for _idx, _row in characteristics.iterrows():</span>
            <span class="c1">#     # vline</span>
            <span class="c1">#     plt.axvline(_row.at[age_col], color=&quot;green&quot;, alpha=0.3)</span>

            <span class="c1"># # cosmetics</span>
            <span class="c1"># plt.xscale(&quot;log&quot;)</span>
            <span class="c1"># plt.title(f&quot;Maximum slope plot for {pathlib.Path(sample).stem}&quot;)</span>
            <span class="c1"># plt.xlabel(age_col)</span>
            <span class="c1"># plt.ylabel(target_col)</span>
            <span class="c1"># plt.legend()</span>

            <span class="c1"># # get axis</span>
            <span class="c1"># ax = plt.gca()</span>

            <span class="c1"># plt.fill_between(</span>
            <span class="c1">#     [ax.get_ylim()[0], time_discarded_s],</span>
            <span class="c1">#     [ax.get_ylim()[0]] * 2,</span>
            <span class="c1">#     [ax.get_ylim()[1]] * 2,</span>
            <span class="c1">#     color=&quot;black&quot;,</span>
            <span class="c1">#     alpha=0.35,</span>
            <span class="c1"># )</span>

            <span class="c1"># # set axis limit</span>
            <span class="c1"># plt.xlim(left=100)</span>
            <span class="c1"># plt.ylim(bottom=0, top=0.01)</span>

            <span class="c1"># # show</span>
            <span class="c1"># plt.show()</span>

        <span class="c1"># append to list</span>
        <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_characteristics</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maximum slope found, check you processing parameters&quot;</span><span class="p">)</span>
    <span class="c1"># build overall list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_slope_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>
        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">max_slope_characteristics</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



<details class="-returns" open>
  <summary>Returns</summary>
  <p>tuple
     pd.DataFrame of metadata and string of the column used as ID (has to
     be unique).</p>
</details>

            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">    tuple</span>
<span class="sd">         pd.DataFrame of metadata and string of the column used as ID (has to</span>
<span class="sd">         be unique).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_metadata_grouping_options" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metadata_grouping_options</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get a list of categories to group by in in "self.plot_by_category"</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of categories avaialble for grouping by.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_metadata_grouping_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a list of categories to group by in in &quot;self.plot_by_category&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        list of categories avaialble for grouping by.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get list based on column names of &quot;_metadata&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_peak_onset_via_max_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">intersection</span><span class="o">=</span><span class="s1">&#39;dormant_hf&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get reaction onset based on tangent of maximum heat flow and heat flow
during the dormant period. The characteristic time is inferred from
the intersection of both characteristic lines</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onset_via_max_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="n">intersection</span><span class="o">=</span><span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get reaction onset based on tangent of maximum heat flow and heat flow</span>
<span class="sd">    during the dormant period. The characteristic time is inferred from</span>
<span class="sd">    the intersection of both characteristic lines</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    show_plot : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get onsets</span>
    <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
        <span class="n">processparams</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># % get dormant period HFs</span>
    <span class="n">dorm_hfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
        <span class="n">processparams</span><span class="p">,</span>  <span class="c1"># cutoff_min=cutoff_min, prominence=prominence</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="c1"># ax=ax,</span>
    <span class="p">)</span>

    <span class="c1"># init list</span>
    <span class="n">list_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># calculate y-offset</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
        <span class="c1"># calculate point of intersection</span>
        <span class="c1"># calculate x-intersect of tangent with dormant heat flow</span>
        <span class="n">x_intersect_dormant</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span>
                    <span class="n">dorm_hfs</span><span class="p">[</span><span class="n">dorm_hfs</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]][</span>
                        <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="n">t</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
        <span class="c1"># elif intersection == &quot;abscissa&quot;:</span>
            <span class="c1"># calculate x-intersect of tangent with abscissa (y=0)</span>
        <span class="n">x_intersect</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @row[&#39;sample_short&#39;]&quot;</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span>

        <span class="n">heat_at_intersect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_intersect</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">])</span>

        <span class="c1"># append to list</span>
        <span class="n">list_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">],</span>
                <span class="s2">&quot;onset_time_s_abscissa&quot;</span><span class="p">:</span> <span class="n">x_intersect</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_min_abscissa&quot;</span><span class="p">:</span> <span class="n">x_intersect</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                <span class="s2">&quot;heat_at_onset_j_g&quot;</span><span class="p">:</span> <span class="n">heat_at_intersect</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_s&quot;</span><span class="p">:</span> <span class="n">x_intersect_dormant</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_min&quot;</span><span class="p">:</span> <span class="n">x_intersect_dormant</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>


        <span class="n">dorm_hfs_sample</span> <span class="o">=</span> <span class="n">dorm_hfs</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @sample&quot;</span><span class="p">)</span>
        <span class="c1"># add prefix dorm to all columns</span>
        <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dorm_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">dorm_hfs_sample</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()])</span>
        <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;xunit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xunit</span>
        <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;x_intersect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_intersect</span>
        <span class="n">characteristics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;intersection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersection</span>
        <span class="c1"># print(characteristics.x_intersect)</span>

        <span class="c1"># get maximum time value</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sample_short == @row[&#39;sample_short&#39;]&quot;</span><span class="p">)[</span>
            <span class="s2">&quot;time_s&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c1"># get maximum heat flow value</span>
        <span class="n">hmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;time_s &gt; 3000 &amp; sample_short == @row[&#39;sample_short&#39;]&quot;</span>
        <span class="p">)[</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_intersection</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="n">age_col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="p">,</span>
                <span class="n">sample</span><span class="p">,</span>
                <span class="c1"># max_slopes,</span>
                <span class="n">time_discarded_s</span><span class="p">,</span>
                <span class="n">characteristics</span><span class="o">=</span><span class="n">characteristics</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
                <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span>
                <span class="c1"># xunit=xunit,</span>
                <span class="n">hmax</span><span class="o">=</span><span class="n">hmax</span><span class="p">,</span>
                <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># build overall dataframe to be returned</span>
    <span class="n">onsets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_characteristics</span><span class="p">)</span>

    <span class="c1"># merge with dorm_hfs</span>
    <span class="n">onsets</span> <span class="o">=</span> <span class="n">onsets</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">dorm_hfs</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
        <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># rename</span>
    <span class="n">onsets</span> <span class="o">=</span> <span class="n">onsets</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span> <span class="s2">&quot;normalized_heat_flow_w_g_at_dorm_min&quot;</span><span class="p">,</span>
            <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span> <span class="s2">&quot;normalized_heat_j_g_at_dorm_min&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">onsets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_peak_onsets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peak_onsets</span><span class="p">(</span><span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get peak onsets based on a criterion of minimum gradient</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>measured quantity within which peak onsets are searched for. The default is "normalized_heat_flow_w_g"</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>age_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time unit within which peak onsets are searched for. The default is "time_s"</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_s&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_discarded_s</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</p>
              </div>
            </td>
            <td>
                  <code>900</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rolling</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of "rolling" window within which the values of "target_col" are averaged. A higher value will introduce a stronger smoothing effect. The default is 1, i.e. no smoothing.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gradient_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold of slope for identification of a peak onset. For a lower value, earlier peak onsets will be identified. The default is 0.0005.</p>
              </div>
            </td>
            <td>
                  <code>0.0005</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag whether or not to plot peak picking for each sample. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_discarded_time</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to discard the experimental values obtained before "time_discarded_s" also in the visualization. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regex pattern to include only certain experimental result files during initialization. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes._axes.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>pd.DataFrame holding peak onset characterisitcs for each sample.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onsets</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">rolling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">gradient_threshold</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get peak onsets based on a criterion of minimum gradient</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target_col : str, optional</span>
<span class="sd">        measured quantity within which peak onsets are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">    age_col : str, optional</span>
<span class="sd">        Time unit within which peak onsets are searched for. The default is &quot;time_s&quot;</span>
<span class="sd">    time_discarded_s : int | float, optional</span>
<span class="sd">        Time in seconds below which collected data points are discarded for peak onset picking. The default is 900.</span>
<span class="sd">    rolling : int, optional</span>
<span class="sd">        Width of &quot;rolling&quot; window within which the values of &quot;target_col&quot; are averaged. A higher value will introduce a stronger smoothing effect. The default is 1, i.e. no smoothing.</span>
<span class="sd">    gradient_threshold : float, optional</span>
<span class="sd">        Threshold of slope for identification of a peak onset. For a lower value, earlier peak onsets will be identified. The default is 0.0005.</span>
<span class="sd">    show_plot : bool, optional</span>
<span class="sd">        Flag whether or not to plot peak picking for each sample. The default is False.</span>
<span class="sd">    exclude_discarded_time : bool, optional</span>
<span class="sd">        Whether or not to discard the experimental values obtained before &quot;time_discarded_s&quot; also in the visualization. The default is False.</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        regex pattern to include only certain experimental result files during initialization. The default is None.</span>
<span class="sd">    ax : matplotlib.axes._axes.Axes | None, optional</span>
<span class="sd">        The default is None.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame holding peak onset characterisitcs for each sample.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># init list of characteristics</span>
    <span class="n">list_of_characteristics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exclude_discarded_time</span><span class="p">:</span>
            <span class="c1"># exclude</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># reset index</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># calculate get gradient</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">rolling</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># get relevant points</span>
        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># discard initial time</span>
        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age_col</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">time_discarded_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># look at values with certain gradient only</span>
        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;gradient &gt; @gradient_threshold&quot;</span><span class="p">)</span>
        <span class="c1"># consider first entry exclusively</span>
        <span class="n">characteristics</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># optional plotting</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="c1"># if specific axis to plot to is specified</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="c1"># plot heat flow curve</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>

                <span class="c1"># add vertical lines</span>
                <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_row</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="c1"># vline</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                    <span class="c1"># add &quot;slope line&quot;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">target_col</span><span class="p">]),</span>
                        <span class="n">slope</span><span class="o">=</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                        <span class="c1"># color=&quot;k&quot;,</span>
                        <span class="c1"># linewidth=0.2</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># cosmetics</span>
                <span class="c1"># ax.set_xscale(&quot;log&quot;)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Onset for &quot;</span> <span class="o">+</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_discarded_s</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># set axis limit</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># plot heat flow curve</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>

                <span class="c1"># add vertical lines</span>
                <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_row</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="c1"># vline</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">_row</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

                <span class="c1"># cosmetics</span>
                <span class="c1"># plt.xscale(&quot;log&quot;)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Onset for &quot;</span> <span class="o">+</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">age_col</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>

                <span class="c1"># get axis</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_discarded_s</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># set axis limit</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># append to list</span>
        <span class="n">list_of_characteristics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">characteristics</span><span class="p">)</span>

    <span class="c1"># build overall list</span>
    <span class="n">onset_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_characteristics</span><span class="p">)</span>

    <span class="c1"># return</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
        <span class="c1"># return onset characteristics and ax</span>
        <span class="k">return</span> <span class="n">onset_characteristics</span><span class="p">,</span> <span class="n">ax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># return onset characteristics exclusively</span>
        <span class="k">return</span> <span class="n">onset_characteristics</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_peaks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peaks</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">200000.0</span><span class="p">,</span> <span class="n">plt_top</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">plot_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmarker</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get DataFrame of peak characteristics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>measured quantity within which peaks are searched for. The default is "normalized_heat_flow_w_g"</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regex pattern to include only certain experimental result files
during initialization. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff_min</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time in minutes below which collected data points are discarded for peak picking</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag whether or not to plot peak picking for each sample. The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plt_right_s</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper limit of x-axis of in seconds. The default is 2e5.</p>
              </div>
            </td>
            <td>
                  <code>200000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plt_top</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper limit of y-axis of. The default is 1e-2.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes._axes.Axes">Axes</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>pd.DataFrame holding peak characterisitcs for each sample.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span>
    <span class="n">plt_top</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xunit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="n">plot_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xmarker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get DataFrame of peak characteristics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target_col : str, optional</span>
<span class="sd">        measured quantity within which peaks are searched for. The default is &quot;normalized_heat_flow_w_g&quot;</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        regex pattern to include only certain experimental result files</span>
<span class="sd">        during initialization. The default is None.</span>
<span class="sd">    cutoff_min : int | float, optional</span>
<span class="sd">        Time in minutes below which collected data points are discarded for peak picking</span>
<span class="sd">    show_plot : bool, optional</span>
<span class="sd">        Flag whether or not to plot peak picking for each sample. The default is True.</span>
<span class="sd">    plt_right_s : int | float, optional</span>
<span class="sd">        Upper limit of x-axis of in seconds. The default is 2e5.</span>
<span class="sd">    plt_top : int | float, optional</span>
<span class="sd">        Upper limit of y-axis of. The default is 1e-2.</span>
<span class="sd">    ax : matplotlib.axes._axes.Axes | None, optional</span>
<span class="sd">        The default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame holding peak characterisitcs for each sample.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># list of peaks</span>
    <span class="n">list_of_peaks_dfs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># loop samples</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">):</span>
        <span class="c1"># cutoff</span>
        <span class="k">if</span> <span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span><span class="p">:</span>
            <span class="c1"># discard points at early age</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;time_s &gt;= @processparams.cutoff.cutoff_min * 60&quot;</span><span class="p">)</span>

        <span class="c1"># reset index</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># target_columns</span>
        <span class="n">_age_col</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span>
        <span class="n">_target_col</span> <span class="o">=</span> <span class="n">target_col</span>

        <span class="c1"># find peaks</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="n">_target_col</span><span class="p">],</span>
            <span class="n">prominence</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">prominence</span><span class="p">,</span>
            <span class="n">distance</span><span class="o">=</span><span class="n">processparams</span><span class="o">.</span><span class="n">peakdetection</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot?</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xunit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                <span class="n">df_copy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df_copy</span><span class="p">[</span><span class="n">_age_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">_age_col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="n">plt_right_s</span> <span class="o">=</span> <span class="n">plt_right_s</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_peak_positions</span><span class="p">(</span>
                    <span class="n">df_copy</span><span class="p">,</span>
                    <span class="n">ax</span><span class="p">,</span>
                    <span class="n">_age_col</span><span class="p">,</span>
                    <span class="n">_target_col</span><span class="p">,</span>
                    <span class="n">peaks</span><span class="p">,</span>
                    <span class="n">sample</span><span class="p">,</span>
                    <span class="n">plt_top</span><span class="p">,</span>
                    <span class="n">plt_right_s</span><span class="p">,</span>
                    <span class="n">plot_labels</span><span class="p">,</span>
                    <span class="n">xmarker</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_peak_positions</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">ax</span><span class="p">,</span>
                    <span class="n">_age_col</span><span class="p">,</span>
                    <span class="n">_target_col</span><span class="p">,</span>
                    <span class="n">peaks</span><span class="p">,</span>
                    <span class="n">sample</span><span class="p">,</span>
                    <span class="n">plt_top</span><span class="p">,</span>
                    <span class="n">plt_right_s</span><span class="p">,</span>
                    <span class="n">plot_labels</span><span class="p">,</span>
                    <span class="n">xmarker</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># compile peak characteristics</span>
        <span class="n">peak_characteristics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">peaks</span><span class="p">,</span> <span class="p">:],</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;prominences&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">peaks</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prominence&quot;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;peak_nr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)))},</span> <span class="n">index</span><span class="o">=</span><span class="n">peaks</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># append</span>
        <span class="n">list_of_peaks_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_characteristics</span><span class="p">)</span>

    <span class="c1"># compile peak information</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_peaks_dfs</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
        <span class="c1"># return peak list and ax</span>
        <span class="k">return</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">ax</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># return peak list only</span>
        <span class="k">return</span> <span class="n">peaks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.get_sample_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sample_names</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get list of sample names</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sample_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get list of sample names</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get list</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">()]</span>

    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.normalize_sample_to_mass" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_sample_to_mass</span><span class="p">(</span><span class="n">sample_short</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>normalize "heat_flow" to a certain mass</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sample_short</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"sample_short" name of sample to be normalized.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mass_g</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mass in gram to which "heat_flow_w" are normalized.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_sample_to_mass</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    normalize &quot;heat_flow&quot; to a certain mass</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sample_short : str</span>
<span class="sd">        &quot;sample_short&quot; name of sample to be normalized.</span>
<span class="sd">    mass_g : float</span>
<span class="sd">        mass in gram to which &quot;heat_flow_w&quot; are normalized.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># normalize &quot;heat_flow_w&quot; to sample mass</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;heat_flow_w&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">mass_g</span>
    <span class="p">)</span>

    <span class="c1"># normalize &quot;heat_j&quot; to sample mass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">,</span> <span class="s2">&quot;heat_j&quot;</span><span class="p">]</span>
            <span class="o">/</span> <span class="n">mass_g</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># info</span>
    <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2"> normalized to </span><span class="si">{</span><span class="n">mass_g</span><span class="si">}</span><span class="s2">g sample.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">t_unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the calorimetry data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t_unit</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time unit. The default is "h". Options are "s", "min", "h", "d".</p>
              </div>
            </td>
            <td>
                  <code>&#39;h&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>y-axis. The default is "normalized_heat_flow_w_g". Options are
"normalized_heat_flow_w_g", "heat_flow_w", "normalized_heat_j_g",
"heat_j".</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_unit_milli</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether or not to plot y-axis in Milliwatt. The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>regex pattern to include only certain samples during plotting. The
default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether or not to show information. The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes._axes.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>axis to plot to. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calodatapath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">calodatapath</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Plot the calorimetry data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t_unit : str, optional</span>
<span class="sd">        time unit. The default is &quot;h&quot;. Options are &quot;s&quot;, &quot;min&quot;, &quot;h&quot;, &quot;d&quot;.</span>
<span class="sd">    y : str, optional</span>
<span class="sd">        y-axis. The default is &quot;normalized_heat_flow_w_g&quot;. Options are</span>
<span class="sd">        &quot;normalized_heat_flow_w_g&quot;, &quot;heat_flow_w&quot;, &quot;normalized_heat_j_g&quot;,</span>
<span class="sd">        &quot;heat_j&quot;.</span>
<span class="sd">    y_unit_milli : bool, optional</span>
<span class="sd">        whether or not to plot y-axis in Milliwatt. The default is True.</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        regex pattern to include only certain samples during plotting. The</span>
<span class="sd">        default is None.</span>
<span class="sd">    show_info : bool, optional</span>
<span class="sd">        whether or not to show information. The default is True.</span>
<span class="sd">    ax : matplotlib.axes._axes.Axes, optional</span>
<span class="sd">        axis to plot to. The default is None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import CaloCem as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; calodatapath = Path(__file__).parent</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, show_info=True)</span>
<span class="sd">    &gt;&gt;&gt; tam.plot(t_unit=&quot;h&quot;, y=&quot;normalized_heat_flow_w_g&quot;, y_unit_milli=False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># y-value</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">:</span>
        <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Normalized Heat Flow / [W/g]&quot;</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;heat_flow_w&quot;</span><span class="p">:</span>
        <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;heat_flow_w&quot;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Heat Flow / [W]&quot;</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">:</span>
        <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_j_g&quot;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Normalized Heat / [J/g]&quot;</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">==</span> <span class="s2">&quot;heat_j&quot;</span><span class="p">:</span>
        <span class="n">y_column</span> <span class="o">=</span> <span class="s2">&quot;heat_j&quot;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Heat / [J]&quot;</span>

    <span class="k">if</span> <span class="n">y_unit_milli</span><span class="p">:</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="n">y_label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;[m&quot;</span><span class="p">)</span>

    <span class="c1"># x-unit</span>
    <span class="k">if</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">x_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
        <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
        <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">t_unit</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
        <span class="n">x_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>

    <span class="c1"># y-unit</span>
    <span class="k">if</span> <span class="n">y_unit_milli</span><span class="p">:</span>
        <span class="n">y_factor</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_factor</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_samples</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">regex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sample</span><span class="p">)):</span>
                <span class="k">continue</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_s&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_factor</span>
        <span class="c1"># all columns containing heat</span>
        <span class="n">heatcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;heat&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="n">heatcols</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">heatcols</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_factor</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_base_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="n">y_column</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">style_base_plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">y_label</span><span class="p">,</span>
            <span class="n">t_unit</span><span class="p">,</span>
            <span class="n">sample</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.plot_by_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_by_category</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>plot by category, wherein the category is based on the information passed
via "self._add_metadata_source". Options available as "category" are
accessible via "self.get_metadata_grouping_options"</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>categories</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>])</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>category (from "self.get_metadata_grouping_options") to group by.
specify a string or a list of strings here</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>t_unit</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>see "self.plot". The default is "h".</p>
              </div>
            </td>
            <td>
                  <code>&#39;h&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>see "self.plot". The default is "normalized_heat_flow_w_g".</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_unit_milli</code>
            </td>
            <td>
                  <code><span title="TYPE">TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>see "self.plot". The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">CaloCem</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calodatapath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">calodatapath</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tam</span><span class="o">.</span><span class="n">plot_by_category</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span>
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_by_category</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot by category, wherein the category is based on the information passed</span>
<span class="sd">    via &quot;self._add_metadata_source&quot;. Options available as &quot;category&quot; are</span>
<span class="sd">    accessible via &quot;self.get_metadata_grouping_options&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    categories : str, list[str]</span>
<span class="sd">        category (from &quot;self.get_metadata_grouping_options&quot;) to group by.</span>
<span class="sd">        specify a string or a list of strings here</span>
<span class="sd">    t_unit : TYPE, optional</span>
<span class="sd">        see &quot;self.plot&quot;. The default is &quot;h&quot;.</span>
<span class="sd">    y : TYPE, optional</span>
<span class="sd">        see &quot;self.plot&quot;. The default is &quot;normalized_heat_flow_w_g&quot;.</span>
<span class="sd">    y_unit_milli : TYPE, optional</span>
<span class="sd">        see &quot;self.plot&quot;. The default is True.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import CaloCem as ta</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; calodatapath = Path(__file__).parent</span>
<span class="sd">    &gt;&gt;&gt; tam = ta.Measurement(folder=calodatapath, show_info=True)</span>
<span class="sd">    &gt;&gt;&gt; tam.plot_by_category(categories=&quot;sample&quot;)</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_helper_string</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        build a &quot;nicely&quot; formatted string from a supplied list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># connect with &quot;and&quot;</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># connect with comma and &quot;and&quot; for last element</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot;---&quot;</span>

        <span class="c1"># return</span>
        <span class="k">return</span> <span class="n">formatted</span>

    <span class="c1"># loop category values</span>
    <span class="k">for</span> <span class="n">selections</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">categories</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># - if multiple categories to group by are specified -</span>
            <span class="c1"># init helper DataFrame</span>
            <span class="n">target_idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="c1"># identify corresponding samples</span>
            <span class="k">for</span> <span class="n">selection</span><span class="p">,</span> <span class="n">category</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="n">categories</span><span class="p">):</span>
                <span class="n">target_idx</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">selection</span>
            <span class="c1"># get relevant indices</span>
            <span class="n">target_idx</span> <span class="o">=</span> <span class="n">target_idx</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
            <span class="c1"># define title</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Grouped by </span><span class="si">{</span><span class="n">build_helper_string</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">build_helper_string</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># - if only one(!) category to group by is specified -</span>
            <span class="c1"># identify corresponding samples</span>
            <span class="n">target_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">categories</span><span class="p">]</span> <span class="o">==</span> <span class="n">selections</span>
            <span class="c1"># define title</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Grouped by </span><span class="si">{</span><span class="n">categories</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">selections</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># pick relevant samples</span>
        <span class="n">target_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span><span class="p">]</span>

        <span class="c1"># build corresponding regex</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;)|(&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_samples</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

        <span class="c1"># plot</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="n">t_unit</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="n">y_unit_milli</span><span class="p">)</span>

        <span class="c1"># set title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># yield latest plot</span>
        <span class="k">yield</span> <span class="n">selections</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.remove_pickle_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_pickle_files</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>remove pickle files if re-reading of source files needed</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_pickle_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    remove pickle files if re-reading of source files needed</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># remove files</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_data_pickle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_info_pickle</span><span class="p">]:</span>
        <span class="c1"># remove file</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.undo_average_by_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_average_by_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>undo action of "average_by_metadata"</p>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">undo_average_by_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    undo action of &quot;average_by_metadata&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set &quot;unprocessed&quot; data as exeperimental data / &quot;de-average&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.tacalorimetry.Measurement.undo_tian_correction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_tian_correction</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>undo_tian_correction; i.e. restore original data</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/tacalorimetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">undo_tian_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    undo_tian_correction; i.e. restore original data</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># call original restore function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">undo_average_by_metadata</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.MedianFilterParameters" class="doc doc-heading">
            <code>MedianFilterParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters for the application of a Median filter to the data. The SciPy method <code>median_filter</code> is applied. <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.median_filter.html">Link to method</a></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>apply</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default is false. If <code>True</code>, a median filter is applied. The Scipy function <code>median_filter</code> is  applied.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the median filter (see the SciPy documentation)</p>
              </div>
            </td>
            <td>
                  <code>7</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MedianFilterParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for the application of a Median filter to the data. The SciPy method `median_filter` is applied. [Link to method](https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.median_filter.html)</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    apply: bool</span>
<span class="sd">        default is false. If `True`, a median filter is applied. The Scipy function `median_filter` is  applied.</span>
<span class="sd">    size: int</span>
<span class="sd">        The size of the median filter (see the SciPy documentation)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.PeakDetectionParameters" class="doc doc-heading">
            <code>PeakDetectionParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters that control the identication of peaks during peak detection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prominence</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum prominence of the peak</p>
              </div>
            </td>
            <td>
                  <code>1e-05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum distance of the peak.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PeakDetectionParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters that control the identication of peaks during peak detection.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    prominence: float</span>
<span class="sd">        The minimum prominence of the peak</span>
<span class="sd">    distance: int</span>
<span class="sd">        The minimum distance of the peak.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.PreProcessParameters" class="doc doc-heading">
            <code>PreProcessParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters for preprocessing the data before analysis.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.PreProcessParameters.infer_heat">infer_heat</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the heat flow is inferred from the data. This is useful for data that does not have a heat flow column.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PreProcessParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for preprocessing the data before analysis.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    infer_heat: bool</span>
<span class="sd">        If True, the heat flow is inferred from the data. This is useful for data that does not have a heat flow column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">infer_heat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.ProcessingParameters" class="doc doc-heading">
            <code>ProcessingParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>A data class for storing all processing parameters for calorimetry data.</p>
<p>This class aggregates various processing parameters, including cutoff criteria, time constants for the Tian correction, and parameters for peak detection and gradient peak detection.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.cutoff">cutoff</span></code></td>
            <td>
                  <code><span title="calocem.processparams.CutOffParameters">CutOffParameters</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters defining the cutoff criteria for the analysis.
Currently only cutoff_min is implemented, which defines the minimum time in minutes for the analysis. The default value is defined in the CutOffParameters class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.time_constants">time_constants</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TianCorrectionParameters


  
      dataclass
   (calocem.processparams.TianCorrectionParameters)" href="#calocem.tacalorimetry.TianCorrectionParameters">TianCorrectionParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters related to time constants used in Tian's correction method for thermal analysis. he default values are defined in the
TianCorrectionParameters class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.peakdetection">peakdetection</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="PeakDetectionParameters


  
      dataclass
   (calocem.processparams.PeakDetectionParameters)" href="#calocem.tacalorimetry.PeakDetectionParameters">PeakDetectionParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for detecting peaks in the thermal analysis data. This includes settings such as the minimum
prominence and distance between peaks. The default values are defined in the PeakDetectionParameters class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.gradient_peakdetection">gradient_peakdetection</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GradientPeakDetectionParameters


  
      dataclass
   (calocem.processparams.GradientPeakDetectionParameters)" href="#calocem.tacalorimetry.GradientPeakDetectionParameters">GradientPeakDetectionParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for detecting peaks based on the gradient of the thermal analysis data. This includes more
nuanced settings such as prominence, distance, width, relative height, and the criteria for selecting peaks
(e.g., first peak, largest width). The default values are defined in the GradientPeakDetectionParameters class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.downsample">downsample</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DownSamplingParameters


  
      dataclass
   (calocem.processparams.DownSamplingParameters)" href="#calocem.tacalorimetry.DownSamplingParameters">DownSamplingParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for adaptive downsampling of the thermal analysis data. This includes settings such as the number of points,
smoothing factor, and baseline weight. The default values are defined in the DownSamplingParameters class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.spline_interpolation">spline_interpolation</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SplineInterpolationParameters


  
      dataclass
   (calocem.processparams.SplineInterpolationParameters)" href="#calocem.tacalorimetry.SplineInterpolationParameters">SplineInterpolationParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters which control the interpolation of the first and second derivative of the data. If no smoothing is applied the derivatives often become very noisy.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.ProcessingParameters.slope_analysis">slope_analysis</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SlopeAnalysisParameters


  
      dataclass
   (calocem.processparams.SlopeAnalysisParameters)" href="#calocem.tacalorimetry.SlopeAnalysisParameters">SlopeAnalysisParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for slope analysis of the heat flow data. This includes settings which control the identification of the mean slope of the main hydration peak.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Define a set of processing parameters for thermal analysis data.</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processparams</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span> <span class="o">=</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processparams</span><span class="o">.</span><span class="n">spline_interpolation</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProcessingParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data class for storing all processing parameters for calorimetry data.</span>

<span class="sd">    This class aggregates various processing parameters, including cutoff criteria, time constants for the Tian correction, and parameters for peak detection and gradient peak detection.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    cutoff :</span>
<span class="sd">        Parameters defining the cutoff criteria for the analysis.</span>
<span class="sd">        Currently only cutoff_min is implemented, which defines the minimum time in minutes for the analysis. The default value is defined in the CutOffParameters class.</span>

<span class="sd">    time_constants : TianCorrectionParameters</span>
<span class="sd">        Parameters related to time constants used in Tian&#39;s correction method for thermal analysis. he default values are defined in the</span>
<span class="sd">        TianCorrectionParameters class.</span>

<span class="sd">    peakdetection : PeakDetectionParameters</span>
<span class="sd">        Parameters for detecting peaks in the thermal analysis data. This includes settings such as the minimum</span>
<span class="sd">        prominence and distance between peaks. The default values are defined in the PeakDetectionParameters class.</span>

<span class="sd">    gradient_peakdetection : GradientPeakDetectionParameters</span>
<span class="sd">        Parameters for detecting peaks based on the gradient of the thermal analysis data. This includes more</span>
<span class="sd">        nuanced settings such as prominence, distance, width, relative height, and the criteria for selecting peaks</span>
<span class="sd">        (e.g., first peak, largest width). The default values are defined in the GradientPeakDetectionParameters class.</span>

<span class="sd">    downsample : DownSamplingParameters</span>
<span class="sd">        Parameters for adaptive downsampling of the thermal analysis data. This includes settings such as the number of points,</span>
<span class="sd">        smoothing factor, and baseline weight. The default values are defined in the DownSamplingParameters class.</span>

<span class="sd">    spline_interpolation: SplineInterpolationParameters</span>
<span class="sd">        Parameters which control the interpolation of the first and second derivative of the data. If no smoothing is applied the derivatives often become very noisy.</span>

<span class="sd">    slope_analysis: SlopeAnalysisParameters</span>
<span class="sd">        Parameters for slope analysis of the heat flow data. This includes settings which control the identification of the mean slope of the main hydration peak.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Define a set of processing parameters for thermal analysis data.</span>

<span class="sd">    &gt;&gt;&gt; processparams = ProcessingParameters()</span>
<span class="sd">    &gt;&gt;&gt; processparams.cutoff.cutoff_min = 30</span>
<span class="sd">    &gt;&gt;&gt; processparams.spline_interpolation.apply = True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cutoff</span><span class="p">:</span> <span class="n">CutOffParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">CutOffParameters</span><span class="p">)</span>
    <span class="n">time_constants</span><span class="p">:</span> <span class="n">TianCorrectionParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">TianCorrectionParameters</span>
    <span class="p">)</span>

    <span class="c1"># peak detection params</span>
    <span class="n">peakdetection</span><span class="p">:</span> <span class="n">PeakDetectionParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">PeakDetectionParameters</span>
    <span class="p">)</span>
    <span class="n">gradient_peakdetection</span><span class="p">:</span> <span class="n">GradientPeakDetectionParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">GradientPeakDetectionParameters</span>
    <span class="p">)</span>

    <span class="c1"># smoothing params</span>
    <span class="n">rolling_mean</span><span class="p">:</span> <span class="n">RollingMeanParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">RollingMeanParameters</span><span class="p">)</span>
    <span class="n">median_filter</span><span class="p">:</span> <span class="n">MedianFilterParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">MedianFilterParameters</span>
    <span class="p">)</span>
    <span class="n">nonlin_savgol</span><span class="p">:</span> <span class="n">NonLinSavGolParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">NonLinSavGolParameters</span>
    <span class="p">)</span>
    <span class="n">spline_interpolation</span><span class="p">:</span> <span class="n">SplineInterpolationParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">SplineInterpolationParameters</span>
    <span class="p">)</span>
    <span class="c1"># preprocessing params</span>
    <span class="n">downsample</span><span class="p">:</span> <span class="n">DownSamplingParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">DownSamplingParameters</span><span class="p">)</span>
    <span class="n">preprocess</span><span class="p">:</span> <span class="n">PreProcessParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">PreProcessParameters</span><span class="p">)</span>
    <span class="c1"># slope analysis params</span>
    <span class="n">slope_analysis</span><span class="p">:</span> <span class="n">SlopeAnalysisParameters</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">SlopeAnalysisParameters</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.SlopeAnalysisParameters" class="doc doc-heading">
            <code>SlopeAnalysisParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters for slope analysis of heat flow data.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.SlopeAnalysisParameters.flank_fraction_start">flank_fraction_start</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start fraction of the window for averaging the slope of the main hydration peak. Example: 0.35 (the default value) means that the slope is calculated starting from 35% of the peak height measured relative to the minimum of the dormant period heat flow.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.SlopeAnalysisParameters.flank_fraction_end">flank_fraction_end</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end fraction of the window for averaging the slope of the main hydration peak. Example: 0.55 (the default value) means that the slope is calculated up to 55% of the peak height measured relative to the minimum of the dormant period heat flow.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calocem.tacalorimetry.SlopeAnalysisParameters.window_size">window_size</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the window for averaging the slope, given as a fraction of the total number of data points. Example: 0.1 (the default value) means that the slope is averaged over a window that is 10% of the total number of data points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SlopeAnalysisParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for slope analysis of heat flow data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    flank_fraction_start: float</span>
<span class="sd">        The start fraction of the window for averaging the slope of the main hydration peak. Example: 0.35 (the default value) means that the slope is calculated starting from 35% of the peak height measured relative to the minimum of the dormant period heat flow.</span>
<span class="sd">    flank_fraction_end: float</span>
<span class="sd">        The end fraction of the window for averaging the slope of the main hydration peak. Example: 0.55 (the default value) means that the slope is calculated up to 55% of the peak height measured relative to the minimum of the dormant period heat flow.</span>
<span class="sd">    window_size: float</span>
<span class="sd">        The size of the window for averaging the slope, given as a fraction of the total number of data points. Example: 0.1 (the default value) means that the slope is averaged over a window that is 10% of the total number of data points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">flank_fraction_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span>
    <span class="n">flank_fraction_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span>
    <span class="n">window_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># as fraction of total data points</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.SplineInterpolationParameters" class="doc doc-heading">
            <code>SplineInterpolationParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters for spline interpolation of heat flow data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>apply</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether spline interpolation should be applied to the heat flow data. The default value is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smoothing_1st_deriv</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smoothing parameter for the first derivative of the heat flow data. The default value is 1e-9.</p>
              </div>
            </td>
            <td>
                  <code>1e-09</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smoothing_2nd_deriv</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smoothing parameter for the second derivative of the heat flow data. The default value is 1e-9.</p>
              </div>
            </td>
            <td>
                  <code>1e-09</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SplineInterpolationParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for spline interpolation of heat flow data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    apply :</span>
<span class="sd">        Flag indicating whether spline interpolation should be applied to the heat flow data. The default value is False.</span>

<span class="sd">    smoothing_1st_deriv :</span>
<span class="sd">        Smoothing parameter for the first derivative of the heat flow data. The default value is 1e-9.</span>

<span class="sd">    smoothing_2nd_deriv :</span>
<span class="sd">        Smoothing parameter for the second derivative of the heat flow data. The default value is 1e-9.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">smoothing_1st_deriv</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">smoothing_2nd_deriv</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-9</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="calocem.tacalorimetry.TianCorrectionParameters" class="doc doc-heading">
            <code>TianCorrectionParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Parameters related to time constants used in Tian's correction method for thermal analysis. The default values are defined in the TianCorrectionParameters class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tau1</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time constant for the first correction step in Tian's method. The default value is 300.</p>
              </div>
            </td>
            <td>
                  <code>300</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tau2</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time constant for the second correction step in Tian's method. The default value is 100.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>calocem/processparams.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TianCorrectionParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters related to time constants used in Tian&#39;s correction method for thermal analysis. The default values are defined in the TianCorrectionParameters class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tau1 : int</span>
<span class="sd">        Time constant for the first correction step in Tian&#39;s method. The default value is 300.</span>

<span class="sd">    tau2 : int</span>
<span class="sd">        Time constant for the second correction step in Tian&#39;s method. The default value is 100.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tau1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">tau2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="calocem.measurement"></a>
    <div class="doc doc-contents first">

        <p>Refactored main measurement class for calorimetry data handling.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="calocem.measurement.Measurement" class="doc doc-heading">
            <code>Measurement</code>


</h2>


    <div class="doc doc-contents ">


        <p>Class for handling and processing isothermal heat flow calorimetry data.</p>
<p>This class coordinates file I/O, data processing, analysis, and visualization
operations while maintaining the same API as the original implementation.</p>








              <details class="quote">
                <summary>Source code in <code>calocem/measurement.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Measurement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for handling and processing isothermal heat flow calorimetry data.</span>

<span class="sd">    This class coordinates file I/O, data processing, analysis, and visualization</span>
<span class="sd">    operations while maintaining the same API as the original implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_clean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cold_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_code</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">processed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize measurements from folder or existing data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str or pathlib.Path, optional</span>
<span class="sd">            Path to folder containing experimental files</span>
<span class="sd">        show_info : bool, optional</span>
<span class="sd">            Whether to print informative messages, by default True</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex pattern to filter files, by default None</span>
<span class="sd">        auto_clean : bool, optional</span>
<span class="sd">            Whether to clean data automatically, by default False</span>
<span class="sd">        cold_start : bool, optional</span>
<span class="sd">            Whether to read from files or use cached data, by default True</span>
<span class="sd">        processparams : ProcessingParameters, optional</span>
<span class="sd">            Processing parameters, by default None. If None, the default parameters will be used</span>
<span class="sd">        new_code : bool, optional</span>
<span class="sd">            Flag for new code features, by default False</span>
<span class="sd">        processed : bool, optional</span>
<span class="sd">            Whether data is already processed, i.e., if a .csv file is used which was processed  by Calocem. By default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Store configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span> <span class="o">=</span> <span class="n">processed</span>

        <span class="c1"># Setup processing parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">ProcessingParameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">processparams</span>

        <span class="c1"># Initialize components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_loader</span> <span class="o">=</span> <span class="n">FolderDataLoader</span><span class="p">(</span><span class="n">processed</span><span class="o">=</span><span class="n">processed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span> <span class="o">=</span> <span class="n">DataPersistence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_cleaner</span> <span class="o">=</span> <span class="n">DataCleaner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span> <span class="o">=</span> <span class="n">SimplePlotter</span><span class="p">()</span>

        <span class="c1"># Load data if folder provided</span>
        <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cold_start</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_cache</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_auto_clean_data</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during initialization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AutoCleanException</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cold_start</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ColdStartException</span><span class="p">()</span>
                <span class="k">raise</span>

        <span class="c1"># Apply downsampling if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_adaptive_downsampling</span><span class="p">()</span>

        <span class="c1"># Information message</span>
        <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Are you missing some samples? Try rerunning with auto_clean=True and cold_start=True.&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_folder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span> <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load data from folder using file loader.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_loader</span><span class="o">.</span><span class="n">load_from_folder</span><span class="p">(</span>
                <span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Save to cache</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataProcessingException</span><span class="p">(</span><span class="s2">&quot;load_from_folder&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load data from cached pickle files.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span><span class="o">.</span><span class="n">pickle_files_exist</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;No pickle files found for cold start&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ColdStartException</span><span class="p">()</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_auto_clean_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply automatic data cleaning.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cleaner</span><span class="o">.</span><span class="n">auto_clean_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AutoCleanException</span><span class="p">()</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_adaptive_downsampling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply adaptive downsampling if configured.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: Implement downsampling logic</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downsampling requested but not yet implemented&quot;</span><span class="p">)</span>

    <span class="c1"># Data access methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the processed calorimetry data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the measurement information/metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get added metadata and the ID column name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sample_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of sample names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
            <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="c1"># Plotting methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">t_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">y_unit_milli</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the calorimetry data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="p">,</span> <span class="n">ax</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_by_category</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">categories</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">t_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">y_unit_milli</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot data by metadata categories.&quot;&quot;&quot;</span>
        <span class="c1"># Simplified implementation - would need full metadata integration</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;plot_by_category requires metadata integration - not fully implemented&quot;</span>
        <span class="p">)</span>
        <span class="k">yield from</span> <span class="p">[]</span>

    <span class="c1"># Analysis methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Deprecated parameter</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">plt_right_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">,</span>
        <span class="n">plt_top</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">plot_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xmarker</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get DataFrame of peak characteristics.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cutoff_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The cutoff_min parameter is deprecated. Use ProcessingParameters instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">PeakAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">peaks_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Simple plotting implementation</span>
            <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
                <span class="n">sample_peaks</span> <span class="o">=</span> <span class="n">peaks_df</span><span class="p">[</span>
                    <span class="n">peaks_df</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sample_peaks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="c1"># Get peak indices relative to sample data</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

                    <span class="n">peak_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_peaks</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_peaks</span><span class="p">(</span>
                        <span class="n">sample_data</span><span class="p">,</span> <span class="n">peak_indices</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">),</span> <span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="n">target_col</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">peaks_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onsets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">rolling</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">gradient_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get peak onsets based on gradient threshold.&quot;&quot;&quot;</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">OnsetAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_peak_onsets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">time_discarded_s</span><span class="p">,</span>
            <span class="n">rolling</span><span class="p">,</span>
            <span class="n">gradient_threshold</span><span class="p">,</span>
            <span class="n">exclude_discarded_time</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_maximum_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">read_start_c3s</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the point in time of the maximum slope.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

        <span class="n">time_discarded_s</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span> <span class="o">*</span> <span class="mi">60</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">SlopeAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">time_discarded_s</span><span class="p">,</span>
            <span class="n">exclude_discarded_time</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
            <span class="c1"># read_start_c3s,</span>
            <span class="c1"># self._metadata,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
                <span class="n">sample_short</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">sample_result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
                <span class="n">sample_result</span> <span class="o">=</span> <span class="n">sample_result</span><span class="p">[</span>
                    <span class="n">sample_result</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_discarded_s</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sample_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_slopes</span><span class="p">(</span>
                        <span class="n">sample_data</span><span class="p">,</span>
                        <span class="n">sample_result</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">sample_short</span><span class="p">),</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">age_col</span><span class="p">,</span>
                        <span class="n">target_col</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mainpeak_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unified method that calculates BOTH maximum and mean slope onset analyses.</span>

<span class="sd">        This method performs both slope-based analysis approaches simultaneously:</span>
<span class="sd">        - Maximum slope: Uses single point with maximum gradient for onset determination</span>
<span class="sd">        - Mean slope: Uses averaged slope over flank windows for onset determination</span>

<span class="sd">        Both results are returned in a single DataFrame with all slope values and onsets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        processparams : ProcessingParameters, optional</span>
<span class="sd">            Processing parameters, by default None</span>
<span class="sd">        target_col : str</span>
<span class="sd">            Column containing heat flow data. The default is &#39;normalized_heat_flow_w_g&#39;.</span>
<span class="sd">        age_col : str</span>
<span class="sd">            Column containing time data. The default is &#39;time_s&#39;.</span>
<span class="sd">        show_plot : bool</span>
<span class="sd">            Whether to plot the results</span>
<span class="sd">        plot_type : str</span>
<span class="sd">            Type of plot to show: &#39;max&#39;, &#39;mean&#39;,</span>
<span class="sd">            - &#39;max&#39;: Shows only maximum slope analysis plot</span>
<span class="sd">            - &#39;mean&#39;: Shows only mean slope (flank tangent) analysis plot</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex to filter samples</span>
<span class="sd">        plotpath : pathlib.Path, optional</span>
<span class="sd">            Path to save plots</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            Matplotlib axes to plot on</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Comprehensive DataFrame with both max and mean slope results including:</span>
<span class="sd">            - Gradients and curvatures at max slope</span>
<span class="sd">            - Gradients of mean slope</span>
<span class="sd">            - Onset times from both methods</span>
<span class="sd">            - Normalized heat flow and heat values at key points</span>
<span class="sd">            - Dormant period heat flow values</span>
<span class="sd">            - ASTM C1679 characteristic values</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; measurement = Measurement(folder=&quot;data/&quot;)</span>
<span class="sd">        &gt;&gt;&gt; mainpeak_params = measurement.get_mainpeak_params(</span>
<span class="sd">        ...     processparams=ProcessingParameters(),</span>
<span class="sd">        ...     show_plot=False,</span>
<span class="sd">        ...     plot_type=&quot;mean&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

        <span class="n">max_slope_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_max_slope_analysis</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">mean_slope_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_mean_slope_analysis</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">dormant_minimum_heatflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">astm_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">individual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">)</span>

        <span class="c1"># Merge results into comprehensive DataFrame</span>
        <span class="n">combined_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_slope_results</span><span class="p">(</span>
            <span class="n">max_slope_results</span><span class="p">,</span> <span class="n">mean_slope_results</span><span class="p">,</span> <span class="n">dormant_minimum_heatflow</span><span class="p">,</span> <span class="n">astm_values</span>
        <span class="p">)</span>

        <span class="c1"># Plot if requested</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_combined_slope_analysis</span><span class="p">(</span>
                <span class="n">combined_results</span><span class="p">,</span>
                <span class="n">params</span><span class="p">,</span>
                <span class="n">target_col</span><span class="p">,</span>
                <span class="n">age_col</span><span class="p">,</span>
                <span class="n">plot_type</span><span class="p">,</span>
                <span class="n">regex</span><span class="p">,</span>
                <span class="n">plotpath</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># logger.warning(&quot;No slope analysis results to plot.&quot;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No mean slope analysis obtained - check the processing parameters.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;No maximum slope analysis obtained - check the processing parameters.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">combined_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_max_slope_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">ProcessingParameters</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate maximum slope analysis and return structured results.&quot;&quot;&quot;</span>
        <span class="c1"># Get required data</span>
        <span class="n">max_slope_analyzer</span> <span class="o">=</span> <span class="n">SlopeAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">max_slopes</span> <span class="o">=</span> <span class="n">max_slope_analyzer</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No maximum slopes found. Check processing parameters.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">dormant_hfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dormant_hfs</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No dormant period heat flows found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Calculate onsets</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">OnsetAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="n">max_slopes</span><span class="p">,</span>
            <span class="n">dormant_hfs</span><span class="p">,</span>  <span class="c1"># intersection, xunit</span>
        <span class="p">)</span>

        <span class="c1"># Structure results with consistent naming</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">slope_row</span> <span class="ow">in</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="n">onset_row</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">onsets</span><span class="p">[</span><span class="n">onsets</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">onsets</span><span class="o">.</span><span class="n">empty</span>
                <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">onset_time</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">onset_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;onset_time_s&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_row</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="c1"># get normalized_heat_j_g at onset_time</span>
            <span class="k">if</span> <span class="n">onset_time</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">onset_time</span><span class="p">):</span>
                <span class="n">onset_j_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                    <span class="n">onset_time</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">onset_j_g</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">result_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
                <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">sample_short</span><span class="p">,</span>
                <span class="s2">&quot;gradient_from_max_slope&quot;</span><span class="p">:</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;curvature_at_max_slope&quot;</span><span class="p">:</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;curvature&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;max_slope_time_s&quot;</span><span class="p">:</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_flow_w_g_at_max_slope&quot;</span><span class="p">:</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="s2">&quot;normalized_heat_j_g_at_max_slope&quot;</span><span class="p">:</span> <span class="n">slope_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalized_heat_j_g&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_j_g_at_onset_time_max_slope&quot;</span><span class="p">:</span> <span class="n">onset_j_g</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_s_from_max_slope&quot;</span><span class="p">:</span> <span class="n">onset_time</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_min_max_slope&quot;</span><span class="p">:</span> <span class="n">onset_time</span> <span class="o">/</span> <span class="mi">60</span> <span class="k">if</span> <span class="n">onset_time</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_s_max_slope_abscissa&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">onset_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;onset_time_s_abscissa&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_row</span><span class="o">.</span><span class="n">empty</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_mean_slope_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">ProcessingParameters</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate mean slope (flank tangent) analysis and return structured results.&quot;&quot;&quot;</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">FlankTangentAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># Get flank tangent results</span>
        <span class="n">tangent_results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_ascending_flank_tangent</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">tangent_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No flank tangent results found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tangent_results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="c1"># onset by intersection with tangent to dormant period</span>
            <span class="n">onset_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_intersection_dormant&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tangent_time_s&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">result_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span>
                <span class="s2">&quot;sample_short&quot;</span><span class="p">:</span> <span class="n">sample_short</span><span class="p">,</span>
                <span class="s2">&quot;gradient_of_mean_slope&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tangent_slope&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;mean_slope_time_s&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tangent_time_s&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_flow_w_g_at_mean_slope&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tangent_value&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_j_g_at_mean_slope&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tangent_j_g&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;onset_time_s_from_mean_slope&quot;</span><span class="p">:</span> <span class="n">onset_time</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_min_from_mean_slope&quot;</span><span class="p">:</span> <span class="n">onset_time</span> <span class="o">/</span> <span class="mi">60</span> <span class="k">if</span> <span class="n">onset_time</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;onset_time_s_from_mean_slope_abscissa&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_intersection&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_at_onset_time_mean_slope_abscissa_j_g&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_intersection_j_g&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_at_onset_time_mean_slope_dormant_j_g&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_intersection_dormant_j_g&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;flank_start_value&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;flank_start_value&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;flank_end_value&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;flank_end_value&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;peak_time_s&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;peak_time_s&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_flow_w_g_at_peak&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;peak_value&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;normalized_heat_j_g_at_peak&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;peak_j_g&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_merge_slope_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_slope_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">mean_slope_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">dormant_hf_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">astm_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge max slope and mean slope results into comprehensive DataFrame.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span>
            <span class="ow">and</span> <span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span>
            <span class="ow">and</span> <span class="n">dormant_hf_results</span><span class="o">.</span><span class="n">empty</span>
            <span class="ow">and</span> <span class="n">astm_results</span><span class="o">.</span><span class="n">empty</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Use outer join to combine results by sample</span>
        <span class="k">if</span> <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mean_slope_results</span>
        <span class="k">if</span> <span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">max_slope_results</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">max_slope_results</span><span class="p">,</span>
            <span class="n">mean_slope_results</span><span class="p">,</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_short&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_duplicate&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">combined</span><span class="p">,</span>
            <span class="n">dormant_hf_results</span><span class="p">,</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_short&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_duplicate&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">combined</span><span class="p">,</span>
            <span class="n">astm_results</span><span class="p">,</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_short&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_duplicate&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">duplicate_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">combined</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_duplicate&quot;</span><span class="p">)]</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">duplicate_cols</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">combined</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_combined_slope_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">ProcessingParameters</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
        <span class="n">ax</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot combined slope analysis results based on plot_type parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        results : pd.DataFrame</span>
<span class="sd">            Combined results containing both max and mean slope data</span>
<span class="sd">        target_col : str</span>
<span class="sd">            Column name for heat flow data</span>
<span class="sd">        age_col : str</span>
<span class="sd">            Column name for time data</span>
<span class="sd">        plot_type : str</span>
<span class="sd">            Type of plot to show: &#39;max&#39;, &#39;mean&#39;, or &#39;both&#39;</span>
<span class="sd">            - &#39;max&#39;: Shows only maximum slope analysis plot</span>
<span class="sd">            - &#39;mean&#39;: Shows only mean slope (flank tangent) analysis plot</span>
<span class="sd">            - &#39;both&#39;: Shows both analysis types (separate plots for each)</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex to filter samples</span>
<span class="sd">        plotpath : pathlib.Path, optional</span>
<span class="sd">            Path to save plots</span>
<span class="sd">        cutoff_min : float, optional</span>
<span class="sd">            Cutoff time in minutes</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            Matplotlib axes to plot on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate plot_type parameter</span>
        <span class="n">valid_plot_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]</span>
        <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_plot_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;plot_type must be one of </span><span class="si">{</span><span class="n">valid_plot_types</span><span class="si">}</span><span class="s2">, got &#39;</span><span class="si">{</span><span class="n">plot_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># For now, plot using the existing unified plotting approach</span>
        <span class="c1"># This could be enhanced to show both slope methods simultaneously</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">result_row</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span>

            <span class="c1"># Get sample data</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_sample_data</span><span class="p">(</span>
                <span class="n">sample</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">cutoff_time_min</span><span class="o">=</span><span class="n">cutoff_min</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span>
                <span class="n">result_row</span><span class="o">.</span><span class="n">onset_time_s_from_mean_slope</span> <span class="ow">or</span> <span class="n">result_row</span><span class="o">.</span><span class="n">onset_time_s_from_max_slope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_tangent_analysis</span><span class="p">(</span>
                    <span class="n">sample_data</span><span class="p">,</span>
                    <span class="n">sample_short</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                    <span class="n">cutoff_time_min</span><span class="o">=</span><span class="n">cutoff_min</span><span class="p">,</span>
                    <span class="n">analysis_type</span><span class="o">=</span><span class="n">plot_type</span><span class="p">,</span>  <span class="c1"># Use correct analysis type</span>
                    <span class="n">results</span><span class="o">=</span><span class="n">result_row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_and_show_plot</span><span class="p">(</span>
                <span class="n">plotpath</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_type</span><span class="si">}</span><span class="s2">_slope_</span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">ax</span>
            <span class="p">)</span>


    <span class="c1"># Backward compatibility methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onset_via_max_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">intersection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get reaction onset via maximum slope intersection method.</span>

<span class="sd">        This is a wrapper around get_peak_onset_via_slope for backward compatibility.</span>
<span class="sd">        Returns only the max slope related columns for compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mainpeak_params</span><span class="p">(</span>
            <span class="n">processparams</span><span class="o">=</span><span class="n">processparams</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>

            <span class="c1">#time_discarded_s=time_discarded_s,</span>
            <span class="c1">#intersection=intersection,</span>
            <span class="c1">#xunit=xunit,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">full_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">full_results</span>

        <span class="c1"># Extract only max slope related columns for backward compatibility</span>
        <span class="c1"># max_slope_cols = [</span>
        <span class="c1">#     col</span>
        <span class="c1">#     for col in full_results.columns</span>
        <span class="c1">#     if col.startswith(&quot;max_slope_&quot;) or col in [&quot;sample&quot;, &quot;sample_short&quot;]</span>
        <span class="c1"># ]</span>

        <span class="c1"># result = full_results[max_slope_cols].copy()</span>

        <span class="c1"># Rename columns to match old API</span>
        <span class="c1"># column_mapping = {</span>
        <span class="c1">#     &quot;onset_time_s_from_max_slope&quot;: &quot;onset_time_s&quot;,</span>
        <span class="c1">#     &quot;max_slope_onset_time_min&quot;: &quot;onset_time_min&quot;,</span>
        <span class="c1">#     &quot;max_slope_value&quot;: &quot;maximum_slope&quot;,</span>
        <span class="c1">#     &quot;max_slope_time_s&quot;: &quot;maximum_slope_time_s&quot;,</span>
        <span class="c1"># }</span>

        <span class="c1"># for old_name, new_name in column_mapping.items():</span>
        <span class="c1">#     if old_name in result.columns:</span>
        <span class="c1">#         result = result.rename(columns={old_name: new_name})</span>

        <span class="k">return</span> <span class="n">full_results</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">get_ascending_flank_tangent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">flank_fraction_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">flank_fraction_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">window_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine tangent to ascending flank of peak by averaging over sections.</span>

<span class="sd">        This is a wrapper around get_peak_onset_via_slope for backward compatibility.</span>
<span class="sd">        Returns only the mean slope related columns for compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_slope</span><span class="p">(</span>
            <span class="n">processparams</span><span class="o">=</span><span class="n">processparams</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span><span class="p">,</span>
            <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">plotpath</span><span class="o">=</span><span class="n">plotpath</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">flank_fraction_start</span><span class="o">=</span><span class="n">flank_fraction_start</span><span class="p">,</span>
            <span class="n">flank_fraction_end</span><span class="o">=</span><span class="n">flank_fraction_end</span><span class="p">,</span>
            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">full_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">full_results</span>

        <span class="c1"># Extract only mean slope related columns for backward compatibility</span>
        <span class="n">mean_slope_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">col</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">full_results</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mean_slope_&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">full_results</span><span class="p">[</span><span class="n">mean_slope_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Rename columns to match old API</span>
        <span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mean_slope_onset_time_s&quot;</span><span class="p">:</span> <span class="s2">&quot;x_intersection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_slope_value&quot;</span><span class="p">:</span> <span class="s2">&quot;tangent_slope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_slope_time_s&quot;</span><span class="p">:</span> <span class="s2">&quot;tangent_time_s&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">column_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_name</span><span class="p">:</span> <span class="n">new_name</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dormant_period_heatflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">upper_dormant_thresh_w_g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
        <span class="n">plot_right_boundary</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">,</span>
        <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dormant period heat flow characteristics.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

        <span class="c1"># Get peaks first</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Analyze dormant period</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">DormantPeriodAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">dorm_hf</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dorm_hf</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dorm_hf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_astm_c1679_characteristics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">individual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get characteristics according to ASTM C1679.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

        <span class="c1"># Get peaks first</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Analyze ASTM characteristics</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">ASTMC1679Analyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">individual</span><span class="p">,</span> <span class="n">regex</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cumulated_heat_at_hours</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get cumulated heat flow at specific age.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;cutoff_min&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The cutoff_min parameter is deprecated. Use ProcessingParameters instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>
            <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>

        <span class="k">return</span> <span class="n">HeatCalculator</span><span class="o">.</span><span class="n">get_cumulated_heat_at_hours</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">target_h</span><span class="p">,</span> <span class="n">cutoff_min</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_average_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate average slope between onset and heat flow maximum.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

        <span class="c1"># Get required data</span>
        <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">onsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">onsets</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot calculate average slopes - missing required data&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">AverageSlopeAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_average_slope</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">max_slopes</span><span class="p">,</span> <span class="n">onsets</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">regex</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_tangent_analysis_unified</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">analysis_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intersection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Additional data for onset intersection analysis</span>
        <span class="n">max_slopes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dormant_hfs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">onsets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unified plotting method for tangent-based analysis results.</span>

<span class="sd">        This method handles both flank tangent and onset intersection analysis,</span>
<span class="sd">        with the main difference being how the slope is determined:</span>
<span class="sd">        - Flank tangent: Uses averaged slope over a window</span>
<span class="sd">        - Max slope: Uses single point with maximum gradient</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        results : pd.DataFrame</span>
<span class="sd">            Results from the analysis (tangent results for flank, onsets for max slope)</span>
<span class="sd">        analysis_type : str</span>
<span class="sd">            Either &#39;flank_tangent&#39; or &#39;max_slope_onset&#39;</span>
<span class="sd">        target_col : str</span>
<span class="sd">            Column name for heat flow data</span>
<span class="sd">        age_col : str</span>
<span class="sd">            Column name for time data</span>
<span class="sd">        regex : str, optional</span>
<span class="sd">            Regex to filter samples</span>
<span class="sd">        plotpath : pathlib.Path, optional</span>
<span class="sd">            Path to save plots</span>
<span class="sd">        cutoff_time_min : float, optional</span>
<span class="sd">            Cutoff time in minutes</span>
<span class="sd">        intersection : str</span>
<span class="sd">            Type of intersection for onset analysis (&#39;dormant_hf&#39; or &#39;abscissa&#39;)</span>
<span class="sd">        xunit : str</span>
<span class="sd">            Time unit for plotting</span>
<span class="sd">        time_discarded_s : float</span>
<span class="sd">            Time to discard for onset analysis</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            Matplotlib axes to plot on</span>
<span class="sd">        max_slopes : pd.DataFrame, optional</span>
<span class="sd">            Required for onset intersection analysis</span>
<span class="sd">        dormant_hfs : pd.DataFrame, optional</span>
<span class="sd">            Required for onset intersection analysis with dormant_hf</span>
<span class="sd">        onsets : pd.DataFrame, optional</span>
<span class="sd">            Required for onset intersection analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;flank_tangent&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_flank_tangent_unified</span><span class="p">(</span>
                    <span class="n">results</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">plotpath</span><span class="p">,</span> <span class="n">cutoff_time_min</span><span class="p">,</span> <span class="n">ax</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;max_slope_onset&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_onset_intersection_unified</span><span class="p">(</span>
                    <span class="n">results</span><span class="p">,</span>
                    <span class="n">max_slopes</span><span class="p">,</span>
                    <span class="n">dormant_hfs</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="p">,</span>
                    <span class="n">age_col</span><span class="p">,</span>
                    <span class="n">regex</span><span class="p">,</span>
                    <span class="n">intersection</span><span class="p">,</span>
                    <span class="n">xunit</span><span class="p">,</span>
                    <span class="n">time_discarded_s</span><span class="p">,</span>
                    <span class="n">ax</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown analysis_type: </span><span class="si">{</span><span class="n">analysis_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error plotting tangent analysis results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_flank_tangent_unified</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot flank tangent analysis results using unified SimplePlotter.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">result_row</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">result_row</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span>

            <span class="c1"># Get sample data</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_sample_data</span><span class="p">(</span>
                <span class="n">sample</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">cutoff_time_min</span><span class="o">=</span><span class="n">cutoff_time_min</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Create a DataFrame with just this result for plotting</span>
            <span class="n">single_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">result_row</span><span class="p">])</span>

            <span class="c1"># Use unified plotting method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_tangent_analysis</span><span class="p">(</span>
                <span class="n">sample_data</span><span class="p">,</span>
                <span class="n">sample_short</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">cutoff_time_min</span><span class="o">=</span><span class="n">cutoff_time_min</span><span class="p">,</span>
                <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;flank_tangent&quot;</span><span class="p">,</span>
                <span class="n">tangent_results</span><span class="o">=</span><span class="n">single_result</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_save_and_show_plot</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;flank_tangent_</span><span class="si">{</span><span class="n">sample_short</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_onset_intersection_unified</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">onsets</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">max_slopes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">dormant_hfs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intersection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot onset intersection analysis results using unified SimplePlotter.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_slopes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_slopes required for onset intersection analysis&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">onset_row</span> <span class="ow">in</span> <span class="n">onsets</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">onset_row</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span>

            <span class="c1"># Get sample data</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_sample_data</span><span class="p">(</span>
                <span class="n">sample</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="n">time_discarded_s</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Use unified plotting method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_tangent_analysis</span><span class="p">(</span>
                <span class="n">sample_data</span><span class="p">,</span>
                <span class="n">sample</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
                <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
                <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;onset_intersection&quot;</span><span class="p">,</span>
                <span class="n">max_slopes</span><span class="o">=</span><span class="n">max_slopes</span><span class="p">,</span>
                <span class="n">dormant_hfs</span><span class="o">=</span><span class="n">dormant_hfs</span><span class="p">,</span>
                <span class="n">onsets</span><span class="o">=</span><span class="n">onsets</span><span class="p">,</span>
                <span class="n">intersection</span><span class="o">=</span><span class="n">intersection</span><span class="p">,</span>
                <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Note: plotpath not available in this context, only show plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_and_show_plot</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;onset_intersection_</span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_filtered_sample_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cutoff_time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sample data with appropriate filtering applied.</span>

<span class="sd">        This consolidates the common data filtering logic used in both analysis types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get sample data - handle both &#39;sample&#39; and &#39;sample_short&#39; columns</span>
        <span class="n">sample_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">sample</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sample_data</span>

        <span class="c1"># Apply cutoff time filtering</span>
        <span class="k">if</span> <span class="n">cutoff_time_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cutoff_seconds</span> <span class="o">=</span> <span class="n">cutoff_time_min</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="n">sample_data</span><span class="p">[</span><span class="n">sample_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cutoff_seconds</span><span class="p">]</span>

        <span class="c1"># Apply time discarded filtering (for onset analysis)</span>
        <span class="k">if</span> <span class="n">time_discarded_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time_discarded_s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="n">sample_data</span><span class="p">[</span><span class="n">sample_data</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_discarded_s</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sample_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_and_show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle plot saving and showing - common logic for both analysis types.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plotpath</span><span class="p">:</span>
            <span class="n">plot_file</span> <span class="o">=</span> <span class="n">plotpath</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_flank_tangent_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cutoff_time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot flank tangent analysis results using SimplePlotter.</span>

<span class="sd">        This is a wrapper around the unified plotting method for backward compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_tangent_analysis_unified</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span>
            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;flank_tangent&quot;</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">plotpath</span><span class="o">=</span><span class="n">plotpath</span><span class="p">,</span>
            <span class="n">cutoff_time_min</span><span class="o">=</span><span class="n">cutoff_time_min</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_plot_onset_intersections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">onsets</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">max_slopes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">dormant_hfs</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">intersection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
        <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot onset intersection analysis results using SimplePlotter.</span>

<span class="sd">        This is a wrapper around the unified plotting method for backward compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_tangent_analysis_unified</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">onsets</span><span class="p">,</span>
            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;max_slope_onset&quot;</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
            <span class="n">intersection</span><span class="o">=</span><span class="n">intersection</span><span class="p">,</span>
            <span class="n">xunit</span><span class="o">=</span><span class="n">xunit</span><span class="p">,</span>
            <span class="n">time_discarded_s</span><span class="o">=</span><span class="n">time_discarded_s</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">max_slopes</span><span class="o">=</span><span class="n">max_slopes</span><span class="p">,</span>
            <span class="n">dormant_hfs</span><span class="o">=</span><span class="n">dormant_hfs</span><span class="p">,</span>
            <span class="n">onsets</span><span class="o">=</span><span class="n">onsets</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Data manipulation methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_sample_to_mass</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize heat flow values to a specific mass.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataNormalizer</span><span class="o">.</span><span class="n">normalize_sample_to_mass</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">,</span> <span class="n">show_info</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add metadata from external source.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: Implement metadata loading</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;add_metadata_source not yet implemented in refactored version&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_pickle_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove pickle cache files.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span><span class="o">.</span><span class="n">remove_pickle_files</span><span class="p">()</span>

    <span class="c1"># Private utility methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over samples - compatibility method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cold_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">processed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize measurements from folder or existing data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to folder containing experimental files</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print informative messages, by default True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex pattern to filter files, by default None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auto_clean</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clean data automatically, by default False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cold_start</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to read from files or use cached data, by default True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingParameters


  
      dataclass
   (calocem.processparams.ProcessingParameters)" href="#calocem.tacalorimetry.ProcessingParameters">ProcessingParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing parameters, by default None. If None, the default parameters will be used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_code</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag for new code features, by default False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>processed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether data is already processed, i.e., if a .csv file is used which was processed  by Calocem. By default False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_clean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">cold_start</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">new_code</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">processed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize measurements from folder or existing data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str or pathlib.Path, optional</span>
<span class="sd">        Path to folder containing experimental files</span>
<span class="sd">    show_info : bool, optional</span>
<span class="sd">        Whether to print informative messages, by default True</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        Regex pattern to filter files, by default None</span>
<span class="sd">    auto_clean : bool, optional</span>
<span class="sd">        Whether to clean data automatically, by default False</span>
<span class="sd">    cold_start : bool, optional</span>
<span class="sd">        Whether to read from files or use cached data, by default True</span>
<span class="sd">    processparams : ProcessingParameters, optional</span>
<span class="sd">        Processing parameters, by default None. If None, the default parameters will be used</span>
<span class="sd">    new_code : bool, optional</span>
<span class="sd">        Flag for new code features, by default False</span>
<span class="sd">    processed : bool, optional</span>
<span class="sd">        Whether data is already processed, i.e., if a .csv file is used which was processed  by Calocem. By default False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_unprocessed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Store configuration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_new_code</span> <span class="o">=</span> <span class="n">new_code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span> <span class="o">=</span> <span class="n">processed</span>

    <span class="c1"># Setup processing parameters</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">processparams</span><span class="p">,</span> <span class="n">ProcessingParameters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">ProcessingParameters</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span> <span class="o">=</span> <span class="n">processparams</span>

    <span class="c1"># Initialize components</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_folder_loader</span> <span class="o">=</span> <span class="n">FolderDataLoader</span><span class="p">(</span><span class="n">processed</span><span class="o">=</span><span class="n">processed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span> <span class="o">=</span> <span class="n">DataPersistence</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_cleaner</span> <span class="o">=</span> <span class="n">DataCleaner</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span> <span class="o">=</span> <span class="n">SimplePlotter</span><span class="p">()</span>

    <span class="c1"># Load data if folder provided</span>
    <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cold_start</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_cache</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_auto_clean_data</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during initialization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">auto_clean</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AutoCleanException</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cold_start</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ColdStartException</span><span class="p">()</span>
            <span class="k">raise</span>

    <span class="c1"># Apply downsampling if requested</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">apply</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_adaptive_downsampling</span><span class="p">()</span>

    <span class="c1"># Information message</span>
    <span class="k">if</span> <span class="n">show_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Are you missing some samples? Try rerunning with auto_clean=True and cold_start=True.&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.add_metadata_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_metadata_source</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add metadata from external source.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_id_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add metadata from external source.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: Implement metadata loading</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;add_metadata_source not yet implemented in refactored version&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_ascending_flank_tangent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ascending_flank_tangent</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">flank_fraction_start</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">flank_fraction_end</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine tangent to ascending flank of peak by averaging over sections.</p>
<p>This is a wrapper around get_peak_onset_via_slope for backward compatibility.
Returns only the mean slope related columns for compatibility.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ascending_flank_tangent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">flank_fraction_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">flank_fraction_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">window_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">cutoff_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine tangent to ascending flank of peak by averaging over sections.</span>

<span class="sd">    This is a wrapper around get_peak_onset_via_slope for backward compatibility.</span>
<span class="sd">    Returns only the mean slope related columns for compatibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_slope</span><span class="p">(</span>
        <span class="n">processparams</span><span class="o">=</span><span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
        <span class="n">cutoff_min</span><span class="o">=</span><span class="n">cutoff_min</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">plotpath</span><span class="o">=</span><span class="n">plotpath</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">flank_fraction_start</span><span class="o">=</span><span class="n">flank_fraction_start</span><span class="p">,</span>
        <span class="n">flank_fraction_end</span><span class="o">=</span><span class="n">flank_fraction_end</span><span class="p">,</span>
        <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">full_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_results</span>

    <span class="c1"># Extract only mean slope related columns for backward compatibility</span>
    <span class="n">mean_slope_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">full_results</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mean_slope_&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_short&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_time_s&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">full_results</span><span class="p">[</span><span class="n">mean_slope_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Rename columns to match old API</span>
    <span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mean_slope_onset_time_s&quot;</span><span class="p">:</span> <span class="s2">&quot;x_intersection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_slope_value&quot;</span><span class="p">:</span> <span class="s2">&quot;tangent_slope&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_slope_time_s&quot;</span><span class="p">:</span> <span class="s2">&quot;tangent_time_s&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">column_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_name</span><span class="p">:</span> <span class="n">new_name</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_astm_c1679_characteristics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">individual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get characteristics according to ASTM C1679.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_astm_c1679_characteristics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">individual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get characteristics according to ASTM C1679.&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

    <span class="c1"># Get peaks first</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Analyze ASTM characteristics</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">ASTMC1679Analyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">individual</span><span class="p">,</span> <span class="n">regex</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_average_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_slope</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate average slope between onset and heat flow maximum.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate average slope between onset and heat flow maximum.&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

    <span class="c1"># Get required data</span>
    <span class="n">max_slopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">onsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_slopes</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">onsets</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot calculate average slopes - missing required data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">AverageSlopeAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_average_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">max_slopes</span><span class="p">,</span> <span class="n">onsets</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">age_col</span><span class="p">,</span> <span class="n">regex</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_cumulated_heat_at_hours" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cumulated_heat_at_hours</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_h</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get cumulated heat flow at specific age.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_cumulated_heat_at_hours</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get cumulated heat flow at specific age.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;cutoff_min&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cutoff_min&quot;</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The cutoff_min parameter is deprecated. Use ProcessingParameters instead.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>
        <span class="n">cutoff_min</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span>

    <span class="k">return</span> <span class="n">HeatCalculator</span><span class="o">.</span><span class="n">get_cumulated_heat_at_hours</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">target_h</span><span class="p">,</span> <span class="n">cutoff_min</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the processed calorimetry data.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the processed calorimetry data.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_dormant_period_heatflow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dormant_period_heatflow</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">plot_right_boundary</span><span class="o">=</span><span class="mf">200000.0</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get dormant period heat flow characteristics.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dormant_period_heatflow</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cutoff_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">upper_dormant_thresh_w_g</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">plot_right_boundary</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">,</span>
    <span class="n">prominence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dormant period heat flow characteristics.&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

    <span class="c1"># Get peaks first</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Analyze dormant period</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">DormantPeriodAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">dorm_hf</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">upper_dormant_thresh_w_g</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dorm_hf</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dorm_hf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_information" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_information</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the measurement information/metadata.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the measurement information/metadata.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_mainpeak_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mainpeak_params</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Unified method that calculates BOTH maximum and mean slope onset analyses.</p>
<p>This method performs both slope-based analysis approaches simultaneously:
- Maximum slope: Uses single point with maximum gradient for onset determination
- Mean slope: Uses averaged slope over flank windows for onset determination</p>
<p>Both results are returned in a single DataFrame with all slope values and onsets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processparams</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingParameters


  
      dataclass
   (calocem.processparams.ProcessingParameters)" href="#calocem.tacalorimetry.ProcessingParameters">ProcessingParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing parameters, by default None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column containing heat flow data. The default is 'normalized_heat_flow_w_g'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;normalized_heat_flow_w_g&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>age_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column containing time data. The default is 'time_s'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_s&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to plot the results</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of plot to show: 'max', 'mean',
- 'max': Shows only maximum slope analysis plot
- 'mean': Shows only mean slope (flank tangent) analysis plot</p>
              </div>
            </td>
            <td>
                  <code>&#39;mean&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex to filter samples</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plotpath</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save plots</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes.Axes">Axes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matplotlib axes to plot on</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Comprehensive DataFrame with both max and mean slope results including:
- Gradients and curvatures at max slope
- Gradients of mean slope
- Onset times from both methods
- Normalized heat flow and heat values at key points
- Dormant period heat flow values
- ASTM C1679 characteristic values</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">measurement</span> <span class="o">=</span> <span class="n">Measurement</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="s2">&quot;data/&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mainpeak_params</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">get_mainpeak_params</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">processparams</span><span class="o">=</span><span class="n">ProcessingParameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mainpeak_params</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plotpath</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unified method that calculates BOTH maximum and mean slope onset analyses.</span>

<span class="sd">    This method performs both slope-based analysis approaches simultaneously:</span>
<span class="sd">    - Maximum slope: Uses single point with maximum gradient for onset determination</span>
<span class="sd">    - Mean slope: Uses averaged slope over flank windows for onset determination</span>

<span class="sd">    Both results are returned in a single DataFrame with all slope values and onsets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    processparams : ProcessingParameters, optional</span>
<span class="sd">        Processing parameters, by default None</span>
<span class="sd">    target_col : str</span>
<span class="sd">        Column containing heat flow data. The default is &#39;normalized_heat_flow_w_g&#39;.</span>
<span class="sd">    age_col : str</span>
<span class="sd">        Column containing time data. The default is &#39;time_s&#39;.</span>
<span class="sd">    show_plot : bool</span>
<span class="sd">        Whether to plot the results</span>
<span class="sd">    plot_type : str</span>
<span class="sd">        Type of plot to show: &#39;max&#39;, &#39;mean&#39;,</span>
<span class="sd">        - &#39;max&#39;: Shows only maximum slope analysis plot</span>
<span class="sd">        - &#39;mean&#39;: Shows only mean slope (flank tangent) analysis plot</span>
<span class="sd">    regex : str, optional</span>
<span class="sd">        Regex to filter samples</span>
<span class="sd">    plotpath : pathlib.Path, optional</span>
<span class="sd">        Path to save plots</span>
<span class="sd">    ax : matplotlib.axes.Axes, optional</span>
<span class="sd">        Matplotlib axes to plot on</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Comprehensive DataFrame with both max and mean slope results including:</span>
<span class="sd">        - Gradients and curvatures at max slope</span>
<span class="sd">        - Gradients of mean slope</span>
<span class="sd">        - Onset times from both methods</span>
<span class="sd">        - Normalized heat flow and heat values at key points</span>
<span class="sd">        - Dormant period heat flow values</span>
<span class="sd">        - ASTM C1679 characteristic values</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; measurement = Measurement(folder=&quot;data/&quot;)</span>
<span class="sd">    &gt;&gt;&gt; mainpeak_params = measurement.get_mainpeak_params(</span>
<span class="sd">    ...     processparams=ProcessingParameters(),</span>
<span class="sd">    ...     show_plot=False,</span>
<span class="sd">    ...     plot_type=&quot;mean&quot;,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

    <span class="n">max_slope_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_max_slope_analysis</span><span class="p">(</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">mean_slope_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_mean_slope_analysis</span><span class="p">(</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dormant_minimum_heatflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dormant_period_heatflow</span><span class="p">(</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">astm_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_astm_c1679_characteristics</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">individual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">)</span>

    <span class="c1"># Merge results into comprehensive DataFrame</span>
    <span class="n">combined_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_slope_results</span><span class="p">(</span>
        <span class="n">max_slope_results</span><span class="p">,</span> <span class="n">mean_slope_results</span><span class="p">,</span> <span class="n">dormant_minimum_heatflow</span><span class="p">,</span> <span class="n">astm_values</span>
    <span class="p">)</span>

    <span class="c1"># Plot if requested</span>
    <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_combined_slope_analysis</span><span class="p">(</span>
            <span class="n">combined_results</span><span class="p">,</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">target_col</span><span class="p">,</span>
            <span class="n">age_col</span><span class="p">,</span>
            <span class="n">plot_type</span><span class="p">,</span>
            <span class="n">regex</span><span class="p">,</span>
            <span class="n">plotpath</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">mean_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># logger.warning(&quot;No slope analysis results to plot.&quot;)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No mean slope analysis obtained - check the processing parameters.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">max_slope_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;No maximum slope analysis obtained - check the processing parameters.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">combined_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_maximum_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_maximum_slope</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_start_c3s</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find the point in time of the maximum slope.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_maximum_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">exclude_discarded_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">read_start_c3s</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the point in time of the maximum slope.&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>

    <span class="n">time_discarded_s</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span> <span class="o">*</span> <span class="mi">60</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">cutoff_min</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">SlopeAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_maximum_slope</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">,</span>
        <span class="c1"># read_start_c3s,</span>
        <span class="c1"># self._metadata,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
            <span class="n">sample_short</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">sample_result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_short</span><span class="p">]</span>
            <span class="n">sample_result</span> <span class="o">=</span> <span class="n">sample_result</span><span class="p">[</span>
                <span class="n">sample_result</span><span class="p">[</span><span class="n">age_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_discarded_s</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sample_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_slopes</span><span class="p">(</span>
                    <span class="n">sample_data</span><span class="p">,</span>
                    <span class="n">sample_result</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">sample_short</span><span class="p">),</span>
                    <span class="n">ax</span><span class="p">,</span>
                    <span class="n">age_col</span><span class="p">,</span>
                    <span class="n">target_col</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get added metadata and the ID column name.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get added metadata and the ID column name.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_peak_onset_via_max_slope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peak_onset_via_max_slope</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">intersection</span><span class="o">=</span><span class="s1">&#39;dormant_hf&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get reaction onset via maximum slope intersection method.</p>
<p>This is a wrapper around get_peak_onset_via_slope for backward compatibility.
Returns only the max slope related columns for compatibility.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onset_via_max_slope</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="n">intersection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dormant_hf&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get reaction onset via maximum slope intersection method.</span>

<span class="sd">    This is a wrapper around get_peak_onset_via_slope for backward compatibility.</span>
<span class="sd">    Returns only the max slope related columns for compatibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mainpeak_params</span><span class="p">(</span>
        <span class="n">processparams</span><span class="o">=</span><span class="n">processparams</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="o">=</span><span class="n">age_col</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
        <span class="n">regex</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>

        <span class="c1">#time_discarded_s=time_discarded_s,</span>
        <span class="c1">#intersection=intersection,</span>
        <span class="c1">#xunit=xunit,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">full_results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_results</span>

    <span class="c1"># Extract only max slope related columns for backward compatibility</span>
    <span class="c1"># max_slope_cols = [</span>
    <span class="c1">#     col</span>
    <span class="c1">#     for col in full_results.columns</span>
    <span class="c1">#     if col.startswith(&quot;max_slope_&quot;) or col in [&quot;sample&quot;, &quot;sample_short&quot;]</span>
    <span class="c1"># ]</span>

    <span class="c1"># result = full_results[max_slope_cols].copy()</span>

    <span class="c1"># Rename columns to match old API</span>
    <span class="c1"># column_mapping = {</span>
    <span class="c1">#     &quot;onset_time_s_from_max_slope&quot;: &quot;onset_time_s&quot;,</span>
    <span class="c1">#     &quot;max_slope_onset_time_min&quot;: &quot;onset_time_min&quot;,</span>
    <span class="c1">#     &quot;max_slope_value&quot;: &quot;maximum_slope&quot;,</span>
    <span class="c1">#     &quot;max_slope_time_s&quot;: &quot;maximum_slope_time_s&quot;,</span>
    <span class="c1"># }</span>

    <span class="c1"># for old_name, new_name in column_mapping.items():</span>
    <span class="c1">#     if old_name in result.columns:</span>
    <span class="c1">#         result = result.rename(columns={old_name: new_name})</span>

    <span class="k">return</span> <span class="n">full_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_peak_onsets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peak_onsets</span><span class="p">(</span><span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">age_col</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">time_discarded_s</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_discarded_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get peak onsets based on gradient threshold.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peak_onsets</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">age_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
    <span class="n">time_discarded_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
    <span class="n">rolling</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">gradient_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_discarded_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get peak onsets based on gradient threshold.&quot;&quot;&quot;</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">OnsetAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processparams</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_peak_onsets</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">,</span>
        <span class="n">age_col</span><span class="p">,</span>
        <span class="n">time_discarded_s</span><span class="p">,</span>
        <span class="n">rolling</span><span class="p">,</span>
        <span class="n">gradient_threshold</span><span class="p">,</span>
        <span class="n">exclude_discarded_time</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_peaks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_peaks</span><span class="p">(</span><span class="n">processparams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plt_right_s</span><span class="o">=</span><span class="mf">200000.0</span><span class="p">,</span> <span class="n">plt_top</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xunit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">plot_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmarker</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get DataFrame of peak characteristics.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProcessingParameters</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cutoff_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Deprecated parameter</span>
    <span class="n">show_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">plt_right_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">,</span>
    <span class="n">plt_top</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xunit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="n">plot_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xmarker</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get DataFrame of peak characteristics.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cutoff_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The cutoff_min parameter is deprecated. Use ProcessingParameters instead.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">processparams</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">processparams</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">PeakAnalyzer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_plot</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">peaks_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># Simple plotting implementation</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_data</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
            <span class="n">sample_peaks</span> <span class="o">=</span> <span class="n">peaks_df</span><span class="p">[</span>
                <span class="n">peaks_df</span><span class="p">[</span><span class="s2">&quot;sample_short&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sample_peaks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Get peak indices relative to sample data</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

                <span class="n">peak_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_peaks</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_peaks</span><span class="p">(</span>
                    <span class="n">sample_data</span><span class="p">,</span> <span class="n">peak_indices</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">),</span> <span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;time_s&quot;</span><span class="p">,</span> <span class="n">target_col</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">peaks_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.get_sample_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sample_names</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get list of sample names.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sample_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of sample names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">SampleIterator</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.normalize_sample_to_mass" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_sample_to_mass</span><span class="p">(</span><span class="n">sample_short</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Normalize heat flow values to a specific mass.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_sample_to_mass</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize heat flow values to a specific mass.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataNormalizer</span><span class="o">.</span><span class="n">normalize_sample_to_mass</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">sample_short</span><span class="p">,</span> <span class="n">mass_g</span><span class="p">,</span> <span class="n">show_info</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">t_unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the calorimetry data.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">y_unit_milli</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the calorimetry data.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotter</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">show_info</span><span class="p">,</span> <span class="n">ax</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.plot_by_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_by_category</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;normalized_heat_flow_w_g&#39;</span><span class="p">,</span> <span class="n">y_unit_milli</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot data by metadata categories.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_by_category</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;normalized_heat_flow_w_g&quot;</span><span class="p">,</span>
    <span class="n">y_unit_milli</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot data by metadata categories.&quot;&quot;&quot;</span>
    <span class="c1"># Simplified implementation - would need full metadata integration</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
        <span class="s2">&quot;plot_by_category requires metadata integration - not fully implemented&quot;</span>
    <span class="p">)</span>
    <span class="k">yield from</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="calocem.measurement.Measurement.remove_pickle_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_pickle_files</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove pickle cache files.</p>


            <details class="quote">
              <summary>Source code in <code>calocem/measurement.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_pickle_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove pickle cache files.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_persistence</span><span class="o">.</span><span class="n">remove_pickle_files</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 22, 2025 01:59:22 UTC">October 22, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 22, 2025 01:59:22 UTC">October 22, 2025</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/tgaedt" class="md-author" title="@tgaedt">
          
          <img src="https://avatars.githubusercontent.com/u/102058507?v=4&size=72" alt="tgaedt">
        </a>
      
        <a href="https://github.com/mj-hofmann" class="md-author" title="@mj-hofmann">
          
          <img src="https://avatars.githubusercontent.com/u/97462230?v=4&size=72" alt="mj-hofmann">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="how-to-guide.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: How-To Guides">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                How-To Guides
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - present Matthias Hofmann
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mj-hofmann" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/matthias-j-hofmann/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["search.highlight", "search.suggest", "search.share", "header.autohide", "navigation.sections", "navigation.footer", "navigation.top"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>